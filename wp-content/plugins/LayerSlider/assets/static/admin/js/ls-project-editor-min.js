var LS_previewArea,LS_previewHolder,LS_previewWrapper,LS_sliderID=0,LS_activeSlideIndex=0,LS_activeLayerIndexSet=[],LS_activeScreenType="desktop",LS_lastSelectedLayerIndex=0,LS_previewItems=[],LS_activeSlideData={},LS_activeLayerDataSet=[],LS_activeStaticLayersDataSet=[],LS_defaultSlideData={},LS_defaultLayerData={},LS_sliderIsDirty=!1,LS_editorIsDirty=!1,LS_draftNoticeOpened=0,LS_layerWasDragged=!1,LS_sliderSettingsOpened=!1,LS_callbackSettingsOpened=!1,LS_imageEditorOpened=!1,LS_multipleSelection=!1,LS_preventDatePickerChange=!1,LS_quickEditLayerIndex=0,LS_searchMatches=[],LS_searchOpened=!1,LS_clipboard={},LS_previewZoom=1,LS_contextMenuTop=10,LS_contextMenuLeft=10,LS_transformStyles=["rotation","rotationX","rotationY","scaleX","scaleY","skewX","skewY"],LS_tourData=!1,LS_tourIsActive=!1,lsSetSliderDirtyState=function(e){LS_sliderIsDirty=!!e,jQuery("lse-editor")[e?"addClass":"removeClass"]("lse-slider-is-dirty")},lsSetEditorDirtyState=function(e){LS_editorIsDirty=!!e,e&&lsSetSliderDirtyState(e),jQuery("lse-editor")[e?"addClass":"removeClass"]("lse-editor-is-dirty")},$lasso=jQuery(),LS_Utils={convertDateToUTC:function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())},jsTimeZoneID:function(){var e=(new Date).getTimezoneOffset(),t=Math.abs(e);return(e<0?"+":"-")+("00"+Math.floor(t/60)).slice(-2)+":"+("00"+t%60).slice(-2)},dataURItoBlob:function(e,t){t=t||"image/png";for(var a=atob(e.split(",")[1]),i=[],r=0;r<a.length;r++)i.push(a.charCodeAt(r));return new Blob([new Uint8Array(i)],{type:t})},resizeCanvas:function(e,t,a){var i=document.createElement("canvas");return i.width=t,i.height=a,i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,a),i},moveArrayItem:function(e,t,a){if(a!==t){for(var i=e[t],r=a<t?-1:1,s=t;s!=a;s+=r)e[s]=e[s+r];e[a]=i}},toAbsoluteURL:function(e){return-1!=e.search(/^\/\//)?window.location.protocol+e:-1!=e.search(/:\/\//)?e:-1!=e.search(/^\//)?window.location.origin+e:window.location.href.match(/(.*\/)/)[0]+e},stripTags:function(e,t){t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,(function(e,a){return t.indexOf("<"+a.toLowerCase()+">")>-1?e:""}))},nl2br:function(e,t){var a=t||void 0===t?"<br />":"<br>";return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+a+"$2")},removeTextSelection:function(){var e=window.getSelection?window.getSelection():document.selection?document.selection:null;e&&(e.empty?e.empty():e.removeAllRanges())},stripslashes:function(e){return(e+"").replace(/\\(.?)/g,(function(e,t){switch(t){case"\\":return"\\";case"0":return"\0";case"":return"";default:return t}}))},parse_url:function(e,t){for(var a=("undefined"!=typeof require?require("../info/ini_get")("locutus.parse_url.mode"):void 0)||"php",i=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],r={php:new RegExp(["(?:([^:\\/?#]+):)?","(?:\\/\\/()(?:(?:()(?:([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?))?","()","(?:(()(?:(?:[^?#\\/]*\\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)"].join("")),strict:new RegExp(["(?:([^:\\/?#]+):)?","(?:\\/\\/((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?))?","((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)"].join("")),loose:new RegExp(["(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?","(?:\\/\\/\\/?)?","((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?)","(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))","(?:\\?([^#]*))?(?:#(.*))?)"].join(""))},s=r[a].exec(e),l={},n=14;n--;)s[n]&&(l[i[n]]=s[n]);if(t)return l[t.replace("PHP_URL_","").toLowerCase()];if("php"!==a){var o=("undefined"!=typeof require?require("../info/ini_get")("locutus.parse_url.queryKey"):void 0)||"queryKey";r=/(?:^|&)([^&=]*)=?([^&]*)/g,l[o]={},(l[i[12]]||"").replace(r,(function(e,t,a){t&&(l[o][t]=a)}))}return delete l.source,l},beautifyFileName:function(e){return(e=(e=e.split("/").pop()).split(".")).length>1&&e.pop(),e=(e=(e=e.join("")).replace(/-|_/g," ")).charAt(0).toUpperCase()+e.slice(1)},normalizeSVG:function(e){var t=(new DOMParser).parseFromString(e,"image/svg+xml"),a=jQuery(t).find("svg"),i=parseInt(a.attr("width")),r=parseInt(a.attr("height"));if(!a.length)return alert(LS_l10n.SBInvalidSVGSource),!1;i&&r&&(a.attr("viewbox")||(a[0].setAttribute("viewBox","0 0 "+i+" "+r),a.removeAttr("width height")));let s=LS_Utils.getNormalizedSVGSize(i,r);return{html:a[0].outerHTML,width:s.width,height:s.height}},getNormalizedSVGSize:function(e=300,t=300){let a=e/t;return e>t?t=(e=300)/a:e=(t=300)*a,{width:Math.ceil(e),height:Math.ceil(t)}},version_compare:function(e,t,a){let i,r,s=0;const l={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},n=function(e){return(e=(e=(""+e).replace(/[_\-+]/g,".")).replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,".")).length?e.split("."):[-8]},o=function(e){return e?isNaN(e)?l[e]||-7:parseInt(e,10):0};for(e=n(e),t=n(t),r=Math.max(e.length,t.length),i=0;i<r;i++)if(e[i]!==t[i]){if(e[i]=o(e[i]),t[i]=o(t[i]),e[i]<t[i]){s=-1;break}if(e[i]>t[i]){s=1;break}}if(!a)return s;switch(a){case">":case"gt":return s>0;case">=":case"ge":return s>=0;case"<=":case"le":return s<=0;case"===":case"=":case"eq":return 0===s;case"<>":case"!==":case"ne":return 0!==s;case"":case"<":case"lt":return s<0;default:return null}},maybeAddLineBreaksToLayerContent:function(e){let t=e.html||"";return e.htmlLineBreak&&("enabled"===e.htmlLineBreak&&(t=LS_Utils.nl2br(t)),"auto"===e.htmlLineBreak&&-1!==["text","button","post"].indexOf(e.media)&&(t=LS_Utils.nl2br(t))),t},shouldWrapLayerContent:function(e){if("post"===e.media&&e.html){let t=jQuery.trim(e.html),a=t.substr(0,1),i=t.substr(t.length-1,1);if("<"===a&&">"===i)try{let e=jQuery(t);if(e&&1===e.length)return!1}catch(e){}}return!0},parseHex:function(e,t){return(e=e.replace(/^#/g,"")).match(/^[A-F0-9]{3,6}/gi)?3!==e.length&&6!==e.length?"":(3===e.length&&t&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),"#"+e):""}},LS_SVGUtils={origSettings:{polygon:{sideCount:6,sideLength:200,radius:5,strokeWidth:0,strokeColor:"#000000",fillColor:"#0099ff"},oval:{width:150,height:150,strokeWidth:0,strokeColor:"#000000",fillColor:"#0099ff"},rectangle:{width:200,height:150,radius:5,strokeWidth:0,strokeColor:"#000000",fillColor:"#0099ff"},line:{length:150,linewidth:10,strokeColor:"#000000"}},calculateShapeData:function(e){var t={type:e.type,strokeColor:e.strokeColor||"#333",fillColor:e.fillColor||"none"};if("polygon"===e.type){t.sideCount=e.sideCount||6,t.sideLength=parseInt(e.sideLength)||200,t.radius=parseInt(e.radius)||5,t.strokeWidth=parseInt(e.strokeWidth)||0;var a=this.roundedPolygon(t.sideCount,t.sideLength,t.radius,0);t.width=a.width,t.height=a.height}if("oval"===e.type){t.width=parseInt(e.width)||150,t.height=parseInt(e.height)||150,t.strokeWidth=parseInt(e.strokeWidth)||0,t.centerx=t.width/2,t.centery=t.height/2;a=this.oval(t.width,t.height,t.centerx,t.centery)}if("rectangle"===e.type){t.width=parseInt(e.width)||150,t.height=parseInt(e.height)||150,t.radius=parseInt(e.radius)||5,t.strokeWidth=parseInt(e.strokeWidth)||0;a=this.roundedRect(t.width,t.height,t.radius)}if("line"===e.type){t.length=t.width=parseInt(e.length)||150,t.roundedEndings=e.roundedEndings,t.strokeWidth=parseInt(e.lineWidth)||4,t.height=0;a=this.roundedRect(t.width,0,0)}return t.path=a.path,t.proportionedHeight=this.getProportionedHeight(t.width,t.height,t.strokeWidth,t.type),t},createShapeSVG:function(e){var t="http://www.w3.org/2000/svg",a=document.createElementNS(t,"svg");this.setAttrs(a,{xmlns:t,viewBox:"-"+e.strokeWidth/2+" -"+e.strokeWidth/2+" "+(e.width+e.strokeWidth)+" "+(e.height+e.strokeWidth)});var i=document.createElementNS(t,"path");return this.setAttrs(i,{stroke:e.strokeColor,"stroke-width":e.strokeWidth,fill:"currentColor",d:e.path}),e.roundedEndings&&this.setAttrs(i,{"stroke-linejoin":"round"}),a.appendChild(i),a.outerHTML},setAttrs:function(e,t){for(var a in t)t.hasOwnProperty(a)&&e.setAttribute(a,t[a])},roundedPolygon:function(e,t,a,i){i=i||0;var r=(e-2)*Math.PI/e/2,s=Math.sin(r),l=Math.cos(r),n=t-2/Math.tan(r)*a,o=2*l*a,d=t/l,c=0;if(e%2){var u=d/2+d/2*s;c=((d=Math.sqrt(Math.pow(t/2,2)+Math.pow(u,2)))-u)/2}function p(e){return Math.floor((e+2*Math.PI)%(2*Math.PI)/(Math.PI/2))+1}d+=2*i;for(var y=[[0,a/s-a*s+i+c]],h=[r-Math.PI/2],S=0,m=1;m<=e;m+=1){var L=h[m-1],g=L+Math.PI-2*r,v=(L+g)/2,f=p(L),b=p(g);1===f&&b>=2&&b<=3&&(S=Math.cos(Math.abs(v-Math.PI/2))*a/s-a),h.push(g),y.push([Math.cos(v)*o,Math.sin(v)*o]),m!==e&&y.push([Math.cos(g)*n,Math.sin(g)*n])}var _=a/s-a;e%2?(d-=2*S,y[0][1]-=(2*S+_)/2):(d-=2*_,y[0][1]-=_),y[0][0]=d/2-l*a;var w=Math.ceil(d),j=(w-d)/2;function I(e){var t=+e.toPrecision(14);return Math.abs(t)<1e-13&&(t=0),t}y[0][0]+=j,y[0][1]+=j;var k=[];return y.forEach((function(e,t){var i=I(e[0]),r=I(e[1]);0===t?k.push("M"+i+" "+r):t%2?k.push("a"+a+" "+a+" 0 0 1 "+i+" "+r):k.push("l"+i+" "+r)})),{width:w,height:w,path:k.join("")}},oval:function(e,t,a,i){var r=e/2,s=t/2;return{path:`M${a-r},${i}a${r},${s} 0 1,0 ${2*r},0a${r},${s} 0 1,0 -${2*r},0`}},roundedRect:function(e,t,a){return{path:"M 0 "+a+" A "+a+" "+a+" 0 0 1 "+a+" 0 L "+(e-a)+" 0 A "+a+" "+a+" 0 0 1 "+e+" "+a+" L "+e+" "+(t-a)+" A "+a+" "+a+" 0 0 1 "+(e-a)+" "+t+" L "+a+" "+t+" A "+a+" "+a+" 0 0 1 0 "+(t-a)+" Z"}},getProportionedHeight:function(e,t,a,i){if("line"===i)return 2*a*r;var r=256/e;return Math.round(r*t*10)/10}},LS_GUI={updateIconPicker:function(e,t){let a,i=!1;if("string"==typeof e&&(e=jQuery('lse-icon-picker[data-prop="'+e+'"]')),t&&-1!==t.indexOf("<")&&-1!==t.indexOf(">")){try{a=jQuery(t)}catch(e){}a&&a.is("i.fa,svg")&&(i=!0)}e.parent()[i?"addClass":"removeClass"]("lse-has-icon"),e.html(i?t:"")},updateColorPicker:function(e,t,a){void 0!==e&&("string"==typeof e&&(e=jQuery('input[name="'+e+'"]')),t=t||e.val()||"transparent",a=a||{type:"",color:t},e.parent()["transparent"!==t?"addClass":"removeClass"]("lse-has-color"),e.css("background",t).val(t).data("color",a))},updateImagePicker:function(e,t,a){if(a=a||{},"string"==typeof e&&(e=jQuery('lse-image-input[data-prop="'+e+'"]')),"useCurrent"===t){var i=e.css("background-image");i=i?i.slice(4,-1).replace(/["']/g,""):"",t=e.data("image-url")||i}t&&-1!==t.indexOf("blank.gif")&&(a.fromPost||(t=!1));var r=t||lsTrImgPath+"/blank.gif";e.css("background-image",'url("'+r+'")').data("image-url",r),LayerSlider.setActiveLayerMedia()},updateLinkPicker:function(e){if("string"==typeof e&&(e=jQuery('input[name="'+e+'"]')),e.length){var t,a=e.closest(".lse-link-fields"),i=e.attr("name"),r=e.val(),s=a.closest("lse-slide-settings").length?LS_activeSlideData.properties:LS_activeLayerDataSet[0],l=a.find('input[name="linkId"]'),n=a.find('input[name="linkName"]'),o=a.find('input[name="linkType"]'),d=l.val(),c=n.val(),u=o.val();if((c=jQuery("<textarea>").html(c).text())&&(d&&"#"===d.substr(0,1)||r&&"#"===r.substr(0,1))){var p=LS_l10n.SBLinkSmartAction.replace("%s",c);a.addClass("lse-has-link"),d.length||l.val(r),e.val(p).prop("disabled",!0)}else d&&"[post-url]"===d||r&&"[post-url]"===r?(a.addClass("lse-has-link"),e.val(LS_l10n.SBLinkPostDynURL).prop("disabled",!0),l.val("[post-url]")):d&&c&&u?(t="SBLinkText"+ucFirst(u),a.addClass("lse-has-link"),e.val(LS_l10n[t].replace("%s",c)).prop("disabled",!0)):(a.removeClass("lse-has-link"),e.prop("disabled",!1));s[i]=e.val(),s.linkId=l.val(),s.linkName=n.val(),s.linkType=o.val()}},deeplinkSection:function(){var e=document.location.hash.replace("#",""),t=jQuery('[data-deeplink="'+e+'"]');t.length&&(t.closest("#lse-project-settings-sidebar").length?LayerSlider.openSliderSettings(t.index()):t.click())}},LS_UndoManager={index:-1,stack:[],limit:50,add:function(e,t,a,i){this.stack.splice(this.index+1,this.stack.length-this.index),this.index=this.stack.length-1,this.stack.length>this.limit&&this.stack.shift(),LS_activeSlideData.hasOwnProperty("history")||(LS_activeSlideData.history=[]),this.prepareUpdateInfo(a);let r={cmd:e,name:t,updateInfo:a};i&&(r.prop=i),this.stack.push(r),this.index=this.stack.length-1,this.maintainButtons(),lsSetEditorDirtyState(!0)},update:function(){LS_activeSlideData.hasOwnProperty("history")||(LS_activeSlideData.history=[]),this.stack=LS_activeSlideData.history,this.index=this.stack.length-1,LS_activeSlideData.meta&&LS_activeSlideData.meta.undoStackIndex&&(this.index=LS_activeSlideData.meta.undoStackIndex),this.maintainButtons()},merge:function(e,t,a,i){var r=this.stack[this.stack.length-1];!r||i&&!r.prop||i&&i!==r.prop?this.add(e,t,a,i):jQuery.each(r.updateInfo,(function(e,t){jQuery.extend(!0,t.redo,a[e].redo)}))},empty:function(){LS_activeSlideData.history=[],LS_activeSlideData.meta&&LS_activeSlideData.meta.undoStackIndex&&(LS_activeSlideData.meta.undoStackIndex=-1),this.update()},undo:function(){this.stack[this.index]&&(this.execute("undo",this.stack[this.index],this.stack[this.index-1]),this.index--,this.maintainButtons())},redo:function(){this.stack[this.index+1]&&(this.index++,this.execute("redo",this.stack[this.index],this.stack[this.index+1]),this.maintainButtons())},jumpTo:function(e){var t=this.stack.length-(e+1);if(this.index!==t)if(this.index>t)for(;this.index>t;)this.undo();else for(;this.index<t;)this.redo()},prepareUpdateInfo:function(e){e&&"object"==typeof e&&jQuery.each(e,(function(t,a){if("object"==typeof a&&null!==a)return LS_UndoManager.prepareUpdateInfo(a),!0;void 0===a&&(e[t]=null)}))},maintainList:function(){var e=jQuery("#lse-history-list");LS_UndoManager.index;e.find("lse-button:not(.lse-protected)").remove(),jQuery.each(LS_UndoManager.stack,(function(t,a){let i=LS_l10n.history[a.name]?LS_l10n.history[a.name].icon:LS_l10n.history.GENERAL.icon;title=LS_l10n.history[a.name]?LS_l10n.history[a.name].title:a.name,e.prepend(`\n\t\t\t\t\t<lse-button>\n\t\t\t\t\t\t${i}\n\t\t\t\t\t\t<lse-text>${title}</lse-text>\n\t\t\t\t\t</lse-button>\n\t\t\t\t`)}))},maintainButtons:function(e){this.maintainList();var t=jQuery("#lse-history-undo"),a=jQuery("#lse-history-redo"),i=jQuery("#lse-history-list"),r=LS_UndoManager.stack.length-(LS_UndoManager.index+1);LS_activeSlideData.meta.undoStackIndex=this.index,-1!==this.index?t.removeClass("lse-disabled"):t.addClass("lse-disabled"),this.index<this.stack.length-1?a.removeClass("lse-disabled"):a.addClass("lse-disabled"),i.find("lse-button").eq(r).addClass("lse-selected").siblings().removeClass("lse-selected")},execute:function(e,t,a){var i=[];"object"===jQuery.type(t.updateInfo)&&(t.updateInfo=[t.updateInfo]);for(var r=0;r<t.updateInfo.length;r++)this.executeItem(t.cmd,t.updateInfo[r].itemIndex,t.updateInfo[r][e],t.updateInfo[r]),i.push(t.updateInfo[r].itemIndex);this.restoreSelection(e,i,a),lsSetEditorDirtyState(!0)},restoreSelection:function(e,t,a){if(a&&"undo"===e){var i=[];"object"===jQuery.type(a.updateInfo)&&(a.updateInfo=[a.updateInfo]);for(var r=0;r<a.updateInfo.length;r++)i.push(a.updateInfo[r].itemIndex)}JSON.stringify(i||t)!==JSON.stringify(LS_activeLayerIndexSet)&&(LS_activeSlideData.sublayers.length-1<Math.max.apply(Math,i||t)?LayerSlider.selectLayer([LS_activeSlideData.sublayers.length-1]):LayerSlider.selectLayer(i||t))},executeItem:function(e,t,a,i){switch(e){case"slide.general":this.updateOptions(LS_activeSlideData.properties,t,a,"slide"),LayerSlider.updateSlidePreviews(),LayerSlider.updateSlideInterfaceItems(),LayerSlider.generatePreview();break;case"slide.layers":if(!jQuery.isEmptyObject(a.data))return void LayerSlider.addLayer(a.data,t,{histroyEvent:!0});LayerSlider.removeLayer(t,{histroyEvent:!0,requireConfirmation:!1}),LS_DataSource.buildLayersList(),LayerSlider.generatePreview();break;case"layer.order":LS_Utils.moveArrayItem(LS_activeSlideData.sublayers,a.from,a.to),LS_DataSource.buildLayersList(),LayerSlider.generatePreview();break;case"layer.general":this.updateOptions(LS_activeSlideData.sublayers[t],t,a),LayerSlider.updateLayerInterfaceItems(t),LayerSlider.generatePreviewItem(t),LayerSlider.updatePreviewSelection();break;case"layer.transition":this.updateOptions(LS_activeSlideData.sublayers[t].transition,t,a),LayerSlider.updateLayerInterfaceItems(t),LayerSlider.generatePreviewItem(t);break;case"layer.style":this.updateOptions(LS_activeSlideData.sublayers[t].styles,t,a),LayerSlider.updateLayerInterfaceItems(t),LayerSlider.generatePreviewItem(t),LayerSlider.updatePreviewSelection()}},updateOptions:function(e,t,a,i){var r="slide"===(i=i||"layers")?"lse-slide-settings":"lse-layer-settings";jQuery.each(a,(function(s,l){if("object"==typeof l&&null!==l&&!l.angle&&!l.stops)return LS_UndoManager.updateOptions(e[s],t,a[s],i),!0;if(null==l?(delete e[s],l=""):e[s]=l,a[s+"Data"]&&(e[s+"Data"]=a[s+"Data"]),"slide"===i||1==LS_activeLayerIndexSet.length&&t==LS_activeLayerIndexSet[0]){let e=jQuery(r+' [name="'+s+'"]'),t=e.attr("type"),a=e.data("default");"number"===t&&(l=parseFloat(l)||""),l||!1===l||(l=a),e.is(":checkbox")?e.prop("checked",Boolean(l)).data("value",Boolean(l)):e.is("input,textarea")?(e.is('input[type="range"],input[type="hidden"]')||e.closest(".lse-color-input").length||(l=l==a?"":l),e.val(l).data("value",l)):e.is("select")&&(e.children().prop("selected",!1),e.children('[value="'+l+'"]').prop("selected",!0),e.data("value",l)),e.trigger("input",{undoManagerAction:!0}).trigger("keyup",{undoManagerAction:!0})}}))},saveOriginalInputValues:function(e){var t=[],a=null,i=e.attr("name"),r=e.is(":checkbox")?!e.prop("checked"):e.val();e.data("prevVal",r),e.closest("lse-layer-settings").length&&(e.hasClass("lse-transition-prop")?a="transition":e.hasClass("lse-style-prop")&&(a="styles"),jQuery.each(LS_activeLayerDataSet,(function(e,r){var s=r;a&&(s=s[a]),t.push(s[i])})),e.data("prevVal",t))},trackInputs:function(e,t){if(!(e=e||{type:"change"}).undoManagerAction){var a,i,r,s=jQuery(t);if(s.attr("name"))if("change"===e.type.toLowerCase()){if(!s.hasClass("lse-color-picker-input")&&!s.data("lse-undomanager-exclude")&&!s.closest(".lse-undomanager-exclude").length){if(s.closest("lse-layer-settings").length)a="layer.general",i="LAYER_SETTINGS",r=LS_activeLayerIndexSet[0],"html"===s.attr("name")?i="LAYER_CONTENT":s.hasClass("lse-transition-prop")?("transition",a="layer.transition",i="LAYER_TRANSITION"):s.hasClass("lse-style-prop")&&("styles",a="layer.style",i="LAYER_STYLES");else{if(!s.closest("lse-slide-settings").length)return!0;a="slide.general",i="SLIDE_SETTINGS",r=LS_activeSlideIndex}var l=[],n=s.attr("name"),o=s.is(":checkbox")?s.prop("checked"):s.val(),d=s.is(":checkbox")?!s.prop("checked"):s.data("prevVal"),c=s.hasClass("lse-undomanager-merge")?"merge":"add",u="merge"===c?s.data("prop"):"";if(!n)return!1;if("object"==typeof d)jQuery.each(LS_activeLayerIndexSet,(function(e,t){var a={},i={};a[n]=d[e],i[n]=o,"gradient"===s.data("type")&&(a[n+"Data"]=s.data("prevColor"),i[n+"Data"]=s.data("color")),d[e]!==o&&l.push({itemIndex:t,undo:a,redo:i})}));else if(d!==o){var p={},y={};p[n]=d,y[n]=o,l.push({itemIndex:r,undo:p,redo:y})}l.length&&LS_UndoManager[c](a,i,l,u)}}else this.saveOriginalInputValues(s)}}},LayerSlider={uploadInput:null,dragIndex:0,timeout:0,mediaCheckTimeout:0,isSlidePreviewActive:!1,isLayerPreviewActive:!1,selectableTimeout:0,isEmptyProject:function(e){var t=!0;return!lsSliderData.properties.backgroundimage&&(!lsSliderData.properties.backgroundcolor&&(jQuery.each(window.lsSliderData.layers,(function(a,i){return jQuery.trim(i.properties.background)||jQuery.trim(i.properties.bgcolor)?(t=!1,!1):(jQuery.each(i.sublayers,(function(e,a){if("img"===a.media){if(a.image)return t=!1,!1}else{if(a.html)return t=!1,!1;if(a.styles.width||a.styles.height){if(a.styles.background)return t=!1,!1;if(a.styles["background-color"])return t=!1,!1;if(a.layerBackground)return t=!1,!1;if(a.styles["border-top"]||a.styles["border-right"]||a.styles["border-bottom"]||a.styles["border-left"])return t=!1,!1}}})),(!e||e!==a+1)&&void 0)})),t))},selectSettingsTab:function(e){var t=jQuery(e),a=(t.index(),t.data("deeplink"));return t.hasClass("lse-callbacks-tab")?(kmw.modal.close(),setTimeout((()=>{LayerSlider.openEventCallbacks()}),500),!1):!t.hasClass("lse-locked")&&void 0===t.data("lse-locked")&&void(document.location.hash=a)},switchSliderSettingsTab:function(e){jQuery("#lse-project-settings-sidebar kmw-menuitem").eq(e).click()},highlightOptionRow:function(e){let t=e.find("td"),a=e.closest("lse-table-wrapper"),i=e.position().top,r=a.position().top;e.closest(".lse-scrollbar").scrollTop(r+i-100),t.addClass("lse-highlight-item"),setTimeout((function(){t.removeClass("lse-highlight-item")}),1e3)},openSliderSettings:function(e){LS_sliderSettingsOpened?void 0!==e&&jQuery("#lse-project-settings-sidebar kmw-menuitem").eq(e).click():kmw.modal.open({content:jQuery("#lse-project-settings-content"),clip:!0,minWidth:400,maxHeight:"90%",maxWidth:1400,sidebar:{left:{width:300,customHeaderHeight:!0,content:jQuery("#lse-project-settings-sidebar")}},onBeforeOpen:function(){LS_sliderSettingsOpened=!0,void 0!==e&&jQuery("#lse-project-settings-sidebar kmw-menuitem").eq(e).click(),LayerSlider.isEmptyProject()?jQuery(".lse-popup-preview-button").addClass("lse-inactive").attr({"data-tt":"","data-tt-de":.1}):jQuery(".lse-popup-preview-button").removeClass("lse-inactive").removeAttr("data-tt data-tt-de")},onClose:function(){LS_sliderSettingsOpened=!1,history.replaceState(null,document.title,window.location.href.replace(/#.*$/,""))}})},openEventCallbacks:function(){LS_callbackSettingsOpened||kmw.modal.open({content:"#tmpl-callback-events-modal",maxWidth:1800,maxHeight:"100%",sidebar:{left:{width:300,customHeaderHeight:!0,content:"#tmpl-callback-events-modal-sidebar"}},onBeforeOpen:function(){LS_callbackSettingsOpened=!0,document.location.hash="callbacks";var e=window.lsSliderData.callbacks||{};jQuery(".lse-callback-box textarea").each((function(){var t=jQuery(this),a=t.attr("name"),i=e[a]||"",r=jQuery("#lse-callback-events-sidebar").find("lse-li:contains('"+a+"')");if(e&&e[a]){t.val(LS_Utils.stripslashes(e[a])),r.addClass("lse-active");var s=i.indexOf("{")+1,l=i.length-1;body=i.substring(s,l);try{new Function(body)}catch(e){r.addClass("lse-warning")}}})),LS_CodeMirror.init({mode:"javascript",autofocus:!1,styleActiveLine:!1})},onClose:function(){history.replaceState(null,document.title,window.location.href.replace(/#.*$/,"")),LS_callbackSettingsOpened=!1}})},openSlideOptions:function(){jQuery("#lse-toolbar-sidebar-tabs lse-button:eq(0)").click()},addSlide:function(e,t){var a={atIndex:window.lsSliderData.layers.length,selectSlide:!0,closeSlidesPanel:!0,showSlideOptions:!1,focusInput:!1};t=jQuery.extend(!0,a,t);var i=!!e;e||(e={properties:e=jQuery.extend(!0,{},LS_DataSource.getDefaultSlideData()),sublayers:[]});window.lsSliderData.layers.splice(t.atIndex,0,e);var r=jQuery(jQuery("#tmpl-slide-tab").text()).appendToWithIndex("#lse-slide-tabs",t.atIndex);i&&e.properties.title&&r.find(".lse-slide-name input").val(e.properties.title),i&&e.properties.skip&&r.addClass("lse-skip"),LayerSlider.updateSlidePreviews(),LayerSlider.addSlideSortables(),lsSetEditorDirtyState(!0),TweenLite.fromTo(r[0],.4,{scale:0},{scale:1,onComplete:function(){t.selectSlide&&(LayerSlider.selectSlide(r.index(),{closeSlidesPanel:t.closeSlidesPanel,forceSelect:!0}),t.showSlideOptions&&jQuery("#lse-show-slide-settings").triggerHandler("click")),t.focusInput&&r.find("input").focus()}})},removeSlide:function(e){if(confirm(LS_l10n.SBRemoveSlide)){var t=LS_activeSlideIndex,a=jQuery("#lse-slide-tabs .lse-slide-tab").eq(t);e&&(a=jQuery(e).closest(".lse-slide-tab"));var i,r=null,s=a.index();a.next(".lse-slide-tab").length>0?r=a.next():a.prev().length>0&&(r=a.prev()),i=window.lsSliderData.layers.length-1<1?0:.4,TweenLite.to(a[0],i,{scale:0,ease:Power1.easeIn,onComplete:function(){setTimeout((function(){if(a.remove(),window.lsSliderData.layers.splice(s,1),lsSetEditorDirtyState(!0),window.lsSliderData.layers<1)return LayerSlider.addSlide(!1,{showSlideOptions:!0,selectSlide:!0}),!0;r&&LS_activeSlideIndex===s&&LayerSlider.selectSlide(r.index(),{closeSlidesPanel:!1,forceSelect:!0})}),30)}})}},selectSlide:function(e,t){if(t=t||{},!(t=jQuery.extend({},{closeSlidesPanel:!0},t)).forceSelect&&LS_activeSlideIndex===e)return!1;jQuery("#lse-slide-tabs").children().eq(e).addClass("lse-active").siblings().removeClass("lse-active"),lsEditor.revisions.isActive||lsEditor.preview.exit(),t.closeSlidesPanel&&lsEditor.slidesList.close(),LS_activeSlideIndex=e,(LS_activeSlideData=window.lsSliderData.layers[e]).meta||(LS_activeSlideData.meta={});var a=jQuery.extend(!0,{},LS_DataSource.getDefaultSlideData());LS_activeSlideData.properties=jQuery.extend(!0,a,LS_activeSlideData.properties),LS_activeLayerIndexSet=LS_activeSlideData.meta.activeLayers||[],LS_lastSelectedLayerIndex=LS_activeLayerIndexSet[0],LS_activeStaticLayersDataSet=LayerSlider.staticLayersForSlide(e),LS_DataSource.buildSlide(),LayerSlider.updateSlideInterfaceItems(),LayerSlider.generatePreview(),LayerSlider.selectLayer(LS_activeLayerIndexSet,{forceSelect:!0}),LayerSlider.updatePreviewSelection(),LS_UndoManager.update()},renameSlide:function(e){var t=jQuery(e),a=t.closest(".lse-slide-tab");window.lsSliderData.layers[a.index()].properties.title=t.val()},duplicateSlide:function(e){var t=LS_activeSlideIndex;e&&(t=jQuery(e).closest(".lse-slide-tab").index());var a=window.lsSliderData.layers[t],i=jQuery.extend(!0,{},a);i.properties.uuid=LS_DataSource.generateUUID(),jQuery.each(i.sublayers,(function(e,t){t.uuid=LS_DataSource.generateUUID()})),i.properties.title&&(i.properties.title+=" copy"),LayerSlider.addSlide(i,{atIndex:t+1,selectSlide:!0,focusInput:!0,closeSlidesPanel:!1})},setSVGDimensionAttributes:function(){LS_previewArea.find("svg").each((function(){var e=jQuery(this);e.attr({width:e.css("width"),height:e.css("height")})}))},clearSVGDimensionAttributes:function(){LS_previewArea.find("svg").removeAttr("width height")},captureSlide:function(){lsEditor.notify.show({icon:"camera",text:LS_l10n.notifyCaptureSlide}),LayerSlider.hidePreviewSelection(),jQuery(".ls-gui-element:visible").addClass("ls-hidden"),LayerSlider.setSVGDimensionAttributes(),setTimeout((function(){var e=LayerSlider.isSlidePreviewActive?jQuery("#lse-preview-timeline"):LS_previewHolder;html2canvas(e[0],{scale:2}).then((function(e){var t,a,i,r=e.width,s=e.height,l=1280;(r>l||s>720)&&(i=r/s,r>s?(t=l,a=l/i):(t=720*i,a=720),e=LS_Utils.resizeCanvas(e,t,a)),LayerSlider.showPreviewSelection(),LayerSlider.clearSVGDimensionAttributes(),jQuery(".ls-gui-element.ls-hidden").removeClass("ls-hidden");var n="ls-project-"+LS_sliderID+"-slide-"+(LS_activeSlideIndex+1)+".png",o=e.toDataURL("image/jpeg",.92),d=LS_Utils.dataURItoBlob(o,"image/jpeg");d.lastModifiedDate=new Date,d.name=n,d.filename=n,LayerSlider.uploadImageToMediaLibrary(d,(function(e){LS_activeSlideData.properties.thumbnail=e.url,LS_activeSlideData.properties.thumbnailId=e.id,LS_activeSlideData.properties.thumbnailThumb=e.url,LS_GUI.updateImagePicker("thumbnail",e.url),LayerSlider.updateSlidePreviews(),lsSetEditorDirtyState(!0),lsEditor.notify.hide()}))}))}),1e3)},toggleSlideVisibility:function(e){var t=LS_activeSlideIndex,a=jQuery("#lse-slide-tabs .lse-slide-tab").eq(t);e&&(a=jQuery(e).closest(".lse-slide-tab"));var i=window.lsSliderData.layers[a.index()];i.properties.skip?(i.properties.skip=!1,a.removeClass("lse-skip")):(i.properties.skip=!0,a.addClass("lse-skip"))},setCustomSlideProperties:function(e){e.originalEvent&&lsSetEditorDirtyState(!0);var t=LS_activeSlideData.properties.customProperties={};jQuery(".lse-custom-slide-properties lse-col:not(.lse-placeholder):not(:last)").each((function(){var e=jQuery("input:eq(0)",this),a=jQuery("input:eq(1)",this),i=e.val(),r=a.val();t[i]=r}))},updateCustomSlideProperties:function(){var e=LS_activeSlideData.properties;e.customProperties=e.customProperties||{};var t=LS_activeSlideData.properties.customProperties||{},a=jQuery(".lse-custom-slide-properties");Object.keys(t).sort().forEach((function(e){var a=t[e];delete t[e],t[e]=a})),jQuery("lse-col:not(.lse-placeholder)",jQuery(".lse-custom-slide-properties")).not(":last").remove(),jQuery.each(t,(function(e,t){jQuery("lse-col:last input:eq(0)",a).val(e),jQuery("lse-col:last input:eq(1)",a).val(t).trigger("input."+lsEditor.settings.nameSpace+lsEditor.formRows.nameSpace)}))},addLayer:function(e,t,a){var i,r,s=[],l=[];for(a=a||{selectLayer:!0},r=!e,e=e||jQuery.extend(!0,{},LS_DataSource.getDefaultLayerData()),i=(e=jQuery.makeArray(e)).length,t=!t?[].fill(0,i):t,t=jQuery.makeArray(t);i--;)LayerSlider.autoRenameLayer(null,e[i]),LS_activeSlideData.sublayers.splice(t[i],0,e[i]),s.push(t[i]+i),l.push({itemIndex:t[i],selectIndex:s[i],undo:{data:{}},redo:{data:e[i]}});a.histroyEvent||LS_UndoManager.add("slide.layers",l.length>1?"LAYER_NEW_M":"LAYER_NEW",l),LS_DataSource.buildLayersList(),LayerSlider.generatePreview(),a.selectLayer&&(LayerSlider.selectLayer(s,{forceSelect:!0}),r&&1===l.length&&jQuery("#lse-layers-list  lse-li.lse-active .lse-layer-title").focus().select())},autoRenameLayer:function(e,t){if((t=t||LS_activeSlideData.sublayers[e]).autoSubtitle){switch(t.media){case"img":if(t.image){var a=LS_Utils.beautifyFileName(t.image);t.subtitle=a||LS_l10n.SBLayerTypeImg}else t.subtitle=LS_l10n.SBLayerTypeImg;break;case"icon":if(t.html){var i,r=jQuery(t.html),s=r.attr("class"),l=s?s.replace("fa fa-",""):"";i=(i=(i=r.data("name"))||l)||LS_l10n.SBLayerTypeIcon,t.subtitle=LS_Utils.beautifyFileName(i)}break;case"shape":t.subtitle=LS_l10n.SBLayerTypeShape;break;case"svg":t.subtitle=LS_l10n.SBLayerTypeSVG;break;case"media":t.subtitle=LS_l10n.SBLayerTypeMedia;break;default:var n=t.html,o=t.subtitle,d=n;if(n&&"<"===n[0])try{d=jQuery(n).text()||d}catch(e){}d||(d=t.media.charAt(0).toUpperCase()+t.media.slice(1)),d&&o!=d&&(d=(d=d.replace(/\&nbsp\;/g," ")).substr(0,30),t.subtitle=d)}jQuery.isNumeric(e)&&LS_DataSource.buildLayersListItem(e)}},addFormattedLayer:function(e,t){var a,i="string"==typeof e?e:jQuery(e).data("type");if("import"!==i)if("shape-modal"!==i)if("svg-modal"!==i)if("icon-modal"!==i){switch((a=jQuery.extend(!0,{},LS_DataSource.getDefaultLayerData())).media=i,-1!==["text","html","post"].indexOf(i)&&jQuery.extend(a.styles,{"font-size":24}),i){case"text":a.html=LS_l10n.SBPreviewTextPlaceholder,jQuery.extend(a.styles,{"font-size":36});break;case"html":a.html=LS_l10n.SBPreviewHTMLPlaceholder,jQuery.extend(a.styles,{"font-size":36});break;case"icon":break;case"shape":jQuery.extend(a.styles,{width:256,height:t.shapeData.proportionedHeight});break;case"svg":jQuery.extend(a.styles,{width:256,height:256});break;case"button":a.html=LS_l10n.SBPreviewButtonPlaceholder,jQuery.extend(a.styles,{"padding-top":"0.75em","padding-bottom":"0.75em","padding-right":"3em","padding-left":"3em","font-family":"Arial, sans-serif","font-size":16,"font-weight":700,"background-color":"#4071e4",color:"#fff","border-radius":"10em",cursor:"pointer"});break;case"post":a.html=LS_l10n.SBPreviewPostPlaceholder,jQuery.extend(a.styles,{"font-size":36})}t&&jQuery.extend(!0,a,t),LayerSlider.addLayer(a,null,{selectLayer:!0}),"media"===i?LS_InsertMedia.open():"img"===i?jQuery(".lse-layer-image").click():"button"===i&&LS_ButtonLibrary.open(),jQuery("#lse-show-layer-settings").click(),jQuery("lse-layer-settings lse-subnav-item.lse-layer-content-tab").click()}else LS_IconLibrary.open({createLayer:!0});else LS_SVGChooser.open();else LS_ShapeChooser.open();else setTimeout((function(){LS_ImportLayer.open()}),300)},selectLayer:function(e,t){if(!LS_activeSlideData.sublayers.length)return jQuery("lse-layers-list lse-sidebar-content").addClass("lse-no-layers"),jQuery("lse-layer-settings").addClass("lse-disabled"),!1;if(jQuery("lse-layers-list lse-sidebar-content").removeClass("lse-no-layers"),jQuery("lse-layer-settings").removeClass("lse-disabled"),!e||!e.length)return!1;if(null==e[0])return!1;if(!(LS_activeSlideData.sublayers.length-1<Math.max.apply(Math,e))){if(!(t=t||{}).forceSelect&&e.length==LS_activeLayerIndexSet.length&&e.every((function(e,t){return e===LS_activeLayerIndexSet[t]})))return!1;var a=jQuery("#lse-layers-list lse-li")
;if(lsEditor.revisions.isActive||lsEditor.preview.exit(),LS_activeLayerIndexSet=[],LS_activeLayerDataSet=[],a.removeClass("lse-active"),jQuery("lse-preview-area > *").removeClass("ui-selected"),jQuery.each(e,(function(e,t){if(LS_activeLayerIndexSet.push(t),LS_activeLayerDataSet.push(LS_activeSlideData.sublayers[t]),LS_previewItems[t]){let e=LS_activeSlideData.sublayers[t];e&&(e.locked||e.skip||e.transition?.backgroundvideo)?LS_previewItems[t].removeClass("ui-selected"):LS_previewItems[t].addClass("ui-selected")}a.eq(t).addClass("lse-active")})),jQuery.each(LS_activeLayerDataSet,(function(e,t){t.meta||(t.meta={})})),LS_activeLayerIndexSet.length>1?LayerSlider.startMultipleSelection():LayerSlider.stopMultipleSelection(),1===LS_activeLayerIndexSet.length&&(LS_DataSource.buildLayer(),LS_lastSelectedLayerIndex=LS_activeLayerIndexSet[0]),LS_Utils.removeTextSelection(),LayerSlider.updatePreviewSelection(),LS_activeSlideData.meta.activeLayers=LS_activeLayerIndexSet,jQuery("lse-layers-list lse-sidebar-content").removeClass("lse-no-layers"),1===LS_activeLayerIndexSet.length){let e=a.closest("lse-sidebar-content"),t=e.height(),i=e.scrollTop(),r=a.eq(LS_activeLayerIndexSet),s=r.outerHeight(!0),l=r.position().top;t<l+s?e.scrollTop(l+s-t+i):l-s<0&&e.scrollTop(i+l-s)}}},startMultipleSelection:function(){LS_multipleSelection=!0;var e=jQuery("lse-layer-settings"),t=jQuery("lse-subnav-item.lse-layer-content-tab",e),a=jQuery("lse-subnav-item.lse-layer-style-tab",e),i=jQuery("lse-subnav-item.lse-layer-actions-tab",e);t.hasClass("lse-active")&&a.click(),i.hasClass("lse-active")&&a.click(),$lsE.addClass("lse-multiple-selection");let r=jQuery("input,textarea",e).filter(".lse-transition-prop, .lse-style-prop");r=r.add(jQuery(".lse-layer-common-attributes lse-col input:last-child")),r=r.add(jQuery('input[name="url"]',e));let s=jQuery("select:not(.lse-multi-selected)",e);s=s.add(jQuery('select[name="target"]:not(.lse-multi-selected)',e));let l=jQuery(":checkbox",e);r.val(""),s.addClass("lse-multi-selected").prepend("<option></option>").children().prop("selected",!1).eq(0).prop("selected",!0),l.prop("indeterminate",!0).data("indeterminate",!0),jQuery("lse-image-input",e).css("background-image","none"),jQuery(".lse-color-input input",e).css("background","transparent"),jQuery("#lse-transition-dropdown .lse-enabled").removeClass("lse-enabled"),jQuery("#lse-transition-tabs lse-sidebar-section.lse-disabled").removeClass("lse-disabled"),jQuery(".lse-layer-custom-attributes lse-col:not(.lse-placeholder):not(:last)").remove()},stopMultipleSelection:function(){LS_multipleSelection=!1;var e=jQuery("lse-layer-settings");$lsE.removeClass("lse-multiple-selection"),jQuery("select.lse-multi-selected",e).removeClass("lse-multi-selected").children(":first-child").remove(),jQuery(":checkbox",e).prop("indeterminate",!1).data("indeterminate",!1)},enableTransitionPage:function(e){LayerSlider.reorderTransitionProperties(jQuery(e).closest("lse-sidebar-section").index())},reorderTransitionProperties:function(e){let t=jQuery("#lse-transition-tabs").children();void 0!==e&&(t=t.eq(e)),t.each((function(){let e=jQuery(this),t=e.index(),a=e.find(".lse-layer-transition-checkbox"),i=a.attr("name"),r=e.find(":input.lse-transition-prop[name]"),s=jQuery("#lse-transition-dropdown lse-li").eq(t),l=a.data("indeterminate"),n=[],o="LAYER_TRANSITION";r=r.not(a).not('[name=""],[name="static"],[name="keyframe"]'),jQuery.each(LS_activeLayerIndexSet,(function(t,d){let c=LS_activeSlideData.sublayers[d],u={},p={};a.prop("checked")||l?(l&&a.prop("checked",!0).data("indeterminate",!1),1===LS_activeLayerIndexSet.length&&s.addClass("lse-enabled"),e.removeClass("lse-disabled"),o="ENABLE_LAYER_TRANSITION",u[i]=c.transition[i],p[i]=!0,c.transition[i]=!0,r.each((function(){var e=jQuery(this),t=e.attr("name"),a=e.data("default");void 0===c.transition[t]&&(u[t]=c.transition[t],p[t]=a,c.transition[t]=a)})),n.push({itemIndex:d,redo:p,undo:u})):(1===LS_activeLayerIndexSet.length&&s.removeClass("lse-enabled"),e.addClass("lse-disabled"),o="DISABLE_LAYER_TRANSITION",u[i]=c.transition[i],p[i]=!1,c.transition[i]=!1,r.each((function(){var e=jQuery(this),t=e.attr("name"),a=e.is(":checkbox")?e.prop("checked"):e.val();e.data("value",a),u[t]=c.transition[t],p[t]=null,delete c.transition[t]})),n.push({itemIndex:d,redo:p,undo:u}))})),n.length&&LS_UndoManager.add("layer.transition",o,n),1===LS_activeLayerDataSet.length&&LS_DataSource.setFormItemValues(r,LS_activeLayerDataSet[0].transition)}))},removeLayer:function(e,t){if(t=t||{},(t=jQuery.extend({},{requireConfirmation:!0},t)).requireConfirmation&&!confirm(LS_l10n.SBRemoveLayer))return!1;e||0===e?"number"==typeof e&&(e=[e]):e=LS_activeLayerIndexSet;for(var a,i,r,s,l=e.length,n=jQuery("#lse-layers-list lse-li"),o=[];l--;)r=e[l],a=n.eq(r),s=jQuery.extend(!0,{},LS_activeSlideData.sublayers[r]),a.next().length>0?i=a.next():a.prev().length>0&&(i=a.prev()),o.push({itemIndex:r,undo:{data:s},redo:{data:{}}}),LS_activeSlideData.sublayers.splice(r,1),a.remove();LS_activeSlideData.sublayers.length?i.length&&((LS_activeLayerIndexSet.length>1||LS_activeLayerIndexSet[0]===e[0])&&LayerSlider.selectLayer([i.index()],{forceSelect:!0}),LayerSlider.reindexLayers()):(jQuery("lse-layer-settings").addClass("lse-disabled").removeClass("lse-multiple-selection"),jQuery("lse-layers-list lse-sidebar-content").addClass("lse-no-layers"),LS_activeLayerIndexSet=[]),LayerSlider.generatePreview(),LayerSlider.updatePreviewSelection(),!t.histroyEvent&&o.length&&LS_UndoManager.add("slide.layers","LAYER_DELETE",o)},hideLayer:function(e,t){t=t||{},t=jQuery.extend({},{allSelected:!0,mirrorSettings:!1},t),$button=jQuery(e);var a,i,r,s=LS_activeLayerIndexSet,l=LS_activeLayerDataSet,n=[];$button.length&&(!t.allSelected||s.length<2)&&(s=[$button.closest("lse-li").index()],l=[LS_activeSlideData.sublayers[s[0]]]),$button.length&&t.mirrorSettings&&s.length>1&&(a=!$button.hasClass("lse-hidden")),jQuery.each(s,(function(e,t){i=l[e],r=jQuery("#lse-layers-list .lse-hide-layer").eq(t),n.push({itemIndex:t,undo:{skip:!!i.skip},redo:{skip:void 0!==a?a:!i.skip}}),i.skip=void 0!==a?a:!i.skip,i.skip?r.addClass("lse-hidden"):r.removeClass("lse-hidden"),LayerSlider.updatePreviewSelection(),LayerSlider.generatePreviewItem(t)})),LS_UndoManager.add("layer.general","LAYER_HIDE",n)},lockLayer:function(e,t){t=t||{},t=jQuery.extend({},{allSelected:!0,mirrorSettings:!1},t),$button=jQuery(e);var a,i,r,s,l=LS_activeLayerIndexSet,n=LS_activeLayerDataSet,o=[];$button.length&&(!t.allSelected||l.length<2)&&(l=[jQuery($button).closest("lse-li").index()],n=[LS_activeSlideData.sublayers[l[0]]]),$button.length&&t.mirrorSettings&&l.length>1&&(i=!$button.hasClass("lse-locked")),jQuery.each(l,(function(e,t){a=n[e],r=LayerSlider.previewItemAtIndex(t),s=jQuery("#lse-layers-list .lse-lock-layer").eq(t),o.push({itemIndex:t,undo:{locked:!!a.locked},redo:{locked:void 0!==i?i:!a.locked}}),a.locked=void 0!==i?i:!a.locked,a.locked?(s.addClass("lse-locked"),r.addClass("lse-disabled").draggable("disable")):(s.removeClass("lse-locked"),r.removeClass("lse-disabled").draggable("enable")),LayerSlider.updatePreviewSelection(),LayerSlider.generatePreviewItem(t)})),LS_UndoManager.add("layer.general","LAYER_LOCK",o)},setActiveLayerMedia:function(){jQuery.each(LS_activeLayerIndexSet,(function(e,t){let a=LS_activeSlideData.sublayers[t];a&&LayerSlider.setLayerMedia(a.media,jQuery("#lse-layers-list lse-li:eq("+t+") .lse-layer-thumb"),a)}))},setLayerMedia:function(e,t,a){var i=jQuery();try{i=jQuery(a.html)}catch(e){}switch(e){case"img":a.imageThumb?t.html("").removeClass("lse-layer-bg").css("background-image","url("+(a.imageThumb||pluginPath+"admin/img/blank.gif")+")"):t.html(LS_InterfaceIcons.layerTypes.img);break;case"html":t.html(LS_InterfaceIcons.layerTypes.html);break;case"button":t.html(LS_InterfaceIcons.layerTypes.button);break;case"shape":t.html(LS_InterfaceIcons.layerTypes.shape),t.css("color",a.styles.color);break;case"svg":t.html(LS_InterfaceIcons.layerTypes.svg);break;case"icon":var r=i.attr("class");r&&-1!==r.indexOf("fa-")?t.addClass(r):t.html(LS_InterfaceIcons.layerTypes.icon),a.styles.color&&t.css("color",a.styles.color);break;case"media":t.html(LS_InterfaceIcons.layerTypes.media);break;case"post":t.html(LS_InterfaceIcons.layerTypes.post);break;default:t.html(LS_InterfaceIcons.layerTypes.text)}if(-1!==["shape","svg","icon","text","html","post"].indexOf(e))if(i.eq(0).is("svg")&&t.html("<ls-icon>"+i[0].outerHTML+"</ls-icon>"),a.html&&a.html.trim().length)t.removeClass("lse-layer-bg").css({"background-image":"none","background-color":"transparent"});else if(a.layerBackgroundThumb)t.html("").css({backgroundColor:"transparent",backgroundImage:'url("'+a.layerBackgroundThumb+'")'});else if(a.styles&&a.styles["background-color"]){let e=-1!==a.styles["background-color"].indexOf("gradient")?"background-image":"background-color";t.css({backgroundImage:"none",backgroundColor:"transparent"}),t.html("").addClass("lse-layer-bg").css(e,a.styles["background-color"])}},setLayerAttributes:function(e){e&&e.originalEvent&&lsSetEditorDirtyState(!0),jQuery.each(LS_activeLayerDataSet,(function(e,t){var a=t.innerAttributes={},i=t.outerAttributes={};jQuery(".lse-layer-custom-attributes lse-col:not(.lse-placeholder):not(:last)").each((function(){var e=jQuery("input:eq(0)",this),t=jQuery("input:eq(1)",this),r=jQuery(":checkbox",this),s=e.val(),l=t.val();s&&/^[a-zA-Z]([a-zA-Z0-9_-]+)$/.test(s)?(e.removeClass("lse-input-invalid"),r.prop("checked")?i[s]=l:a[s]=l):e.addClass("lse-input-invalid")}))}))},updateLayerAttributes:function(e){e.innerAttributes=e.innerAttributes||{},e.outerAttributes=e.outerAttributes||{};var t=jQuery.extend({},e.innerAttributes,e.outerAttributes);Object.keys(t).sort().forEach((function(e){var a=t[e];delete t[e],t[e]=a})),jQuery(".lse-layer-custom-attributes lse-col:not(.lse-placeholder)").not(":last").remove(),jQuery.each(t,(function(t,a){$customAttributes=jQuery(".lse-layer-custom-attributes lse-col:last"),jQuery(":checkbox",$customAttributes).prop("checked",t in e.outerAttributes),jQuery("input:eq(1)",$customAttributes).val(a),jQuery("input:eq(0)",$customAttributes).val(t).trigger("input."+lsEditor.settings.nameSpace+lsEditor.formRows.nameSpace)}))},setLayerActions:function(e){e&&e.originalEvent&&lsSetEditorDirtyState(!0);let t=LS_activeLayerDataSet[0];t.actions=[],jQuery("#lse-layer-actions-list .lse-layer-action:not(.lse-placeholder):not(:last)").each((function(){let e={};jQuery(this).find(":input[name]").each((function(){let t=jQuery(this),a=t.val();jQuery.isNumeric(a)&&(a=parseFloat(a)),t.is(":checkbox")&&(a=t.prop("checked")),e[this.name]=a})),e&&!jQuery.isEmptyObject(e)&&t.actions.push(e)}))},updateLayerActions:function(e){e.actions=e.actions||[],jQuery("#lse-layer-actions-list .lse-layer-action:not(.lse-placeholder)").not(":last").remove(),jQuery.each(e.actions,(function(e,t){jQuery("#lse-layer-actions-list lse-row:last .lse-select-layer-action").val(t.action).trigger("input."+lsEditor.settings.nameSpace+lsEditor.formRows.nameSpace).trigger("change."+lsEditor.settings.nameSpace);let a=jQuery("#lse-layer-actions-list .lse-layer-action:last").prev();jQuery.each(t,(function(e,t){"action"!==e&&a.find(':input[name="'+e+'"]').val(t)}))}))},staticLayersForSlide:function(e){var t=[];return jQuery.each(window.lsSliderData.layers,(function(a,i){jQuery.each(i.sublayers,(function(r,s){if(s.transition.static){var l=s.transition.static;(l>e||"forever"===l)&&a<e&&t.push({slideIndex:a,slideData:i,layerIndex:r,layerData:s})}}))})),t},reindexStaticLayers:function(){jQuery.each(window.lsSliderData.layers,(function(e,t){jQuery.each(t.sublayers,(function(e,t){if(t.transition.staticUUID){var a=LS_DataSource.slideForUUID(t.transition.staticUUID);a&&(t.transition.static=a+1)}}))}))},setupStaticLayersChooser:function(e){var t=jQuery(e);t.children('[value="forever"]').nextAll().remove();for(var a,i=window.lsSliderData,r=i.layers?i.layers.length:0,s='<option value="-2" disabled>–</option>',l=0;l<r;l++)a=(a=i.layers[l].properties.title)?" ("+a+")":"",s+='<option value="'+(l+1)+'">'+LS_l10n.SBStaticUntil.replace("%d",l+1)+" "+a+"</option>";t.append(s);var n=parseInt(LS_activeLayerDataSet[0].transition.static);n&&t.children('[value="'+n+'"]').prop("selected",!0).siblings().prop("selected",!1)},revealStaticLayer:function(e){var t=jQuery(e).closest("lse-li").index(),a=LS_activeStaticLayersDataSet[t];LayerSlider.selectSlide(a.slideIndex),LayerSlider.selectLayer([a.layerIndex],{forceSelect:!0})},duplicateLayer:function(e,t){this.pasteLayer(this.copyLayer(!1,e,t).layers)},copyLayer:function(e,t,a,i){e=e||!0,t=t||LS_activeLayerDataSet,a=a||LS_activeLayerIndexSet,i=i||{shiftLayers:!0};var r=[];return jQuery.each(t,(function(e,t){var a=jQuery.extend(!0,{},t);a.subtitle+=" copy",r.push(a)})),r={layers:r,sliderID:i.sliderID||LS_sliderID,slideIndex:i.slideIndex||LS_activeSlideIndex,layerIndexSet:a},e&&localStorage.setObject("lse-layer-clipboard",r),r},pasteLayer:function(e,t,a){var i,r=!!e,s=localStorage.getObject("lse-layer-clipboard");s?(e=e||s.layers,t=t||s.layerIndexSet,e?(a=a||{},i=s.sliderID!==LS_sliderID||s.slideIndex!==LS_activeSlideIndex?[].fill(0,t.length):[].fill(Math.min.apply(Math,t),t.length),jQuery.each(e,(function(e,t){t.uuid=LS_DataSource.generateUUID()})),LayerSlider.addLayer(e,i,{selectLayer:!0}),r||this.copyLayer(!0,e,t,{sliderID:s.sliderID,slideIndex:s.slideIndex})):alert(LS_l10n.SBPasteLayerError)):alert(LS_l10n.SBPasteLayerError)},selectElementType:function(e,t){t="object"==typeof(t=t||LS_activeLayerIndexSet)?t[0]:t;var a=LS_activeSlideData.sublayers[t],i=jQuery(e).data("element");jQuery(e).addClass("lse-active").siblings().removeClass("lse-active"),i&&(a.type=i)},copyLayerSettings:function(e){var t=jQuery(e),a=t.closest("[data-storage]"),i=a.attr("data-storage"),r={styles:{},transition:{}};a.find(":input").each((function(){if(this.name){var e=jQuery(this),t=e.hasClass("lse-transition-prop")?"transition":"styles";r[t][this.name]=e.is(":checkbox")?e.prop("checked"):e.val()}}));var s=localStorage.getObject("lse-layer-options-clipboard")||{};s[i]={timestamp:Math.floor(Date.now()/1e3),data:r},localStorage.setObject("lse-layer-options-clipboard",s),t.addClass("lse-highlight-button"),setTimeout((function(){t.removeClass("lse-highlight-button")}),1e3)},pasteLayerSettings:function(e){var t=jQuery(e),a=t.closest("[data-storage]"),i=a.attr("data-storage"),r=[],s=(localStorage.getObject("lse-layer-options-clipboard")||{})[i],l=Math.floor(Date.now()/1e3);if(!s||jQuery.isEmptyObject(s.data)||s.timestamp<l-10800)return alert(LS_l10n.SBPasteError),!1;jQuery.each(LS_activeLayerIndexSet,(function(e,t){var l=LS_activeLayerDataSet[e],n={},o={};a.find(":input").each((function(){if(this.name&&"top"!=this.name&&"left"!=this.name){var e=jQuery(this).hasClass("lse-transition-prop")?"transition":"styles",t=l[e];curVal=l[e][this.name],newVal=s.data[e][this.name],"style"===this.name&&(curVal=l[this.name]),curVal!=newVal&&(n[e]||(n[e]={}),o[e]||(o[e]={}),n[e][this.name]=curVal,o[e][this.name]=newVal),"style"===this.name?l.style=newVal:t[this.name]=newVal}})),r.push({itemIndex:t,undo:n,redo:o}),LS_DataSource.buildLayer(),"styles"===i&&LayerSlider.generatePreviewItem(t)})),LS_UndoManager.add("layer.general","LAYER_PASTE_SETTINGS",r),t.addClass("lse-highlight-button"),setTimeout((function(){t.removeClass("lse-highlight-button")}),1e3)},updateProjectInterfaceItems:function(){LS_GUI.updateImagePicker("backgroundimage","useCurrent"),LS_GUI.updateImagePicker("preview","useCurrent"),LS_GUI.updateColorPicker("backgroundcolor",lsSliderData.properties.backgroundcolor,lsSliderData.properties.backgroundcolorData),LS_GUI.updateColorPicker("popupOverlayBackground",lsSliderData.properties.popupOverlayBackground,lsSliderData.properties.popupOverlayBackgroundData)},updateSlideInterfaceItems:function(){var e=LS_activeSlideData.properties,t=e.backgroundThumb||e.background;thumbnailSrc=e.thumbnailThumb||e.thumbnail,LS_GUI.updateImagePicker("background",t),LS_GUI.updateImagePicker("thumbnail",thumbnailSrc),LS_GUI.updateLinkPicker("layer_link"),LS_GUI.updateColorPicker("bgcolor",e.bgcolor,e.bgcolorData),jQuery("input,textarea,select",jQuery("lse-slide-settings")).filter(".lse-restore-prop").trigger("input."+lsEditor.settings.nameSpace)},updateLayerInterfaceItems:function(e){var t=jQuery("lse-layer-settings"),a=jQuery("#lse-layers-list lse-li").eq(e),i=LS_activeSlideData.sublayers[e];if(!i)return;if(LS_GUI.updateImagePicker("image",i.imageThumb||i.image),LS_GUI.updateImagePicker("poster",i.posterThumb||i.poster),LS_GUI.updateImagePicker("layerBackground",i.layerBackgroundThumb||i.layerBackground),LS_GUI.updateColorPicker("color",i.styles.color,i.styles.colorData),LS_GUI.updateColorPicker("iconColor",i.iconColor,i.styles.iconColorData),LS_GUI.updateColorPicker("background-color",i.styles["background-color"],i.styles["background-colorData"]),LS_GUI.updateColorPicker("border-color",i.styles["border-color"],i.styles["border-colorData"]),LS_GUI.updateColorPicker("colorin",i.transition.colorin,i.transition.colorinData),LS_GUI.updateColorPicker("bgcolorin",i.transition.bgcolorin,i.transition.bgcolorinData),LS_GUI.updateColorPicker("colorout",i.transition.colorout,i.transition.coloroutData),LS_GUI.updateColorPicker("bgcolorout",i.transition.bgcolorout,i.transition.bgcoloroutData),LS_GUI.updateColorPicker("hovercolor",i.transition.hovercolor,i.transition.hovercolorData),LS_GUI.updateColorPicker("hoverbgcolor",i.transition.hoverbgcolor,i.transition.hoverbgcolorData),LS_GUI.updateLinkPicker("url"),LS_GUI.updateIconPicker("icon",i.icon),LS_GUI.updateIconPicker("html",i.html),void 0===i.media)switch(i.type){case"img":i.media="img";break;case"div":i.media="html";break;default:i.media="text"}if(LayerSlider.updateLayerAttributes(i),LayerSlider.updateLayerActions(i),lsEditor.layers.setType(),LayerSlider.changeLayerScreenType(),LayerSlider.changeVideoType(),LayerSlider.setLayerMedia(i.media,jQuery(".lse-layer-thumb",t),i),LayerSlider.selectElementType(t.find('.lse-layer-element-type lse-button[data-element="'+i.type+'"]'),e),i.skip?jQuery(".lse-hide-layer",a).addClass("lse-hidden"):jQuery(".lse-hide-layer",a).removeClass("lse-hidden"),i.locked?jQuery(".lse-lock-layer",a).addClass("lse-locked"):jQuery(".lse-lock-layer",a).removeClass("lse-locked"),jQuery("#lse-transition-tabs .lse-layer-transition-checkbox").each((function(){var e=jQuery(this).trigger("change."+lsEditor.settings.nameSpace),t=e.closest("lse-sidebar-section"),a=t.index(),r=jQuery("#lse-transition-dropdown lse-li");e.prop("checked")&&!1!==i.transition[e.attr("name")]?(r.eq(a).addClass("lse-enabled"),t.removeClass("lse-disabled")):(r.eq(a).removeClass("lse-enabled"),t.addClass("lse-disabled"))})),-1!==["img","media","shape","icon","svg"].indexOf(i.media)){let e=jQuery("#lse-transition-dropdown");jQuery("lse-li.lse-active",e).hasClass("lse-textish-type-only")&&(e.click(),e.children().eq(0).click())}let r=jQuery("#lse-transition-tabs lse-sidebar-section:not(.lse-tabs-content-inactive)");r&&r.hasClass("lse-disabled")&&lsEditor.tabs.resetTabContentScroll(r)},changeLayerScreenType:function(e,t){jQuery("#lse-layer-device-types lse-button").each((function(){var t=LS_activeLayerDataSet[0],a=jQuery(this),i=a.data("type");e&&e.is(a)&&(LS_UndoManager.add("layer.general","LAYER_DEVICE",{itemIndex:LS_activeLayerIndexSet[0],undo:{["hide_on_"+i]:!!t["hide_on_"+i]},redo:{["hide_on_"+i]:!t["hide_on_"+i]}}),t["hide_on_"+i]=!t["hide_on_"+i]),a[t["hide_on_"+i]?"removeClass":"addClass"]("lse-active")})),t&&(LS_DataSource.buildLayersListItem(LS_activeLayerIndexSet[0]),LayerSlider.generatePreviewItem(LS_activeLayerIndexSet[0]),LayerSlider.updatePreviewSelection())},changeVideoType:function(e){let t=jQuery("lse-layer-settings"),a=jQuery('input[name="backgroundvideo"]',t),i=jQuery("lse-subnav-item.lse-layer-content-tab",t);a.prop("checked")?(jQuery("lse-layer-settings").addClass("lse-bg-video"),i.click()):jQuery("lse-layer-settings").removeClass("lse-bg-video"),e&&"change"===e.type&&(LS_activeLayerDataSet[0].locked=!!a.prop("checked"),LayerSlider.selectLayer(LS_activeLayerIndexSet,{forceSelect:!0}),LS_DataSource.buildLayersListItem(LS_activeLayerIndexSet[0]))},willGeneratePreview:function(){clearTimeout(LayerSlider.timeout),LayerSlider.timeout=setTimeout((function(){LayerSlider.generatePreview()}),1e3)},generatePreview:function(){var e,t=window.lsSliderData.properties,a=lsEditor.workspace.getSize(),i=LS_activeSlideIndex,r=LS_activeSlideData,s=r.properties,l=r.sublayers,n=a.width,o=a.height,d=t.backgroundcolor,c=t.backgroundimage,u=window.lsPostsJSON||[],p=s.post_offset,y=s.background,h=s.bgcolor,S=s.bgsize,m=s.bgposition;o=-1!==o.indexOf("%")?400:parseInt(o),e=u[p=-1==p?i:p]||{},LS_previewArea.css({width:n,height:o}).empty(),c&&(c="url("+c+")"),d&&-1!==d.indexOf("gradient")&&(c?c+=", "+d:c=d,d=""),LS_previewHolder.css({backgroundColor:d||"transparent",backgroundImage:c||"none",backgroundRepeat:t.globalBGRepeat,backgroundAttachment:t.globalBGAttachment,backgroundPosition:t.globalBGPosition,backgroundSize:t.globalBGSize}),LS_previewItems=[],"[image-url]"==y&&(y=e["image-url"],LS_GUI.updateImagePicker("background",e["image-url"],{fromPost:!0})),S&&"inherit"!==S||(S=t.slideBGSize),m&&"inherit"!==m||(m=t.slideBGPosition),y&&(y="url("+y+")"),h&&-1!==h.indexOf("gradient")&&(y?y+=", "+h:y=h,h=""),LS_previewArea.css({backgroundColor:h||"transparent",backgroundImage:y||"none",backgroundSize:S||"auto",backgroundPosition:m||"center center",backgroundRepeat:"no-repeat"}),t.sliderclass&&LS_previewArea.addClass(t.sliderclass),LayerSlider.updateSlidePreviews();for(var L=0,g=l.length;L<g;L++)LayerSlider.generatePreviewItem(L,e);LayerSlider.generateStaticPreview()},generateStaticPreview:function(){LS_previewArea.children(".lse-static-layer").remove(),jQuery.each(LS_activeStaticLayersDataSet,(function(e,t){LayerSlider.generatePreviewItem(e,!1,{$targetArea:LS_previewArea,$layerItem:LS_previewArea.children(".lse-static-layer").eq(e),layerData:t.layerData,isStatic:!0})}))},willGeneratePreviewItem:function(e){clearTimeout(LayerSlider.timeout),LayerSlider.timeout=setTimeout((function(){LayerSlider.generatePreviewItem(e)}),200)},generateSelectedPreviewItems:function(){jQuery.each(LS_activeLayerIndexSet,(function(e,t){LayerSlider.generatePreviewItem(t)}))},generatePreviewItem:function(e,t,a){if("array"===jQuery.type(e)&&(e=e[0]),a=a||{},a=jQuery.extend({},{$targetArea:LS_previewArea,$layerItem:LS_previewItems[e],layerData:LS_activeSlideData.sublayers[e],isStatic:!1},a),LayerSlider.isLayerPreviewActive)return!1;var i=!1;a.$layerItem&&(i=a.$layerItem.data("beforeConvertPositions"),a.$layerItem.remove());var r,s,l=a.layerData,n=LS_activeSlideData.sublayers?LS_activeSlideData.sublayers.length:0,o=l.html,d=l.htmlTag||"ls-layer",c=l.id,u=l.styles.top||0,p=l.styles.left||0,y=l.innerAttributes||{},h=l.outerAttributes||{},S=!1;if(o=jQuery.trim(LS_Utils.maybeAddLineBreaksToLayerContent(l)),r=LS_Utils.shouldWrapLayerContent(l),a.isStatic&&(e=n+e),!t){var m=window.lsPostsJSON||[],L=LS_activeSlideData.properties.post_offset;-1==L&&(L=LS_activeSlideIndex),t=m[L]||{}}if(l.skip||l["hide_on_"+LS_activeScreenType])return s=jQuery('<ls-layer class="ls-l lse-disabled">').appendToWithIndex(a.$targetArea,e).hide(),a.isStatic||(LS_previewItems[e]=s),LayerSlider.addDraggable(),!0;if(l.icon&&-1!==["text","button","post","html"].indexOf(l.media)){o&&o.length&&(S=!0);let e,t=l.icon;try{e=jQuery(l.icon)}catch(e){}if(e){if(l.iconColor&&e.css("color",l.iconColor),l.iconGap){let t="left"===l.iconPlacement?"margin-right":"margin-left";e.css(t,l.iconGap+"em")}l.iconSize&&e.css("font-size",l.iconSize+"em"),l.iconVerticalAdjustment&&e.css("transform","translateY( "+l.iconVerticalAdjustment+"em )"),t=e[0].outerHTML}o="left"===l.iconPlacement?t+o:o+t}if("img"===l.type||"img"===l.media){var g=l.image;"[image-url]"==g&&(g=t["image-url"]||"",LS_GUI.updateImagePicker("image",t["image-url"],{fromPost:!0}));var v=g?'<img src="'+g+'">':'<ls-layer class="lse-layer-placeholder lse-image-placeholder">'+LS_InterfaceIcons.layerTypes.img+"<lse-ib>"+LS_l10n.SBPreviewImagePlaceholder+"</lse-ib></ls-layer>";s=jQuery(v).hide().appendToWithIndex(a.$targetArea,e)}else if("post"===l.media){var f=l.post_text_length;for(var b in t)if(o&&-1!==o.indexOf("["+b+"]")){var _=t[b];("title"==b||"content"==b||"excerpt"==b)&&f>0&&(_=LS_Utils.stripTags(_).substr(0,f),_=LS_Utils.nl2br(_)),o=o.replace("["+b+"]",_)}(s=r?jQuery("<"+d+">").html(o):jQuery(o)).appendToWithIndex(a.$targetArea,e)}else"media"!==l.media||o?"icon"!==l.media||o?"shape"!==l.media||o?(s=jQuery("<"+d+">").appendToWithIndex(a.$targetArea,e),""!==o&&s.html(o)):s=jQuery('<ls-layer class="lse-layer-placeholder lse-shape-placeholder">'+LS_InterfaceIcons.layerTypes.shape+"<lse-ib>"+LS_l10n.SBPreviewShapePlaceholder+"</lse-ib></ls-layer>").appendToWithIndex(a.$targetArea,e):s=jQuery('<ls-layer class="lse-layer-placeholder lse-icon-placeholder">'+LS_InterfaceIcons.layerTypes.icon+"<lse-ib>"+LS_l10n.SBPreviewIconPlaceholder+"</lse-ib></ls-layer>").appendToWithIndex(a.$targetArea,e):s=jQuery('<ls-layer class="lse-layer-placeholder lse-media-placeholder">'+LS_InterfaceIcons.layerTypes.media+"<lse-ib>"+LS_l10n.SBPreviewMediaPlaceholder+"</lse-ib></ls-layer>").appendToWithIndex(a.$targetArea,e);S&&s.addClass("ls-ib-icon");var w,j,I,k={};for(w in l.transition)if(-1!==LS_transformStyles.indexOf(w)){if(!(j=l.transition[w])&&0!==j)continue;j=j.toString(),I=-1!==w.indexOf("scale")?1:0,parseFloat(j)!==I&&(k[w]=parseFloat(j))}let x={"z-index":100+n-e};for(let e in l.styles){let t=l.styles[e];!t&&0!==t||"unset"===t||"inherit"===t||"object"!=typeof t&&(t=t.toString(),";"==t.slice(-1)&&(t=t.substring(0,t.length-1)),x[e]=isNumber(t)?t+"px":t,-1!==["z-index","font-weight","opacity"].indexOf(e)&&(x[e]=t))}l.layerBackground&&("[image-url]"===l.layerBackground?(LS_GUI.updateImagePicker("layerBackground",t["image-url"],{fromPost:!0}),x["background-image"]='url("'+t["image-url"]+'")'):x["background-image"]='url("'+l.layerBackground+'")'),x["background-color"]&&-1!==x["background-color"].indexOf("gradient")&&(x["background-image"]?x["background-image"]+=", "+x["background-color"]:x.background=x["background-color"],delete x["background-color"]),l.hasTransforms=!jQuery.isEmptyObject(k);try{s.attr(jQuery.extend({},y,h))}catch(e){}s.attr({id:c,style:l.style}).css(x).css({whiteSpace:l.styles.wordwrap?"normal":"nowrap"}).addClass(l.class),a.isStatic||(LS_previewItems[e]=s,-1!==LS_activeLayerIndexSet.indexOf(e)?s.addClass("ui-selected"):s.removeClass("ui-selected")),s.addClass("lse-"+l.media+"-layer"),s.addClass(a.isStatic?"lse-disabled lse-static-layer":"ls-l"),(LS_Revisions.opened||l.locked)&&s.addClass("lse-disabled");var Q=s.children("iframe,video").eq(0);if(Q.length){if(l.transition.backgroundvideo)return s.addClass("lse-disabled lse-bgvideo").css({pointerEvents:"none"}).children("video").prop("controls",!1),l.transition.overlay&&"disabled"!==l.transition.overlayer&&jQuery("<ls-layer>",{class:"lse-video-overlay",style:"background-image: url("+l.transition.overlay+")"}).appendTo(s),void LayerSlider.updatePreviewSelection();var D=parseInt(Q.attr("width"))||Q.width(),C=parseInt(Q.attr("height"))||Q.height();l.styles.width||s.width(D),l.styles.height||s.height(C)}if("media"===l.media&&s.children("audio,video").length&&("enabled"===l.transition.controls?s.children("audio,video").prop("controls",!0):"disabled"===l.transition.controls&&s.children("audio,video").prop("controls",!1)),s.is("img")?s.on("load",(function(){LayerSlider.setPositions(s,u,p),LayerSlider.updatePreviewSelection(),clearTimeout(LayerSlider.selectableTimeout),LayerSlider.selectableTimeout=setTimeout((function(){LayerSlider.updatePreviewSelection()}),100)})).attr("src",s.attr("src")):(LayerSlider.setPositions(s,u,p,!1,i),LayerSlider.updatePreviewSelection()),k.transformPerspective=500,k.transformOrigin=l.transition.transformoriginin||"50% 50% 0",-1!==k.transformOrigin.indexOf("slider")){var P=lsEditor.workspace.getSize(),T=P.width,E=P.height,O=parseFloat(s[0].style.left),M=parseFloat(s[0].style.top);s.outerWidth(),s.outerHeight();k.transformOrigin=k.transformOrigin.replace("sliderleft",-O+"px").replace("sliderright",T-O+"px").replace("slidercenter",T/2-O+"px").replace("slidermiddle",E/2-M+"px").replace("slidertop",-M+"px").replace("sliderbottom",E-M+"px")}TweenMax.set(s[0],k),LayerSlider.addDraggable()},setPositions:function(e,t,a,i,r){e.show();var s=t?parseFloat(t):0,l=a?parseFloat(a):0,n=e[0].style,o=(parseInt(n.marginLeft),parseInt(n.marginTop),n.left),d=n.top;if(n.left=r?r.left:0,n.top=r?r.top:0,a&&-1!==a.indexOf("%")&&(l=0===l?0:100===l?LS_previewArea.width()-e.outerWidth():LS_previewArea.width()/100*l-e.outerWidth()/2),t&&-1!==t.indexOf("%")&&(s=0===s?0:100===s?LS_previewArea.height()-e.outerHeight():LS_previewArea.height()/100*s-e.outerHeight()/2),l=Math.round(l),s=Math.round(s),i)return n.left=o,n.top=d,{top:s,left:l};e.css({top:s,left:l})},previewItemAtIndex:function(e){return LS_previewArea.children(".ls-l").eq(e)},updatePreviewSelection:function(){if(LS_activeLayerIndexSet.length&&LS_activeSlideData.sublayers.length&&!jQuery(".lse-editing").length){if(1===LS_activeLayerIndexSet.length){var e=LS_activeLayerDataSet[0];if(e&&(e.locked||e.skip||e["hide_on_"+LS_activeScreenType]))return void $lasso.hide()}var t={left:1/0,top:1/0},a={left:-1/0,top:-1/0},i=[];if(jQuery.each(LS_activeLayerIndexSet,(function(e,r){var s=LS_previewItems[r];let l=LS_activeLayerDataSet[e];if(l&&(l.skip||l.locked||l["hide_on_"+LS_activeScreenType]))return!0;if(s){var n={left:(parseFloat(s[0].style.left)+parseInt(s.css("margin-left")))*LS_previewZoom||0,top:(parseFloat(s[0].style.top)+parseInt(s.css("margin-top")))*LS_previewZoom||0},o={top:n.top+s.outerHeight()*LS_previewZoom,left:n.left+s.outerWidth()*LS_previewZoom};n.left<t.left&&(t.left=n.left),n.top<t.top&&(t.top=n.top),o.left>a.left&&(a.left=o.left),o.top>a.top&&(a.top=o.top),i.push(s)}})),t.width=a.left-t.left,t.height=a.top-t.top,$lasso.css(t).attr({"data-info-0":"w: "+Math.round(t.width/LS_previewZoom)+"px","data-info-1":"h: "+Math.round(t.height/LS_previewZoom)+"px"}).show(),i.length||$lasso.hide(),$lasso.hasClass("ui-resizable-disabled")&&$lasso.removeClass("ui-resizable-disabled"),1===LS_activeLayerIndexSet.length){var r=LS_activeLayerIndexSet[0];LS_previewItems[r]&&LS_previewItems[r].hasClass("lse-layer-placeholder")&&$lasso.addClass("ui-resizable-disabled")}t.width&&t.height||$lasso.addClass("ui-resizable-disabled")}else $lasso.hide()},hidePreviewSelection:function(){jQuery("lse-workspace-frame").addClass("lse-hide-selection")},showPreviewSelection:function(){jQuery("lse-workspace-frame").removeClass("lse-hide-selection")},updateRulerLines:function(){jQuery(".lse-ruler-line-x").each((function(){jQuery(this).css("top",jQuery(this).data("originalTop")*LS_previewZoom)})),jQuery(".lse-ruler-line-y").each((function(){jQuery(this).css("left",jQuery(this).data("originalLeft")*LS_previewZoom)}))},openMediaLibrary:function(){jQuery("body").on("click",".lse-media-upload",(function(e){e.preventDefault(),uploadInput=this;var t=jQuery(this).hasClass("lse-insert-media")?["video","audio"]:["image"],a=jQuery(this).hasClass("lse-bulk-upload"),i=wp.media({title:"image"===t[0]?LS_l10n.SBMediaLibraryImage:LS_l10n.SBMediaLibraryMedia,multiple:a,library:{type:t},button:{text:"Insert"}});jQuery(i.modal.el).addClass("lse-wp-modal"),i.on("select",(function(){var e,t,a=i.state().get("selection").first().toJSON(),r=i.state().get("selection").toJSON(),s=[];if(jQuery(uploadInput).hasClass("lse-slide-image")){for(a.sizes.medium,e=a.sizes.full.url,LS_GUI.updateImagePicker(jQuery(uploadInput),e),LS_UndoManager.add("slide.general","SLIDE_IMAGE",{itemIndex:LS_activeSlideIndex,undo:{background:LS_activeSlideData.properties.background,backgroundId:LS_activeSlideData.properties.backgroundId,backgroundThumb:LS_activeSlideData.properties.backgroundThumb},redo:{background:a.url,backgroundId:a.id,backgroundThumb:e}}),
LS_activeSlideData.properties.background=a.url,LS_activeSlideData.properties.backgroundId=a.id,LS_activeSlideData.properties.backgroundThumb=e,c=1;c<r.length;c++){r[c].sizes.medium,e=r[c].sizes.full.url;var l=jQuery.extend(!0,{},LS_DataSource.getDefaultSlideData());l.background=r[c].url,l.backgroundId=r[c].id,l.backgroundThumb=e,l={properties:l,sublayers:[]},LayerSlider.addSlide(l,{selectSlide:!1,atIndex:LS_activeSlideIndex+c})}LayerSlider.updateSlidePreviews()}else if(jQuery(uploadInput).hasClass("lse-slide-thumbnail"))a.sizes.medium,e=a.sizes.full.url,LS_GUI.updateImagePicker(jQuery(uploadInput),e),LS_UndoManager.add("slide.general","SLIDE_THUMBNAIL",{itemIndex:LS_activeSlideIndex,undo:{thumbnail:LS_activeSlideData.properties.thumbnail,thumbnailId:LS_activeSlideData.properties.thumbnailId,thumbnailThumb:LS_activeSlideData.properties.thumbnailThumb},redo:{thumbnail:a.url,thumbnailId:a.id,thumbnailThumb:e}}),LS_activeSlideData.properties.thumbnail=a.url,LS_activeSlideData.properties.thumbnailId=a.id,LS_activeSlideData.properties.thumbnailThumb=e,LayerSlider.updateSlidePreviews();else if(jQuery(uploadInput).hasClass("lse-layer-image")){for(a.sizes.thumbnail,e=a.sizes.full.url,LS_GUI.updateImagePicker(jQuery(uploadInput),e),LS_UndoManager.add("layer.general","LAYER_IMAGE",{itemIndex:LS_activeLayerIndexSet[0],undo:{image:LS_activeLayerDataSet[0].image,imageId:LS_activeLayerDataSet[0].imageId,imageThumb:LS_activeLayerDataSet[0].imageThumb},redo:{image:a.url,imageId:a.id,imageThumb:e}}),LS_activeLayerDataSet[0].image=a.url,LS_activeLayerDataSet[0].imageId=a.id,LS_activeLayerDataSet[0].imageThumb=e,LayerSlider.autoRenameLayer(LS_activeLayerIndexSet[0]),c=1;c<r.length;c++)r[c].sizes.thumbnail,e=r[c].sizes.full.url,(t=jQuery.extend(!0,{},LS_DataSource.getDefaultLayerData())).image=r[c].url,t.imageId=r[c].id,t.imageThumb=e,t.styles.top=10*c+"px",t.styles.left=10*c+"px",LayerSlider.autoRenameLayer(null,t),LS_activeSlideData.sublayers.unshift(t),s.push({itemIndex:0,undo:{data:{}},redo:{data:t}});LS_DataSource.buildLayersList(),s.length&&LS_UndoManager.add("slide.layers","LAYER_NEW_M",s)}else if(jQuery(uploadInput).hasClass("lse-media-image"))a.sizes.medium,e=a.sizes.full.url,LS_GUI.updateImagePicker(jQuery(uploadInput),e),LS_UndoManager.add("layer.general","VIDEO_POSTER",{itemIndex:LS_activeLayerIndexSet[0],undo:{poster:LS_activeLayerDataSet[0].poster,posterId:LS_activeLayerDataSet[0].posterId,posterThumb:LS_activeLayerDataSet[0].posterThumb},redo:{poster:a.url,posterId:a.id,posterThumb:e}}),LS_activeLayerDataSet[0].poster=a.url,LS_activeLayerDataSet[0].posterId=a.id,LS_activeLayerDataSet[0].posterThumb=e;else if(jQuery(uploadInput).hasClass("lse-layer-background-image"))a.sizes.medium,e=a.sizes.full.url,LS_GUI.updateImagePicker(jQuery(uploadInput),e),LS_UndoManager.add("layer.general","LAYER_BG",{itemIndex:LS_activeLayerIndexSet[0],undo:{poster:LS_activeLayerDataSet[0].layerBackground,layerBackgroundId:LS_activeLayerDataSet[0].layerBackgroundId,layerBackgroundThumb:LS_activeLayerDataSet[0].layerBackgroundThumb},redo:{layerBackground:a.url,layerBackgroundId:a.id,layerBackgroundThumb:e}}),LS_activeLayerDataSet[0].layerBackground=a.url,LS_activeLayerDataSet[0].layerBackgroundId=a.id,LS_activeLayerDataSet[0].layerBackgroundThumb=e,LS_DataSource.buildLayersListItem(LS_activeLayerIndexSet[0]);else if(jQuery(uploadInput).hasClass("lse-global-background"))a.sizes.medium,e=a.sizes.full.url,LS_GUI.updateImagePicker(jQuery(uploadInput),e),window.lsSliderData.properties.backgroundimage=a.url,window.lsSliderData.properties.backgroundimageId=a.id;else if(jQuery(uploadInput).hasClass("lse-slider-preview"))a.sizes.medium,e=a.sizes.full.url,LS_GUI.updateImagePicker(jQuery(uploadInput),e),window.lsSliderData.meta||(window.lsSliderData.meta={}),window.lsSliderData.meta.preview=a.url,window.lsSliderData.meta.previewId=a.id;else if(jQuery(uploadInput).hasClass("lse-insert-media")){var n=!1,o=!1,d=[],u=[],p="",y="";for(c=0;c<r.length;c++)p="/"+r[c].url.split("/").slice(3).join("/"),"video"===r[c].type?(n=!0,d.push({url:p,mime:r[c].mime})):"audio"===r[c].type&&(o=!0,u.push({url:p,mime:r[c].mime}));if(n){for(y+='<video width="640" height="360" preload="metadata" controls>\r\n',c=0;c<d.length;c++)y+='\t<source src="'+d[c].url+'" type="'+d[c].mime+'">\r\n';y+="</video>"}if(o){for(n&&(y+="\r\n\r\n"),y+='<audio preload="metadata" nocontrols>\r\n',c=0;c<u.length;c++)y+='\t<source src="'+u[c].url+'" type="'+u[c].mime+'">\r\n';y+="</audio>"}LS_UndoManager.add("layer.general","LAYER_SETTINGS",{itemIndex:LS_activeLayerIndexSet[0],undo:{html:jQuery("#lse-layer-content").val()},redo:{html:y}}),LS_activeLayerDataSet[0].html=y,jQuery("#lse-layer-content").val(y)}else jQuery(uploadInput).val(a.url),jQuery(uploadInput).is('input[name="image"]')&&jQuery(uploadInput).prev().attr("src",a.url);LayerSlider.generatePreview(),lsSetEditorDirtyState(!0)})),i.open()}))},initImageEditor:function(e){var t=LS_editorModules.pixie.baseURL;pixieJSFile=t+"/"+LS_editorModules.pixie.files.js,pixieCSSFile=t+"/"+LS_editorModules.pixie.files.css,jQuery("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:pixieCSSFile}),jQuery("<pixie-editor></pixie-editor>").prependTo("body"),jQuery.getScript(pixieJSFile).done((function(){window.pixieEditor=new Pixie({crossOrigin:!0,urls:{assets:t+"/"},tools:{stickers:{replaceDefault:!0,items:[]}},ui:{mode:"overlay",theme:"dark",openImageDialog:!1,toolbar:{hideOpenButton:!0},nav:{position:"top",replaceDefault:!0,items:[{name:"filter",icon:"filter-custom",action:"filter"},{type:"separator"},{name:"resize",icon:"resize-custom",action:"resize"},{name:"crop",icon:"crop-custom",action:"crop"},{name:"transform",icon:"transform-custom",action:"rotate"},{type:"separator"},{name:"draw",icon:"pencil-custom",action:"draw"},{name:"text",icon:"text-box-custom",action:"text"},{name:"shapes",icon:"polygon-custom",action:"shapes"},{name:"frame",icon:"frame-custom",action:"frame"},{type:"separator"},{name:"corners",icon:"rounded-corner-custom",action:"round"},{name:"background",icon:"background-custom",action:"background"},{name:"merge",icon:"merge-custom",action:"merge"}]}},onOpen:function(){LS_imageEditorOpened=!0},onLoad:function(){pixieEditor.resetAndOpenEditor("image",e)},onClose:function(){LS_imageEditorOpened=!1,jQuery("#pixie-current-image").removeAttr("id")},onSave:function(e,t){lsEditor.notify.show({icon:"images",text:LS_l10n.notifyPixieSave}),setTimeout((function(){LayerSlider.uploadImageEditorPic(e,(function(){lsEditor.notify.hide(),window.pixieEditor.close()}))}),1e3)}})})).fail((function(){}))},downloadImageEditor:function(e){lsEditor.loading.show("modal",LS_l10n.moduleDLImageEditor),jQuery.getJSON(ajaxurl,{action:"ls_download_module",module:e.moduleHandle},(function(t){t&&t.success?e.onComplete&&e.onComplete():t.message&&(lsEditor.loading.hide(),kmw.modal.open({title:LS_l10n.moduleDLErrorTitle,content:t.message,animationIn:"scale",overlaySettings:{animationIn:"fade"}}))}))},openImageEditor:function(e){window.pixieEditor?pixieEditor.resetAndOpenEditor("image",e):LS_editorModules.pixie.needsDL?LayerSlider.downloadImageEditor({moduleHandle:LS_editorModules.pixie.handle,onComplete:function(){lsEditor.loading.hide(),LS_editorModules.pixie.needsDL=!1,LayerSlider.initImageEditor(e)}}):LayerSlider.initImageEditor(e)},uploadImageEditorPic:function(e,t){var a=jQuery("#pixie-current-image").removeAttr("id");imgName="pixie_"+Date.now()+".png",imgBlob=LS_Utils.dataURItoBlob(e),imgBlob.lastModifiedDate=new Date,imgBlob.name=imgName,imgBlob.filename=imgName,LayerSlider.uploadImageToMediaLibrary(imgBlob,(function(e){a.attr("src",e.url),a.hasClass("lse-global-background")?(lsSliderData.properties.backgroundimage=e.url,lsSliderData.properties.backgroundimageId=e.id):a.hasClass("lse-slider-preview")?(lsSliderData.meta.preview=e.url,lsSliderData.meta.previewId=e.id):a.hasClass("lse-slide-image")?(LS_DataSource.updateProperties("slide.general","SLIDE_IMAGE",LS_activeSlideIndex,LS_activeSlideData.properties,{background:e.url,backgroundId:e.id,backgroundThumb:e.url}),LayerSlider.updateSlidePreviews(),LayerSlider.generatePreview()):a.hasClass("lse-slide-thumbnail")?(LS_DataSource.updateProperties("slide.general","SLIDE_THUMBNAIL",LS_activeSlideIndex,LS_activeSlideData.properties,{thumbnail:e.url,thumbnailId:e.id,thumbnailThumb:e.url}),LayerSlider.updateSlidePreviews()):a.hasClass("lse-layer-image")?(LS_DataSource.updateProperties("layer.general","LAYER_IMAGE",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],{image:e.url,imageId:e.id,imageThumb:e.url}),LayerSlider.generatePreviewItem(LS_activeLayerIndexSet[0]),LS_DataSource.buildLayersListItem(LS_activeLayerIndexSet[0])):a.hasClass("lse-media-image")?LS_DataSource.updateProperties("layer.general","VIDEO_POSTER",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],{poster:e.url,posterId:e.id,posterThumb:e.url}):a.hasClass("lse-layer-background-image")&&(LS_DataSource.updateProperties("layer.general","LAYER_BG",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],{layerBackground:e.url,layerBackgroundId:e.id,layerBackgroundThumb:e.url}),LayerSlider.generatePreviewItem(LS_activeLayerIndexSet[0])),LS_GUI.updateImagePicker(a,e.url),lsSetEditorDirtyState(!0),t&&t()}))},handleDroppedImages:function(e){var t=e.originalEvent,a=t.dataTransfer.files,i=LS_previewArea.offset(),r=(jQuery(window).scrollLeft()+t.clientX-i.left)/LS_previewZoom,s=(jQuery(window).scrollTop()+t.clientY-i.top)/LS_previewZoom,l=[],n=[],o=1;if(r=Math.round(r),s=Math.round(s),0===a.length)return lsEditor.dropZone.hide(),!1;jQuery.each(a,(function(e,t){if(-1!==t.type.indexOf("svg+xml"))return t.text().then((e=>{let i=LS_Utils.normalizeSVG(e);i&&(LayerSlider.addFormattedLayer("svg",{html:i.html,autoSubtitle:!1,subtitle:LS_Utils.beautifyFileName(t.name),styles:{width:i.width,height:i.height,top:s+"px",left:r+"px"}}),o++===a.length&&lsEditor.dropZone.hide())})),!0;-1!==t.type.indexOf("image")?LayerSlider.uploadImageToMediaLibrary(t,(function(e){var i=jQuery.extend(!0,{},LS_DataSource.getDefaultLayerData());i.image=e.url,i.imageId=e.id,i.imageThumb=e.sizes.thumbnail?e.sizes.thumbnail.url:e.url,i.subtitle=LS_Utils.beautifyFileName(t.name),i.styles.left=r+"px",i.styles.top=s+"px",n.push(0),l.push(i),r+=20,s+=20,o++===a.length&&(LayerSlider.addLayer(l,n),lsEditor.dropZone.hide())})):lsEditor.dropZone.hide()}))},uploadImageToMediaLibrary:function(e,t){if(0===e.type.indexOf("image")){var a=new FormData;a.append("action","upload-attachment"),a.append("async-upload",e,e.name),a.append("name",e.name),a.append("_wpnonce",_wpPluploadSettings.defaults.multipart_params._wpnonce),jQuery.ajax({url:ajaxurl.replace("admin-ajax","async-upload"),method:"POST",data:a,dataType:"json",processData:!1,contentType:!1,error:function(e,t,a){alert(LS_l10n.SBUploadErrorMessage.replace("%s",a))},success:function(e){e&&e.success?void 0!==t&&t(e.data):alert(LS_l10n.SBUploadError)}})}},addLayerSortables:function(){jQuery("#lse-layers-list").sortable({handle:".lse-layer-thumb-wrapper",containment:"parent",tolerance:"pointer",axis:"y",start:function(e,t){t.item.addClass("lse-dragged-layer"),LayerSlider.dragIndex=jQuery(".ui-sortable-placeholder").index()-1},stop:function(e,t){var a=LayerSlider.dragIndex,i=jQuery(".lse-dragged-layer").removeClass("lse-dragged-layer").index();LS_UndoManager.add("layer.order","LAYER_ORDER",{itemIndex:null,undo:{from:i,to:a},redo:{from:a,to:i}}),i>-1&&LS_Utils.moveArrayItem(LS_activeSlideData.sublayers,a,i),LS_activeLayerIndexSet=[],jQuery("#lse-layers-list lse-li.lse-active").each((function(){LS_activeLayerIndexSet.push(jQuery(this).index())})),LayerSlider.reindexLayers(),LayerSlider.generatePreview()}})},addSlideSortables:function(){LS_Revisions.opened||jQuery("#lse-slide-tabs").sortable({containment:"parent",tolerance:"pointer",handle:".lse-slide-preview",items:".lse-slide-tab",cancel:".lse-unsortable",distance:3,start:function(){LayerSlider.dragIndex=jQuery(".ui-sortable-placeholder").index()-1},change:function(){jQuery(".ui-sortable-helper").addClass("lse-dragged-slide")},stop:function(e,t){var a=LayerSlider.dragIndex,i=jQuery(".lse-dragged-slide").removeClass("lse-dragged-slide").index();i>-1&&LS_Utils.moveArrayItem(window.lsSliderData.layers,a,i),LS_activeSlideIndex=jQuery("#lse-slide-tabs .lse-slide-tab.lse-active").index(),LS_activeStaticLayersDataSet=LayerSlider.staticLayersForSlide(LS_activeSlideIndex),LayerSlider.reindexStaticLayers(),LayerSlider.generateStaticPreview(),LS_DataSource.buildLayersList()}})},disableSlideSortables:function(){jQuery("#lse-slide-tabs").sortable("disable")},enableSlideSortables:function(){jQuery("#lse-slide-tabs").sortable("enable")},addDraggable:function(){LS_previewArea.children(".ls-l").draggable({snap:".ls-l:not(.lse-disabled), .lse-ruler-line, lse-preview-area",snapTolerance:10,cancel:".lse-disabled",start:function(e,t){lsEditor.layers.highlight.disable(),t.helper.hasClass("ui-selected")||t.helper.addClass("ui-selected").trigger("selectablestop.ls"),$lasso.data("originalPosition",$lasso.position({left:parseFloat($lasso[0].style.left),top:parseFloat($lasso[0].style.top)})),jQuery("#lse-workspace .ui-selected").each((function(){let e=jQuery(this);e.data("originalPosition",{top:parseFloat(e[0].style.top),left:parseFloat(e[0].style.left)})}))},drag:function(e,t){LayerSlider.dragging(t)},stop:function(e,t){var a=[];LayerSlider.dragging(t),jQuery("#lse-workspace .ui-selected:not(.lse-disabled)").each((function(){var e=jQuery(this),t=e.index(),i={left:parseFloat(e[0].style.left),top:parseFloat(e[0].style.top)},r=Math.round(i.top)+"px",s=Math.round(i.left)+"px",l=e.data("originalPosition");LS_activeSlideData.sublayers[t].styles.top=r,LS_activeSlideData.sublayers[t].styles.left=s,a.push({itemIndex:t,undo:{left:l.left+"px",top:l.top+"px"},redo:{left:s,top:r}})})),LS_UndoManager.add("layer.style","LAYER_POSITION",a.reverse()),lsEditor.layers.highlight.enable()}})},dragging:function(e){1===LS_activeLayerIndexSet.length&&(jQuery('lse-layer-settings input[name="top"]').val(Math.round(e.position.top)+"px"),jQuery('lse-layer-settings input[name="left"]').val(Math.round(e.position.left)+"px"))},resizing:function(e,t){var a,i,r,s,l,n,o,d,c,u=t.size.height/t.originalSize.height,p=t.size.width/t.originalSize.width,y=t.originalSize.width/t.originalSize.height,h=[];if($lasso.data("dragDirection")||$lasso.data("dragDirection",1===u?"horizontal":"vertical"),jQuery("#lse-workspace .ui-selected:not(.lse-disabled)").each((function(){a=this,i=jQuery(this),r=i.index(),s=LS_activeSlideData.sublayers[r],layerMedia=s.media||"text",blockLevel=-1!==["img","media","shape","svg","html"].indexOf(layerMedia),h.push(a.tagName.toLowerCase()),o=i.data("originalPosition"),d=i.data("originalSize"),s.styles.top=a.style.top=Math.round((o.top-t.originalPosition.top/LS_previewZoom)*u+t.position.top/LS_previewZoom)+"px",s.styles.left=a.style.left=Math.round((o.left-t.originalPosition.left/LS_previewZoom)*p+t.position.left/LS_previewZoom)+"px",l=Math.round(d.width*p)+"px",n=Math.round(d.height*u)+"px",(s.styles.width||blockLevel)&&(s.styles.width=l),(s.styles.height||blockLevel)&&(s.styles.height=n),i.outerWidth(l),i.outerHeight(n),blockLevel||(c=t.size.width/t.originalSize.width,s.styles["font-size"]=a.style.fontSize=Math.round(c*d.fontSize)+"px",d.lineHeight&&(s.styles["line-height"]=a.style.lineHeight=Math.round(c*d.lineHeight)+"px")),1===LS_activeLayerIndexSet.length&&((s.styles.width||blockLevel)&&jQuery('.lse-layer-style-panel input[name="width"]').val(a.style.width),(s.styles.height||blockLevel)&&jQuery('.lse-layer-style-panel input[name="height"]').val(a.style.height),jQuery('.lse-layer-style-panel input[name="top"]').val(a.style.top),jQuery('.lse-layer-style-panel input[name="left"]').val(a.style.left),jQuery('.lse-layer-style-panel input[name="font-size"]').val(parseInt(s.styles["font-size"])),d.lineHeight&&jQuery('.lse-layer-style-panel input[name="line-height"]').val(parseInt(s.styles["line-height"])))})),!blockLevel)switch($lasso.data("dragDirection")){case"horizontal":t.size.height=t.size.width/y;break;case"vertical":t.size.width=t.size.height*y}$lasso.attr({"data-info-0":"w: "+Math.round(t.size.width/LS_previewZoom)+"px","data-info-1":"h: "+Math.round(t.size.height/LS_previewZoom)+"px"}),lsEditor.layers.transformHelper.update()},highlightPreviewItem:function(e){var t=jQuery(e).data("layerIndex");LS_previewArea.children(".ls-l").eq(t).addClass("lse-highlighted").siblings().addClass("lse-lowlighted")},selectPreviewItem:function(e,t){if(LS_previewArea.children().removeClass("lse-highlighted lse-lowlighted"),t.ctrlKey||t.metaKey){var a=LS_previewArea.children().eq(e);LS_previewWrapper.triggerHandler(jQuery.Event("mousedown.ls",{target:a[0],which:1,shiftKey:t.shiftKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey}))}else if(JSON.stringify(LS_activeLayerIndexSet)!=="["+e+"]")return LayerSlider.selectLayer([e])},editLayerToggle:function(){if(1===LS_activeLayerIndexSet.length){var e=jQuery(".lse-editing"),t=LS_previewItems[LS_activeLayerIndexSet[0]];e.length?this.editLayerEnd(e):this.editLayerStart(t)}},editLayerStart:function(e){var t=(a=LS_activeLayerDataSet[0]).media;if(e.is("img")||"img"===t)return jQuery(".lse-layer-image").click(),!1;if("icon"===t)return jQuery(".lse-replace-icon").last().click(),!1;if("media"===t)return LS_InsertMedia.open(),!1;if("shape"===t)return LS_ShapeChooser.open(LS_activeLayerDataSet[0].shapeData,LS_activeLayerIndexSet[0]),!1;if("svg"===t)return LS_SVGChooser.open(a.html),!1;LayerSlider.selectLayer([e.index()]);var a=LS_activeLayerDataSet[0];if(e.hasClass("lse-disabled")||a.locked)return!1;e.addClass("lse-disabled lse-editing").prop("contenteditable",!0).html(e.text()).focus(),LS_quickEditLayerIndex=LS_activeLayerIndexSet[0],$lasso.addClass("ui-resizable-disabled").hide(),jQuery("#lse-layer-content").data("prevVal",a.html),requestAnimationFrame((()=>{let t=document.createRange(),a=window.getSelection();t.selectNodeContents(e[0]),a.removeAllRanges(),a.addRange(t)})),jQuery(document).on("click.lse-editing",(function(e){jQuery(e.target).hasClass("lse-editing")||LayerSlider.editLayerEnd(jQuery(".lse-editing"))}))},editLayer:function(e){if((e.shiftKey||e.metaKey||e.ctrlKey||e.altKey)&&13===e.which&&(e.preventDefault(),window.getSelection)){var t=window.getSelection(),a=t.getRangeAt(0),i=document.createElement("br");a.deleteContents(),a.insertNode(i),a.setStartAfter(i),a.setEndAfter(i),a.collapse(!1),t.removeAllRanges(),t.addRange(a)}},editLayerUpdate:function(e){var t=e.innerHTML,a=jQuery("#lse-layer-content"),i=LS_activeLayerDataSet[0].styles;t=(t=t.replaceAll("<br>","\n")).replaceAll("<br/>","\n"),a.val(t),LS_activeLayerDataSet[0].html=t,LayerSlider.setPositions(jQuery(e),i.top,i.left),LayerSlider.autoRenameLayer(LS_activeLayerIndexSet[0])},editLayerPaste:function(e){e.preventDefault(),document.execCommand("insertHTML",!1,e.originalEvent.clipboardData.getData("text/plain"))},editLayerEnd:function(e){jQuery(document).off("click.lse-editing"),e.prop("contenteditable",!1).removeClass("lse-disabled lse-editing"),jQuery("#lse-layer-content").trigger("change"),LayerSlider.generateSelectedPreviewItems(),LayerSlider.generatePreviewItem(LS_quickEditLayerIndex),LayerSlider.setActiveLayerMedia()},reindexLayers:function(e){var t=LS_activeSlideData.sublayers.length;t=t||0,jQuery("#lse-layers-list > lse-li").each((function(e){var a=jQuery(this).find(".lse-layer-title").val(),i=LS_l10n.SBLayerTitle.substring(0,LS_l10n.SBLayerTitle.length-2);-1!=a.indexOf(i)&&-1==a.indexOf("copy")&&jQuery(this).find(".lse-layer-title").val(LS_l10n.SBLayerTitle.replace("%d",t-e))}))},updateSlidePreviews:function(){jQuery("#lse-slide-tabs .lse-slide-tab").each((function(e){var t=jQuery(this),a=t.find(".lse-slide-preview"),i=t.index(),r=window.lsSliderData.layers[i];r.properties;t.removeClass("lse-empty");var s=r.properties.thumbnail||r.properties.background||"";a.css("background-image","url("+s+")"),s&&-1===s.indexOf("blank.gif")||t.addClass("lse-empty")}))},rebuildSlides:function(){var e,t=window.lsSliderData.layers.reverse(),a=jQuery("#lse-slide-tabs");jQuery(".lse-slide-tab",a).remove(),jQuery.each(t,(function(t,i){e=jQuery(jQuery("#tmpl-slide-tab").text()).prependTo(a),i.properties.title&&e.find(".lse-slide-name input").val(i.properties.title);var r=i.properties.thumbnail||i.properties.background||"";e.find(".lse-slide-preview").css("background-image","url("+r+")"),r&&-1===r.indexOf("blank.gif")||e.addClass("lse-empty"),i.properties.skip&&e.addClass("lse-skip")})),window.lsSliderData.layers.reverse(),jQuery(".lse-slide-tab",a).removeClass("lse-active"),jQuery(".lse-slide-tab",a).eq(LS_activeSlideIndex).addClass("lse-active").length||jQuery(".lse-slide-tab",a).eq(0).addClass("lse-active")},checkMediaAutoPlay:function(e,t,a){clearTimeout(LayerSlider.mediaCheckTimeout),LayerSlider.mediaCheckTimeout=setTimeout((function(){if(-1!==a.indexOf("autoplay")){var t=jQuery(a).filter("iframe"),i=!1;if(t.is("iframe")){var r=t.attr("src").split("?"),s=-1;r[1]&&(params=r[1].split("&"),jQuery.each(params,(function(e,t){-1!==t.indexOf("autoplay")&&(i=!0,s=e)})),s>-1&&params.splice(s,1)),"undefined"!=typeof params&&t.attr("src",r[0]+"?"+params.join("&"))}else(t.is("video")||t.is("audio"))&&(i=!0,t.removeAttr("autoplay"));i&&(e.val(t[0].outerHTML),$autoplay=jQuery('select[name="autoplay"]'),jQuery("option",$autoplay).prop("selected",!1).eq(1).prop("selected",!0),TweenLite.to($autoplay[0],.2,{css:{scale:1.3},onComplete:function(){TweenLite.to($autoplay[0],.2,{css:{scale:1}})}}))}}),100,e,t,a)},startSlidePreview:function(e){if(this.stopLayerPreview(!0),this.isSlidePreviewActive)return LayerSlider.stopSlidePreview(),!0;this.isSlidePreviewActive=!0,e=e||{};var t=window.lsSliderData.properties,a=lsEditor.workspace.getSize(),i=[],r=jQuery("lse-live-preview-area").css(a).show();r=jQuery('<div id="lse-preview-timeline" class="ls-wp-container">').appendTo(r),t.sliderclass&&r.addClass(t.sliderclass),LS_previewArea.hide().empty(),LayerSlider.hidePreviewSelection(),this.populateSliderPreview(r,i,{addLayerActions:!0,activeSlideOnly:!1}),e&&e.plugins&&(e.plugins=jQuery.merge(e.plugins,i));var s={type:"responsive",width:a.width,height:a.height,skin:"noskin",skinsPath:pluginPath+"layerslider/skins/",firstSlide:LS_activeSlideIndex+1,autoStart:!1,pauseOnHover:!1,startInViewport:!1,autoPlayVideos:!!t.autoplayvideos,slideBGSize:t.slideBGSize,slideBGPosition:t.slideBGPosition,globalBGColor:t.backgroundcolor,globalBGImage:t.backgroundimage,globalBGAttachment:t.globalBGAttachment,globalBGRepeat:t.globalBGRepeat,globalBGPosition:t.globalBGPosition,globalBGSize:t.globalBGSize,parallaxScrollReverse:t.parallaxScrollReverse,playByScroll:!!t.playByScroll,playByScrollStart:!!t.playByScrollStart,playByScrollSkipSlideBreaks:!!t.playByScrollSkipSlideBreaks,playByScrollSpeed:t.playByScrollSpeed||1,navButtons:!1,navStartStop:!1,showCircleTimer:!1,forceLayersOutDuration:t.forceLayersOutDuration||750,allowRestartOnResize:!!t.allowRestartOnResize,preferBlendMode:t.preferBlendMode,sliderFadeInDuration:t.sliderfadeinduration||350,plugins:i};t.maxRatio&&(s.maxRatio=t.maxRatio),r.layerSlider(jQuery.extend(!0,s,e))},stopSlidePreview:function(){if(this.isSlidePreviewActive){this.isSlidePreviewActive=!1,LS_previewArea.show();var e=jQuery("lse-live-preview-area");e.find(".ls-wp-container").layerSlider("destroy",!0),e.hide(),LayerSlider.generatePreview(),LS_Revisions.opened||(LayerSlider.showPreviewSelection(),LayerSlider.updatePreviewSelection())}},loadGoogleFont:function(e){LS_editorMeta.googleFontsEnabled&&WebFont.load({google:{families:[e+":100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"]}})},loadPreviewGoogleFonts:function(){if(LS_editorMeta.googleFontsEnabled&&window.lsSliderData.googlefonts){let e=jQuery("#lse-project-preview")[0].contentWindow,t=window.lsSliderData.googlefonts.map((e=>e.param));e.loadGoogleFonts&&e.loadGoogleFonts(t)}},reduceGoogleFontList:function(){if(lsSliderData.googlefonts.length){var e=[],t=[];t=(t=lsSliderData.googlefonts.map((function(e){return e.param}))).filter((function(e,t,a){return t===a.indexOf(e)})),jQuery.each(t,(function(t,a){var i=!1;jQuery.each(lsSliderData.layers,(function(t,r){if(jQuery.each(r.sublayers,(function(t,r){if(r.styles&&r.styles["font-family"]&&-1!==r.styles["font-family"].indexOf(a))return i=!0,e.push({param:a}),!1})),i)return!1}))})),lsSliderData.googlefonts=e}},startTransitionPreview:function(e){var t,a,i=jQuery(e),r=parseInt(i.data("key"))-1,s=i.closest(".lse-transitions-section").data("tr-type");"3d_transitions"==s?(t="3d",a=layerSliderTransitions["t"+t][r]):"2d_transitions"==s?(t="2d",a=layerSliderTransitions["t"+t][r]):"custom_3d_transitions"==s?(t="3d",a=layerSliderCustomTransitions["t"+t][r]):"custom_2d_transitions"==s&&(t="2d",a=layerSliderCustomTransitions["t"+t][r]);let l=jQuery.extend(!0,{},{width:500,height:250,imgPath:"../assets/img/",skinPath:"../layerslider/skins/",transitionType:"2d",transitionObject:null,showCircleTimer:!1,pauseOnHover:!1,skin:"noskin",slidedelay:100,startInViewport:!1},{transitionType:t,transitionObject:a,imgPath:lsTrImgPath,skinsPath:pluginPath+"layerslider/skins/"});l.slideTransition={type:l.transitionType,obj:l.transitionObject};let n=jQuery("#lse-slide-transition-sample");jQuery('<lse-b class="lse-transition-preview-slider" style="width: '+l.width+"px; height: "+l.height+'px;"> \t\t\t\t<lse-b class="ls-slide" data-ls="slidedelay: '+l.delay+';"> \t\t\t\t\t<img src="'+l.imgPath+'sample_slide_1.jpg" class="ls-bg"> \t\t\t\t</lse-b> \t\t\t\t<lse-b class="ls-slide" data-ls="slidedelay: '+l.delay+';"> \t\t\t\t\t<img src="'+l.imgPath+'sample_slide_2.jpg" class="ls-bg"> \t\t\t\t</lse-b> \t\t\t</lse-b>').appendTo(n),n.find(".lse-transition-preview-slider").layerSlider(l)},stopTransitionPreview:function(){var e=jQuery("#lse-slide-transition-sample").find(".lse-transition-preview-slider");e.length&&e.layerSlider("destroy",!0)},getPreviewProjectSettings:function(e){e=e||{};var t=window.lsSliderData.properties,a=lsEditor.workspace.getSize();width=parseInt(a.width),height=parseInt(a.height),plugins="popup"===lsSliderData.properties.type?["popup"]:[],e&&e.plugins&&(e.plugins=jQuery.merge(e.plugins,plugins));var i={type:lsSliderData.properties.type||"responsive",width:width,height:height,popupWidth:width,popupHeight:height,skin:t.skin,skinsPath:pluginPath+"layerslider/skins/",autoStart:!!t.autostart,pauseOnHover:t.pauseonhover,firstSlide:t.firstlayer,shuffleSlideshow:!!t.randomslideshow,navPrevNext:!!t.navprevnext,hoverPrevNext:!!t.hoverprevnext,navStartStop:!!t.navstartstop,navButtons:!!t.navbuttons,hoverBottomNav:!!t.hoverbottomnav,showBarTimer:!!t.bartimer,showCircleTimer:!!t.circletimer,thumbnailNavigation:t.thumb_nav,tnContainerWidth:t.thumb_container_width,tnWidth:t.thumb_width,tnHeight:t.thumb_height,tnActiveOpacity:t.thumb_active_opacity,tnInactiveOpacity:t.thumb_inactive_opacity,startInViewport:!1,autoPlayVideos:!!t.autoplayvideos,slideBGSize:t.slideBGSize,slideBGPosition:t.slideBGPosition,globalBGColor:t.backgroundcolor,globalBGImage:t.backgroundimage,globalBGAttachment:t.globalBGAttachment,globalBGRepeat:t.globalBGRepeat,globalBGPosition:t.globalBGPosition,globalBGSize:t.globalBGSize,parallaxScrollReverse:t.parallaxScrollReverse,forceLayersOutDuration:t.forceLayersOutDuration||750,allowRestartOnResize:!!t.allowRestartOnResize,preferBlendMode:t.preferBlendMode,sliderFadeInDuration:t.sliderfadeinduration||350,plugins:plugins,popupShowOnce:!0,popupShowOnTimeout:.5,popupCloseOnTimeout:lsSliderData.properties.popupCloseOnTimeout,popupCloseOnSliderEnd:lsSliderData.properties.popupCloseOnSliderEnd,popupDisableOverlay:lsSliderData.properties.popupDisableOverlay,popupShowCloseButton:lsSliderData.properties.popupShowCloseButton,popupCloseButtonStyle:lsSliderData.properties.popupCloseButtonStyle,popupOverlayClickToClose:lsSliderData.properties.popupOverlayClickToClose,popupStartSliderImmediately:lsSliderData.properties.popupStartSliderImmediately,popupFitWidth:lsSliderData.properties.popupFitWidth,popupFitHeight:lsSliderData.properties.popupFitHeight,popupPositionHorizontal:lsSliderData.properties.popupPositionHorizontal,popupPositionVertical:lsSliderData.properties.popupPositionVertical,popupDistanceLeft:lsSliderData.properties.popupDistanceLeft,popupDistanceRight:lsSliderData.properties.popupDistanceRight,popupDistanceTop:lsSliderData.properties.popupDistanceTop,popupDistanceBottom:lsSliderData.properties.popupDistanceBottom,popupDurationIn:lsSliderData.properties.popupDurationIn,popupDurationOut:lsSliderData.properties.popupDurationOut,popupDelayIn:lsSliderData.properties.popupDelayIn,popupTransitionIn:lsSliderData.properties.popupTransitionIn,popupTransitionOut:lsSliderData.properties.popupTransitionOut,popupOverlayBackground:lsSliderData.properties.popupOverlayBackground,popupOverlayDurationIn:lsSliderData.properties.popupOverlayDurationIn,popupOverlayDurationOut:lsSliderData.properties.popupOverlayDurationOut,popupOverlayTransitionIn:lsSliderData.properties.popupOverlayTransitionIn,popupOverlayTransitionOut:lsSliderData.properties.popupOverlayTransitionOut};return t.maxRatio&&(i.maxRatio=t.maxRatio),jQuery.extend(!0,i,e)},startProjectPreview:function(e){this.stopLayerPreview(!0),this.stopSlidePreview(),e=e||{};let t=jQuery("#lse-project-preview");$iframeContent=jQuery(t[0].contentDocument),$iframeBody=jQuery($iframeContent[0].body),$sliderWrapper=jQuery("#lse-project-wrapper",$iframeBody),iframeWindow=jQuery("#lse-project-preview")[0].contentWindow,iframejQuery=iframeWindow.jQuery,$sliderWrapper.html(""),LayerSlider.loadPreviewGoogleFonts();let a=LayerSlider.getPreviewProjectSettings();var i=window.lsSliderData.properties,r=i.sliderstyle,s="popup"===lsSliderData.properties.type?["popup"]:[],l=lsSliderData.properties.maxwidth||a.width||1920,n=jQuery('<div id="lse-project-preview-content" class="ls-wp-container">').appendTo($sliderWrapper);r&&n.attr("style",r),i.sliderclass&&n.addClass(i.sliderclass),"responsive"===a.type&&n.css("max-width",l),this.populateSliderPreview(n,s,{publishedSlidesOnly:!0,activeSlideOnly:!1,contentWindow:iframeWindow,skipDeviceLayers:!0,addDeviceLayersClasses:!0,addLayerActions:!0}),a.plugins=s,iframejQuery("#lse-project-preview-content").on("sliderDidLoad.layerSlider",(function(){jQuery("#lse-make-project-scrollable").is(":checked")&&lsEditor.preview.setProjectScrollable(!0),window.top.lsEditor.loading.hide()})).layerSlider(a)},stopProjectPreview:function(){(0,jQuery("#lse-project-preview")[0].contentWindow.jQuery)("#lse-project-preview-content").layerSlider("destroy",!0)},startPopupPreview:function(e){this.stopLayerPreview(!0),this.stopSlidePreview(),e=e||{};var t=window.lsSliderData.properties,a=t.sliderstyle,i="popup"===lsSliderData.properties.type?["popup"]:[],r=jQuery('<div id="lse-popup-preview" class="ls-wp-container">').appendTo("body");a&&r.attr("style",a),t.sliderclass&&r.addClass(t.sliderclass),this.populateSliderPreview(r,i,{activeSlideOnly:!1,addLayerActions:!0});let s=LayerSlider.getPreviewProjectSettings();s.plugins=i,r.layerSlider(s)},stopPopupPreview:function(){},populateSliderPreview:function(e,t,a){var i=window.lsSliderData.properties,r=window.lsSliderData.callbacks,s=window.lsPostsJSON||[];if(a=a||{},a=jQuery.extend({publishedSlidesOnly:!1,activeSlideOnly:!0,skipDeviceLayers:!0,addDeviceLayersClasses:!1,addLayerActions:!1},a),jQuery.each(window.lsSliderData.layers,(function(r,l){if(a.activeSlideOnly&&r!==LS_activeSlideIndex)return!0;if(a.publishedSlidesOnly&&l.properties.skip)return!0;var n=l.properties,o=l.sublayers.reverse(),d=n.post_offset;-1==d&&(d=r);var c,u,p=s[d],y="";for(c in n)if(""!==(u=n[c])&&"null"!==u){if("bgsize"===c&&"inherit"===u?u=i.slideBGSize:"bgposition"===c&&"inherit"===u&&(u=i.slideBGPosition),"transitionorigami"===c&&u&&-1===t.indexOf("origami")&&t.push("origami"),-1!==["thumbnail","background"].indexOf(c))continue;y+=c+":"+u+";"}var h=jQuery('<div class="ls-slide">').attr("data-ls",y).appendTo(e),S=n.background
;"[image-url]"===S&&(S=p["image-url"]),S&&jQuery('<img src="'+S+'" class="ls-bg">').appendTo(h),n.thumbnail&&jQuery('<img src="'+n.thumbnail+'" class="ls-tn">').appendTo(h);var m=n["2d_transitions"],L=n["3d_transitions"],g=n.custom_2d_transitions,v=n.custom_3d_transitions;m&&h.attr("data-ls",h.attr("data-ls")+" transition2d: "+m+"; "),L&&h.attr("data-ls",h.attr("data-ls")+" transition3d: "+L+"; "),g&&h.attr("data-ls",h.attr("data-ls")+" customtransition2d: "+g+"; "),v&&h.attr("data-ls",h.attr("data-ls")+" customtransition3d: "+v+"; "),jQuery.each(o,(function(e,t){LayerSlider.appendLivePreviewItem(e,t,h,p,a)})),l.sublayers.reverse()})),"desktop"!==LS_activeScreenType&&(a.contentWindow?a.contentWindow.attachProjectEvent("sliderDidLoad.layerSlider","slider.data.device.isMobile = true;"):jQuery(e).on("sliderDidLoad.layerSlider",(function(e,t){t.data.device.isMobile=!0}))),r)for(var l in r){var n=r[l],o=n.indexOf("{")+1,d=n.length-1;if(body=n.substring(o,d),a.contentWindow)a.contentWindow.attachProjectEvent(l,body);else try{jQuery(e).on(l,new Function("event","slider",body))}catch(e){console.error('LayerSlider: Error while calling event "'+l+'":\n\r\n\r',e)}}},startLayerPreview:function(e){if(this.stopSlidePreview(),!this.isLayerPreviewActive||(LayerSlider.stopLayerPreview(e),!e))if(LS_activeLayerIndexSet.length>1)alert(LS_l10n.SBLayerPreviewMultiSelect);else if(!(LS_activeLayerIndexSet.length<1)){this.isLayerPreviewActive=!0,LayerSlider.hidePreviewSelection(),LS_previewArea.children().addClass("lse-transparent");var t=jQuery("<div>").addClass("lse-layer-preview-wrapper").appendTo(LS_previewHolder),a=window.lsSliderData.properties,i=LS_activeSlideData.properties,r=i.post_offset;-1==r&&(r=LS_activeSlideIndex);var s,l,n=(window.lsPostsJSON||[])[r],o="";for(s in i)""!==(l=i[s])&&"null"!==l&&"slidedelay"!==s&&(o+=s+":"+l+";");a.sliderclass&&t.addClass(a.sliderclass),$s1=jQuery("<div>").attr({class:"ls-slide","data-ls":o}).appendTo(t);var d=LS_activeLayerDataSet[0],c=jQuery.extend(!0,{},d);c.transition.delayin=100,LayerSlider.appendLivePreviewItem(0,c,$s1,n),d.skip=!0,LS_previewItems[LS_activeLayerIndexSet[0]].addClass("lse-invisible");var u=lsEditor.workspace.getSize();t.layerSlider({type:"responsive",width:u.width,height:u.height,skin:"v6",skinsPath:pluginPath+"layerslider/skins/",pauseOnHover:!1,autoPlayVideos:!1,startInViewport:!1,keybNav:!1,navButtons:!1,navStartStop:!1,navPrevNext:!1}).on("slideTimelineDidComplete.layerSlider",(function(e,t){return t.api("replay"),!1}))}},stopLayerPreview:function(e){this.isLayerPreviewActive&&(this.isLayerPreviewActive=!1,LayerSlider.showPreviewSelection(),jQuery.each(LS_activeLayerDataSet,(function(e,t){t.skip=!1})),e&&LayerSlider.generateSelectedPreviewItems(),jQuery(".lse-layer-preview-wrapper").layerSlider("destroy",!0),LS_previewArea.children().removeClass("lse-transparent lse-invisible"))},appendLivePreviewItem:function(e,t,a,i,r){if(r=r||{},r=jQuery.extend({},{skipDeviceLayers:!0,addDeviceLayersClasses:!1},r),t.skip)return!0;if(r.skipDeviceLayers&&t["hide_on_"+LS_activeScreenType])return!0;var s,l=t.image,n=t.html,o=t.style||{},d=t.styles.top||0,c=t.styles.left||0,u=(t.hasOwnProperty("skip"),t.url),p=t.id,y=t.class,h=!1,S=t.innerAttributes||{},m=t.outerAttributes||{},L=t.htmlTag||"ls-layer";if(n=jQuery.trim(LS_Utils.maybeAddLineBreaksToLayerContent(t)),s=LS_Utils.shouldWrapLayerContent(t),t.icon&&-1!==["text","button","post","html"].indexOf(t.media)){n&&n.length&&(h=!0);let e,a=t.icon;try{e=jQuery(t.icon)}catch(e){}if(e){if(t.iconColor&&e.css("color",t.iconColor),t.iconGap){let a="left"===t.iconPlacement?"margin-right":"margin-left";e.css(a,t.iconGap+"em")}t.iconSize&&e.css("font-size",t.iconSize+"em"),t.iconVerticalAdjustment&&e.css("transform","translateY( "+t.iconVerticalAdjustment+"em )"),a=e[0].outerHTML}n="left"===t.iconPlacement?a+n:n+a}var g,v,f="";for(g in t.transition)v=t.transition[g],-1!==g.indexOf("perspective")&&"500"===v.toString()||("backgroundvideo"!==g||v)&&""!==v&&null!==v&&"null"!==v&&"inherit"!==v&&(f+=g+":"+v+";");let b={};for(let e in t.styles){let a=t.styles[e];!a&&0!==a||"unset"===a||"inherit"===a||"object"!=typeof a&&(a=a.toString(),";"==a.slice(-1)&&(a=a.substring(0,a.length-1)),b[e]=isNumber(a)?a+"px":a,-1!==["z-index","font-weight","opacity"].indexOf(e)&&(b[e]=a))}var _;if(t.layerBackground&&("[image-url]"===t.layerBackground?b["background-image"]='url("'+i["image-url"]+'")':b["background-image"]='url("'+t.layerBackground+'")'),b["background-color"]&&-1!==b["background-color"].indexOf("gradient")&&(b["background-image"]?b["background-image"]+=", "+b["background-color"]:b.background=b["background-color"],delete b["background-color"]),"img"===t.type||"img"===t.media){if(!l)return!0;"[image-url]"==l&&(l=i["image-url"]),_=jQuery('<img src="'+l+'" class="ls-l">').appendTo(a)}else if("post"===t.media){var w=t.post_text_length;for(var j in i)-1!==n.indexOf("["+j+"]")&&(("title"==j||"content"==j||"excerpt"==j)&&w>0&&(i[j]=i[j].substr(0,w)),n=n.replace("["+j+"]",i[j]));(_=s?jQuery("<"+L+">").html(n):jQuery(n)).appendTo(a).addClass("ls-l")}else{var I=(_=jQuery("<"+L+">").appendTo(a).html(n).addClass("ls-l")).find('iframe[src*="youtube-nocookie.com"], iframe[src*="youtube.com"], iframe[src*="youtu.be"], iframe[src*="player.vimeo"]');I.length&&I.attr("data-src",I.attr("src")).removeAttr("src")}for(var k in _.attr({id:p,style:o}).css(b).css("white-space",t.styles.wordwrap?"normal":"nowrap").addClass(y),r.addDeviceLayersClasses&&t.hide_on_desktop&&_.addClass("ls-hide-desktop"),r.addDeviceLayersClasses&&t.hide_on_tablet&&_.addClass("ls-hide-tablet"),r.addDeviceLayersClasses&&t.hide_on_phone&&_.addClass("ls-hide-phone"),S)if("class"!==k.toLowerCase())try{_[0].setAttribute(k,S[k])}catch(e){}else _.addClass(S[k]);if(-1!=d.indexOf("%")?_.css({top:d}):_.css({top:parseInt(d)}),-1!=c.indexOf("%")?_.css({left:c}):_.css({left:parseInt(c)}),u){t.linkId&&(u="#"===t.linkId.substr(0,1)?t.linkId:"[post-url]"===t.linkId?i["post-url"]:"#"),"[post-url]"===u&&(u=i["post-url"]);var x="";"#"===u&&t.linkId&&(x=' data-help="'+LS_l10n.SBPreviewLinkNotAvailable.replace("%s",t.linkName)+'" data-help-delay="1"');var Q=jQuery('<a href="'+u+'"'+x+' target="_blank"></a>');Q.attr(m),r.addLayerActions&&t.actions&&t.actions.length&&Q.attr("data-ls-actions",JSON.stringify(t.actions)),_.wrap(Q)}else{for(var D in m)"class"!==D.toLowerCase()?_[0].setAttribute(D,m[D]):_.addClass(m[D]);r.addLayerActions&&t.actions&&t.actions.length&&_.attr("data-ls-actions",JSON.stringify(t.actions))}h&&_.addClass("ls-ib-icon"),t.media&&_.addClass("ls-"+t.media+"-layer"),_.attr("data-ls",f)},updatePopupNotifications:function(){var e=jQuery("#lse-popup-notifications"),t=jQuery(".lse-popup-trigger-notification",e),a=window.lsSliderData.properties;t[jQuery.trim(a.popupShowOnTimeout)||jQuery.trim(a.popupShowOnIdle)||jQuery.trim(a.popupShowOnScroll)||a.popupShowOnLeave||jQuery.trim(a.popupShowOnClick)?"addClass":"removeClass"]("lse-dn")},updatePopupPreview:function(){var e=window.lsSliderData.properties.popupFitWidth,t=window.lsSliderData.properties.popupFitHeight,a=window.lsSliderData.properties.popupPositionVertical,i=window.lsSliderData.properties.popupPositionHorizontal,r=jQuery("#lse-selected-popup-preset .lse-popup-layout-inner");r.attr("class","lse-popup-layout-inner lse-popup-"+a+" lse-popup-"+i),e&&r.addClass("lse-popup-fitwidth").removeClass("lse-popup-"+i),t&&r.addClass("lse-popup-fitheight").removeClass("lse-popup-"+a);let s=jQuery("#lse-selected-popup-preset"),l="."+s.find(".lse-popup-layout-inner")[0].className.split(" ").join("."),n=jQuery("#lse-popup-presets "+l).closest("lse-button"),o=n.find("lse-text").text();jQuery("#lse-popup-presets .lse-active").removeClass("lse-active"),n.addClass("lse-active"),s.find("lse-text").text(o)},updateLayerPreview:function(){var e=jQuery("#lse-preview-timeline .ls-container"),t=jQuery(".ls-layer",e);e.layerSlider("updateLayerData",t,"scalein: 2; rotatein: 360; scaleout: 2; rotateout: 360; rotate: -45;")},openTransitionGallery:function(){kmw.modal.open({content:"#tmpl-transition-modal-content",minWidth:980,maxWidth:1280,maxHeight:"100%",modalClasses:"lse-transition-gallery",sidebar:{left:{width:300,customHeaderHeight:!0,content:"#tmpl-transition-modal-siderbar"}},onBeforeOpen:function(){LayerSlider.appendTransition(0,"","2d_transitions",layerSliderTransitions.t2d),LayerSlider.appendTransition(1,"","3d_transitions",layerSliderTransitions.t3d),"undefined"!=typeof layerSliderCustomTransitions&&(layerSliderCustomTransitions.t2d.length&&LayerSlider.appendTransition(3,"","custom_2d_transitions",layerSliderCustomTransitions.t2d),layerSliderCustomTransitions.t3d.length&&LayerSlider.appendTransition(4,"","custom_3d_transitions",layerSliderCustomTransitions.t3d)),jQuery("#lse-transition-window .lse-select-special-transition").each((function(){var e=jQuery(this),t=e.data("name");e[LS_activeSlideData.properties[t]?"addClass":"removeClass"]("lse-selected")})),jQuery("#transition-modal-siderbar kmw-menuitem.kmw-active").click()},onBeforeClose:function(){window.lsHideTransition&&window.lsHideTransition()}})},appendTransition:function(e,t,a,i){var r=jQuery("#lse-transitions-list .lse-transitions-section:eq("+e+") lse-row").empty(),s=LS_activeSlideData.properties[a];if(s=s?s.split(","):[],i&&i.length)for(c=0;c<i.length;c++){var l="";-1==s.indexOf(""+(c+1))&&"all"!=s||(l="lse-selected"),r.append(jQuery('<lse-col data-tt-de="0" data-tt=".tt-slide-transition-sample" class="lse-transition-item '+l+'"data-key="'+(c+1)+'">'+i[c].name+"</lse-col>"))}},selectAllTransition:function(e,t){var a=jQuery("#lse-transitions-modal-select-button"),i=jQuery("#lse-transitions-list .lse-transitions-section").eq(e).data("tr-type");t?(jQuery("#lse-transitions-list .lse-transitions-section:eq("+e+")").find(".lse-transition-item").addClass("lse-selected"),a.attr("class","lse-on").text(LS_l10n.deselectAll),LS_activeSlideData.properties[i]="all"):(jQuery("#lse-transitions-list .lse-transitions-section:eq("+e+")").find(".lse-transition-item").removeClass("lse-selected"),a.attr("class","lse-off").text(LS_l10n.selectAll),LS_activeSlideData.properties[i]="")},toggleTransition:function(e){var t=jQuery(e),a=t.closest(".lse-transitions-section"),i=a.find(".lse-transition-item"),r=a.data("tr-type");if(t.toggleClass("lse-selected"),i.filter(".lse-selected").length!==i.length){jQuery("#lse-transitions-modal-select-button").attr("class","lse-off").text(LS_l10n.selectAll);var s=[];i.filter(".lse-selected").each((function(){s.push(jQuery(this).data("key"))})),LS_activeSlideData.properties[r]=s.join(",")}else LayerSlider.selectAllTransition(a.index(),!0)},showEditorWarnings:function(){let e=!1,t=1e3,a=!1;lsSliderData.googlefonts.length&&!LS_editorMeta.googleFontsEnabled&&(e=!0),"popup"!==window.lsSliderData.properties.type||LS_editorMeta.isActivatedSite||(a=!0),e&&a&&(t=7e3),e&&setTimeout((()=>{lsEditor.notify.show({icon:"font-case",text:LS_l10n.notifyGoogleFontsMissing,timeout:5e3})}),t),a&&setTimeout((()=>{lsEditor.notify.show({icon:"window-maximize",text:LS_l10n.notifyMissingPopup,timeout:5e3,className:"lse-bg-highlight"})}),1e3)},prepareSaveData:function(){lsEditor.preview.exit(),LayerSlider.reduceGoogleFontList();var e=jQuery.extend(!0,{},window.lsSliderData);return e.properties=JSON.stringify(e.properties),jQuery.each(e.layers,(function(t,a){a.properties.post_content=!1,jQuery.each(a.sublayers,(function(i,r){r.styles&&jQuery.each(r.styles,(function(e,t){""===t&&delete r.styles[e]})),r.transition=JSON.stringify(r.transition),r.styles=JSON.stringify(r.styles),!1===a.properties.post_content&&"post"==r.media&&(a.properties.post_content=!0);var s=LS_DataSource.uuidForLayer(i,t);e.layers[t].sublayers[i].uuid=s})),a.sublayers.reverse(),e.layers[t]=JSON.stringify(a)})),e},save:function(e){e=e||{},jQuery("#lse-save-button").addClass("lse-action");var t=LayerSlider.prepareSaveData();jQuery.ajax({type:"POST",url:ajaxurl,dataType:"text",data:{_wpnonce:jQuery('#lse-editor-form input[name="_wpnonce"]').val(),_wp_http_referer:jQuery('#lse-editor-form input[name="_wp_http_referer"]').val(),action:"ls_save_slider",id:LS_sliderID,sliderData:t,dirty:LS_sliderIsDirty?1:0},error:function(e,t,a){jQuery("#lse-save-button").removeClass("lse-action"),setTimeout((function(){alert(LS_l10n.SBSaveError.replace("%s",a))}),100)},success:function(e,t){LS_editorIsDirty&&LS_sliderIsDirty&&((parseInt(localStorage["lse-menu-more-displayed"])||0)<3&&LS_draftNoticeOpened<1&&jQuery("lse-editor").addClass("lse-menu-more-badge"),jQuery("lse-editor").addClass("lse-draft-edit"));if(jQuery("lse-editor").removeClass("lse-draft-available"),history.replaceState&&-1!=document.location.href.indexOf("&ignore-drafts")){var a=document.location.href.replace("&ignore-drafts","");history.replaceState(null,document.title,a)}lsSetEditorDirtyState(!1),jQuery("#lse-save-button").removeClass("lse-action"),lsEditor.notify.show({icon:"save",text:LS_l10n.notifyProjectSaved,timeout:2e3})},complete:function(e){setTimeout((function(){jQuery("#lse-save-button").removeClass("lse-action")}),2e3)}})},publish:function(e){e=e||{},jQuery("#lse-publish-button").addClass("lse-action");var t=LayerSlider.prepareSaveData();jQuery.ajax({type:"POST",url:ajaxurl,dataType:"text",data:{_wpnonce:jQuery('#lse-editor-form input[name="_wpnonce"]').val(),_wp_http_referer:jQuery('#lse-editor-form input[name="_wp_http_referer"]').val(),action:"ls_publish_slider",id:LS_sliderID,sliderData:t},error:function(e,t,a){jQuery("#lse-publish-button").removeClass("lse-action"),setTimeout((function(){alert(LS_l10n.SBSaveError.replace("%s",a))}),100)},success:function(e,t){lsSetSliderDirtyState(!1),lsSetEditorDirtyState(!1),jQuery("lse-editor").removeClass("lse-draft-edit lse-menu-more-badge"),jQuery("#lse-publish-button").removeClass("lse-action"),lsEditor.notify.show({icon:"upload",text:LS_l10n.notifyProjectPublished,timeout:3e3})},complete:function(e){setTimeout((function(){jQuery("#lse-publish-button").removeClass("lse-action")}),2e3)}})}},LS_IconLibrary={iconsLoader:null,createLayer:!1,replaceIcon:!1,callback:!1,init:function(){jQuery(document).on("click","#lse-insert-icons-modal-window .lse-icons-display-areas lse-b",(function(e){e.preventDefault(),LS_IconLibrary.insert(this)})).on("click","#lse-insert-icons-modal-window .lse-installable-icon",(function(){LS_IconLibrary.downloadIcons(this,jQuery(this).closest("kmw-menuitem").data("module"))})).on("click","#lse-insert-icons-modal-window kmw-menuitem:not(.kmw-disabled)",(function(){LS_IconLibrary.loadFamily(this)}))},downloadIcons:function(e,t){if(!t)return;let a=jQuery(e),i=a.closest("kmw-menuitem");lsEditor.loading.show("modal",LS_l10n.moduleDLIcons),jQuery.getJSON(ajaxurl,{action:"ls_download_module",module:t.handle},(function(e){lsEditor.loading.hide(),e&&e.success?(a.hide(),i.removeClass("kmw-disabled").click()):e&&e.message&&kmw.modal.open({title:LS_l10n.moduleDLErrorTitle,content:e.message,animationIn:"scale",overlaySettings:{animationIn:"fade"}})}))},loadFamily:function(e){let t=jQuery(e),a=t.data("url"),i=t.data("icons-data");i?LS_IconLibrary.selectFamily(e,i):(t.addClass("lse-loading"),import(a).then((a=>{let i=a.iconsData;i&&i.icons&&(t.data("icons-data",i),setTimeout((function(){t.removeClass("lse-loading"),LS_IconLibrary.selectFamily(e,i)}),300))})))},selectFamily:function(e,t){let a=jQuery(e),i=jQuery("#lse-insert-icons-modal-window"),r=i.find(".lse-icons-credits"),s=a.find("kmw-menutext").text();i.find(".kmw-modal-title").text(s),r.find(".lse-icons-count").text(Object.keys(t.icons).length),r.removeClass("lse-icon-type-font").removeClass("lse-icon-type-svg").addClass("lse-icon-type-"+t.type),r.find(".lse-icons-author a").attr("href",t.url).text(t.author),LS_IconLibrary.iconsLoader?LS_IconLibrary.iconsLoader.changeIconSet(t):LS_IconLibrary.iconsLoader=new LS_IconLoader(t)},open:function(e){e=e||{},LS_IconLibrary.createLayer=e.createLayer,LS_IconLibrary.callback="function"==typeof e&&e,kmw.modal.open({id:"lse-insert-icons-modal-window",content:jQuery("#tmpl-insert-icons-modal"),minWidth:400,maxHeight:"100%",maxWidth:1200,sidebar:{left:{width:300,customHeaderHeight:!0,content:jQuery("#tmpl-insert-icons-sidebar")}}})},insert:function(e){var t=jQuery(e),a=t.find("svg"),i='<i class="fa fa-'+t.data("help")+'"></i>',r=LS_activeLayerDataSet[0],s=LS_activeLayerIndexSet[0],l={html:"",styles:{}},n=100,o={};if(redoObj={},a.length&&(i=a[0].outerHTML),LS_IconLibrary.callback)return LS_IconLibrary.callback(e),void LS_IconLibrary.close();LS_IconLibrary.createLayer?(l.html=i,l.styles={"font-size":64},LayerSlider.addFormattedLayer("icon",l)):("icon"===r.media&&(a.length?(r.styles.width||(o.styles||(o.styles={}),redoObj.styles||(redoObj.styles={}),o.styles.width="",redoObj.styles.width=n,r.styles.width=n),r.styles.height||(o.styles||(o.styles={}),redoObj.styles||(redoObj.styles={}),o.styles.height="",redoObj.styles.height=n,r.styles.height=n),r.styles["font-size"]&&(o.styles||(o.styles={}),redoObj.styles||(redoObj.styles={}),o.styles["font-size"]=r.styles["font-size"],redoObj.styles["font-size"]="",r.styles["font-size"]="")):(r.styles.width&&(o.styles||(o.styles={}),redoObj.styles||(redoObj.styles={}),o.styles.width=r.styles.width,redoObj.styles.width="",r.styles.width=""),r.styles.height&&(o.styles||(o.styles={}),redoObj.styles||(redoObj.styles={}),o.styles.height=r.styles.height,redoObj.styles.height="",r.styles.height=""),r.styles["font-size"]||(o.styles||(o.styles={}),redoObj.styles||(redoObj.styles={}),o.styles["font-size"]="",redoObj.styles["font-size"]=64,r.styles["font-size"]=64))),o.html=r.html||"",redoObj.html=i,r.html=i,LS_UndoManager.add("layer.general","LAYER_ICON",{itemIndex:s,undo:o,redo:redoObj}),LayerSlider.generatePreviewItem(s)),LS_DataSource.buildLayer(),LS_IconLibrary.close()},insertPicker:function(e,t){var a=jQuery(e),i=jQuery(t),r=i.find("svg"),s='<i class="fa fa-'+i.data("help")+'"></i>',l={};r.length&&(s=r[0].outerHTML),l[a.data("prop")]=s,LS_DataSource.updateProperties("layer.general","LAYER_ICON",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],l),LS_DataSource.buildLayer(),LayerSlider.autoRenameLayer(LS_activeLayerIndexSet[0]),LayerSlider.generateSelectedPreviewItems(),LS_IconLibrary.close()},close:function(){kmw.modal.close()}},LS_InsertMedia={init:function(){jQuery("lse-layer-settings").on("click",".lse-open-media-modal",(function(e){e.preventDefault(),LS_InsertMedia.open()})),jQuery(document).on("input","#lse-insert-media-modal-window input, #lse-insert-media-modal-window textarea",(function(){LS_InsertMedia.preview(jQuery(this))})),jQuery(document).on("click","#lse-insert-media-modal-window lse-button.lse-html5-button",(function(e){e.preventDefault(),kmw.modal.close(!1,{onClose:function(){jQuery("lse-layer-settings .lse-insert-media").click()}})})),jQuery(document).on("click","#lse-insert-media-modal-window lse-button.lse-insert",(function(e){e.preventDefault(),LS_InsertMedia.insert(jQuery(this))}))},open:function(){kmw.modal.open({content:"#tmpl-insert-media-modal",minWidth:980,maxWidth:980})},parseURL:function(){},preview:function(e){var t,a,i=jQuery("#lse-insert-media-modal-window .lse-media-preview"),r=e.val();if(""!==r)if(e.is("input"))-1!==r.indexOf("vimeo")?(t=LS_InsertMedia.parseVimeoURL(r))&&i.html('<iframe src="https://player.vimeo.com/video/'+t+'" width="240" height="240" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>'):-1!==r.indexOf("youtu")&&(t=LS_InsertMedia.parseYouTubeURL(r))&&i.html('<iframe width="240" height="240" src="https://www.youtube.com/embed/'+t+'" frameborder="0" allowfullscreen></iframe>');else try{(a=jQuery(r)).attr({width:240,height:240}),i.html(a)}catch(e){i.html("")}else i.html("")},parseYouTubeURL:function(e){var t=e.match(/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))([^#\&\?]*).*/);return!(!t||!t[1])&&t[1]},parseVimeoURL:function(e){var t=e.match(/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/);return!(!t||!t[5])&&t[5]},insert:function(e){var t=jQuery("#lse-layer-content"),a=t.val(),i=e.closest("td").prev().find(":input").val(),r=!1;e.hasClass("lse-insert-url")?-1!==i.indexOf("vimeo")?(videoID=LS_InsertMedia.parseVimeoURL(i),videoID&&(r=!0,t.val('<iframe src="https://player.vimeo.com/video/'+videoID+'" width="640" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>'))):-1!==i.indexOf("youtu")&&(videoID=LS_InsertMedia.parseYouTubeURL(i),videoID&&(r=!0,t.val('<iframe width="560" height="315" src="https://www.youtube.com/embed/'+videoID+'" frameborder="0" allowfullscreen></iframe>'))):(r=!0,t.val(i)),r&&(LS_UndoManager.add("layer.general","LAYER_SETTINGS",{itemIndex:LS_activeLayerIndexSet[0],undo:{html:a},redo:{html:t.val()}}),LS_activeLayerDataSet[0].html=t.val(),LayerSlider.generatePreviewItem(LS_activeLayerIndexSet[0]),LS_InsertMedia.close())},close:function(){kmw.modal.close()}},LS_ButtonLibrary={init:function(){jQuery("lse-layer-settings").on("click",".lse-choose-button-preset",(function(e){e.preventDefault(),LS_ButtonLibrary.open()})),jQuery(document).on("click","#lse-button-presets-modal-window lse-button-preset",(function(){LS_ButtonLibrary.apply(this)}))},open:function(){kmw.modal.open({content:"#tmpl-button-presets",id:"lse-button-presets-modal-window",maxWidth:980,minWidth:980,onBeforeOpen:function(){$modal=jQuery("#lse-button-presets-modal-window"),jQuery.each(LS_ButtonPresets,(function(e,t){$modal.find('lse-button-preset[data-button-preset="'+e+'"]').css(t.styles)}))}})},apply:function(e){let t,a=jQuery(e),i=a.find("svg"),r=a.data("button-preset"),s=LS_ButtonPresets[r],l=LS_activeLayerDataSet[0],n=LS_activeLayerDataSet[0].styles,o={styles:{}},d={styles:{}},c=[];if(s){if(s.styles.top=n.top||"",s.styles.left=n.left||"",s.styles.cursor="pointer",s.styles.wordwrap=!1,jQuery.each(s,(function(e,a){t=[],"styles"===e&&(t=jQuery(".lse-layer-style-panel :input[name]")),t.each((function(){let t=jQuery(this).attr("name");newVal=s[e][t]||"",t&&-1===c.indexOf(t)&&(c.push(t),"background-color"!==t||newVal||s[e].background&&(newVal=s[e].background,o[e]["background-colorData"]=l[e]["background-colorData"]||"",d[e]["background-colorData"]=s[e].backgroundData,l[e]["background-colorData"]=s[e].backgroundData),o[e][t]=l[e][t]||"",d[e][t]=newVal,l[e][t]=newVal)}))})),i.length){let e=i[0].outerHTML;o.html=LS_activeLayerDataSet[0].html||"",d.html="",o.icon=LS_activeLayerDataSet[0].icon||"",d.icon=e,LS_activeLayerDataSet[0].html="",LS_activeLayerDataSet[0].icon=e}LS_activeLayerDataSet[0].style&&(o.style=LS_activeLayerDataSet[0].style,d.style="",LS_activeLayerDataSet[0].style=""),LS_UndoManager.add("layer.general","BUTTON_PRESET",{itemIndex:LS_activeLayerIndexSet[0],undo:o,redo:d}),LS_DataSource.buildLayer(LS_activeLayerIndexSet[0]),LayerSlider.generatePreviewItem(LS_activeLayerIndexSet[0]),LS_ButtonLibrary.close()}else LS_ButtonLibrary.close()},close:function(){kmw.modal.close()}},LS_ImportSlide={init:function(){jQuery(document).on("click","#lse-import-slide",(function(e){e.preventDefault(),LS_ImportSlide.open()})),jQuery(document).on("click","#lse-import-slide-modal-window .lse-import-layer-sliders .lse-slider-item",(function(){LS_ImportLayer.selectSlider(this)})),jQuery(document).on("click","#lse-import-slide-modal-window .lse-import-layer-slides .lse-slider-item",(function(){LS_ImportSlide.selectSlide(this)}))},open:function(){kmw.modal.open({content:"#tmpl-import-slide",maxWidth:980,minWidth:980,maxHeight:"100%",onOpen:function(){LS_ImportLayer.loadSliders()}})},selectSlide:function(e){var t=jQuery(e);t.addClass("lse-added"),t.find(".lse-preview").append(LS_InterfaceIcons.notifications.checkCircle),LayerSlider.addSlide(t.data("slide-data"),{selectSlide:!0})}},LS_ImportLayer={init:function(){jQuery(document).on("click","#lse-import-layer-modal-window .lse-import-layer-sliders .lse-slider-item",(function(){LS_ImportLayer.selectSlider(this)})),jQuery(document).on("click","#lse-import-layer-modal-window .lse-import-layer-slides .lse-slider-item",(function(){LS_ImportLayer.selectSlide(this)})),jQuery(document).on("click","#lse-import-layer-modal-window .lse-import-layer-layers .lse-layer-item",(function(){LS_ImportLayer.selectLayer(this)}))},open:function(){kmw.modal.open({content:"#tmpl-import-layer",minWidth:980,maxWidth:980,maxHeight:"100%"}),setTimeout((function(){LS_ImportLayer.loadSliders()}),300)},loadSliders:function(){jQuery.getJSON(ajaxurl,{action:"ls_get_mce_sliders"},(function(e){var t=jQuery(".lse-import-layer-sliders");e&&e.length?(t.empty(),jQuery.each(e,(function(e,a){var i=jQuery('<lse-b class="lse-slider-item">\t\t\t\t\t\t<lse-b class="lse-slider-item-wrapper">\t\t\t\t\t\t\t<lse-b class="lse-preview">\t\t\t\t\t\t\t\t<lse-b class="lse-no-preview">\t\t\t\t\t\t\t\t\t<lse-h5>'+LS_MCE_l10n.MCENoPreview+'</lse-h5>\t\t\t\t\t\t\t\t</lse-b>\t\t\t\t\t\t\t</lse-b>\t\t\t\t\t\t\t<lse-b class="lse-info">\t\t\t\t\t\t\t\t<lse-b class="lse-name"></lse-b>\t\t\t\t\t\t\t</lse-b>\t\t\t\t\t\t</lse-b>\t\t\t\t\t</lse-b>');i.data({id:a.id,slug:a.slug}),a.preview&&jQuery(".lse-preview",i).empty().css({"background-image":"url("+a.preview+")"}),jQuery(".lse-name",i).html(a.name),i.appendTo(t)}))):t.html(LS_l10n.SBImportLayerNoProject)}))},selectSlider:function(e){var t=jQuery(e);t.addClass("lse-selected").siblings().removeClass("lse-selected"),jQuery(".lse-import-layer-layers").html(LS_l10n.SBImportLayerSelectSlide),LS_ImportLayer.loadSlides(t.data("id"))},loadSlides:function(e){jQuery.getJSON(ajaxurl,{action:"ls_get_mce_slides",sliderID:e},(function(e){var t=jQuery(".lse-import-layer-slides");e&&e.length?(t.empty(),jQuery.each(e,(function(e,a){if(!a||!a.properties)return!0;var i=jQuery('<lse-b class="lse-slider-item">\t\t\t\t\t\t<lse-b class="lse-slider-item-wrapper">\t\t\t\t\t\t\t<lse-b class="lse-preview">\t\t\t\t\t\t\t\t<lse-b class="lse-no-preview">\t\t\t\t\t\t\t\t\t<lse-h5>'+LS_MCE_l10n.MCENoPreview+'</lse-h5>\t\t\t\t\t\t\t\t</lse-b>\t\t\t\t\t\t\t</lse-b>\t\t\t\t\t\t\t<lse-b class="lse-info">\t\t\t\t\t\t\t\t<lse-b class="lse-name"></lse-b>\t\t\t\t\t\t\t</lse-b>\t\t\t\t\t\t</lse-b>\t\t\t\t\t</lse-b>');if(i.data("slide-data",a),a.properties.background||a.properties.thumbnail){var r=a.properties.thumbnail||a.properties.background;jQuery(".lse-preview",i).empty().css({"background-image":"url("+r+")"})}jQuery(".lse-name",i).html(a.properties.title),i.appendTo(t)}))):t.html(LS_l10n.SBImportLayerNoSlide)}))},selectSlide:function(e){var t=jQuery(e);t.addClass("lse-selected").siblings().removeClass("lse-selected"),LS_ImportLayer.loadLayers(t.data("slide-data"))},loadLayers:function(e){var t=jQuery(".lse-import-layer-layers");if(e&&e.sublayers&&e.sublayers.length){t.html("<lse-table-wrapper><table><tbody></tbody></table></lse-table-wrapper>");var a=jQuery(".lse-import-layer-layers table tbody");jQuery.each(e.sublayers,(function(e,t){var i=jQuery('<tr class="lse-layer-item">\t\t\t\t\t<td>\t\t\t\t\t\t<lse-b class="lse-layer-thumb-wrapper">\t\t\t\t\t\t\t<lse-b class="lse-layer-thumb lse-it-fix"></lse-b>\t\t\t\t\t</lse-b>\t\t\t\t\t</td>\t\t\t\t\t<td class="lse-name">\t\t\t\t\t\t<lse-b>\t\t\t\t\t\t\t<lse-i></lse-i>\t\t\t\t\t\t</lse-b>\t\t\t\t\t</td>\t\t\t\t</tr>');i.data("layer-data",t),LayerSlider.setLayerMedia(t.media,jQuery(".lse-layer-thumb",i),t),jQuery(".lse-name lse-i",i).html(t.subtitle),i.appendTo(a)}))}else t.html(LS_l10n.SBImportLayerNoLayer)},selectLayer:function(e){$tr=jQuery(e),$tr.addClass("lse-added"),LayerSlider.addLayer([$tr.data("layer-data")])},close:function(){kmw.modal.close()}},LS_PostOptions={init:function(){jQuery("body").on("click",".lse-configure-post-options",(function(e){e.preventDefault(),LS_PostOptions.open(this)})),jQuery("#lse-post-options select:not(.lse-post-taxonomy, .lse-post-offset)").change((function(){window.lsSliderData.properties[jQuery(this).attr("name")]=jQuery(this).val(),LS_PostOptions.change(this)})),jQuery("#lse-post-options select.lse-post-offset").change((function(){LS_activeSlideData.properties.post_offset=jQuery(this).val(),LayerSlider.willGeneratePreview()})),jQuery("#lse-post-options select.lse-post-taxonomy").change((function(){window.lsSliderData.properties.post_taxonomy=jQuery(this).val(),LS_PostOptions.getTaxonoies(this)})),jQuery("#lse-post-placeholders").on("click","lse-button",(function(){LS_PostOptions.insertPlaceholder(this)}))},open:function(e){kmw.modal.open({content:jQuery("#lse-post-options"),minWidth:980,maxWidth:1180,spacing:10});var t=parseInt(LS_activeSlideData.properties.post_offset)+1,a=jQuery("#lse-post-options").show();a.find("select.lse-post-offset option").prop("selected",!1).eq(t).prop("selected",!0),0===a.find(".lse-post-previews lse-row").children().length&&LS_PostOptions.change(a.find("select")[0])},getTaxonoies:function(e){var t=jQuery(e).next().empty();0==jQuery(e).val()?LS_PostOptions.change(e):jQuery.post(ajaxurl,jQuery.param({action:"ls_get_taxonomies",taxonomy:jQuery(e).val()}),(function(e){for(e=jQuery.parseJSON(e),c=0;c<e.length;c++)t.append(jQuery("<option>",{value:e[c].term_id,text:e[c].name}))}))},change:function(e){var t={};jQuery("#lse-post-options").find("select").each((function(){t[jQuery(this).data("param")]=jQuery(this).val()})),jQuery.post(ajaxurl,jQuery.param({action:"ls_get_post_details",params:t}),(function(t){var a=jQuery.parseJSON(t);window.lsPostsJSON=a,LayerSlider.willGeneratePreview(),LS_PostOptions.update(e,a)}))},update:function(e,t){var a=jQuery("#lse-post-options").find(".lse-post-previews lse-row").empty();if(0===t.length)a.append(jQuery('<lse-col class="lse-p-0 lse-tac" style="margin-top: 105px;">').append(jQuery("<lse-h3>",{text:LS_l10n.SBPostFilterWarning})));else for(c=0;c<t.length;c++){var i=t[c].content;i&&(i=(i=i.replace(/<br>/g,"")).replace(/<br \/>/g,"")),a.append(jQuery("<lse-col>").append(jQuery("<lse-i>",{class:"lse-post-counter",text:c+1})).append(jQuery("<lse-ib>",{class:"lse-post-image"}).css("background-image","url("+t[c]["thumbnail-url"]+")")).append(jQuery("<lse-h3>",{html:t[c].title})).append(jQuery("<lse-b>",{class:"lse-post-author",text:t[c]["date-published"]+" by "+t[c].author})))}},close:function(){kmw.modal.close()},insertPlaceholder:function(e){var t=jQuery("#lse-layer-content")[0],a=void 0!==jQuery(e).data("placeholder")?jQuery(e).data("placeholder"):jQuery(e).text();if(document.selection)t.focus(),document.selection.createRange().text=a,t.focus();else if(t.selectionStart||0===t.selectionStart){var i=t.selectionStart,r=t.selectionEnd,s=t.scrollTop;t.value=t.value.substring(0,i)+a+t.value.substring(r,t.value.length),t.focus(),t.selectionStart=i+a.length,t.selectionEnd=i+a.length,t.scrollTop=s}else t.value+=a,t.focus();jQuery(t).trigger("input").trigger("change")}},LS_PostChooser={timeout:null,data:null,opened:null,init:function(){jQuery(document).on("click",".lse-link-fields .lse-link-post",(function(e){LS_PostChooser.opener=this,LS_PostChooser.open()})).on("click","#lse-post-chooser-modal-window .lse-link-item",(function(e){e.preventDefault(),LS_PostChooser.select(jQuery(this))})).on("input","#lse-post-chooser-modal-window input",(function(e){LS_PostChooser.search()})).on("change","#lse-post-chooser-modal-window select",(function(e){LS_PostChooser.search(1)})).on("submit","#lse-post-chooser-modal-window form",(function(e){e.preventDefault(),LS_PostChooser.search(1)}))},open:function(){kmw.modal.open({uid:"lse-post-chooser",content:"#tmpl-post-chooser",minWidth:720,maxWidth:930,maxHeight:"100%",onClose:function(){LS_PostChooser.close()}}),this.search()},search:function(e){e=e||300,clearTimeout(LS_PostChooser.timeout),LS_PostChooser.timeout=setTimeout((function(){var e=jQuery("#lse-post-chooser-modal-window form");jQuery.getJSON(ajaxurl,e.serialize(),(function(e){LS_PostChooser.data=e,jQuery("#lse-post-chooser-modal-window .lse-post-previews lse-row").empty(),jQuery.each(e,(function(e,t){let a=t["image-url"]&&-1===t["image-url"].indexOf("blank.gif")
;jQuery('<lse-col class="lse-link-item lse-half">\t\t\t\t\t\t\t\t<lse-table-wrapper>\t\t\t\t\t\t\t\t\t<lse-b class="lse-featured-image-wrapper">\t\t\t\t\t\t\t\t\t\t<lse-b class="lse-no-featured-image '+(a?"lse-dn":"")+'">\t\t\t\t\t\t\t\t\t\t\t'+LS_l10n.SBNoPreview+'\t\t\t\t\t\t\t\t\t\t</lse-b>\t\t\t\t\t\t\t\t\t\t<lse-b class="lse-featured-image" style="background-image: url('+t["image-url"]+');">\t\t\t\t\t\t\t\t\t\t</lse-b>\t\t\t\t\t\t\t\t\t</lse-b>\t\t\t\t\t\t\t\t\t<lse-b class="lse-post-info">\t\t\t\t\t\t\t\t\t\t<lse-h3>'+t.title+'</lse-h3>\t\t\t\t\t\t\t\t\t\t<lse-b class="lse-author">'+t["date-published"]+" by "+t.author+"</lse-b>\t\t\t\t\t\t\t\t\t</lse-b>\t\t\t\t\t\t\t\t</lse-table-wrapper>\t\t\t\t\t\t\t</lse-col>").appendTo("#lse-post-chooser-modal-window .lse-post-previews lse-row")}))}))}),e)},select:function(e){var t=LS_PostChooser.data[e.index()],a="SBLinkText"+ucFirst(t["post-type"]),i=jQuery(LS_PostChooser.opener).closest(".lse-link-fields"),r=jQuery(".lse-link-url-input",i);t.title=jQuery("<textarea>").html(t.title).text(),r.val(LS_l10n[a].replace("%s",t.title)).prop("disabled",!0).next().val(t["post-id"]).next().val(t.title).next().val(t["post-type"]);var s=i.closest("lse-slide-settings").length,l=s?LS_activeSlideData.properties:LS_activeLayerDataSet[0],n=s?"SLIDE_SETTINGS":"LAYER_SETTINGS",o=s?"slide.general":"layer.general",d=s?LS_activeSlideIndex:LS_activeLayerIndexSet[0],c=s?"layer_link":"url";LS_UndoManager.add(o,n,{itemIndex:d,undo:{[c]:l[c]||"",linkId:l.linkId||"",linkName:l.linkName||"",linkType:l.linkType||""},redo:{[c]:LS_l10n[a].replace("%s",t.title),linkId:t["post-id"],linkName:t.title,linkType:t["post-type"]}}),i.addClass("lse-has-link").find("input").trigger("input"),kmw.modal.close("lse-post-chooser")},close:function(){LS_PostChooser.opened=!1,jQuery("#lse-post-chooser-modal-window .lse-post-previews lse-row").empty()}},LS_DataSource={reloadEditorData:function(){window.LS_activeSlideData=window.lsSliderData.layers[LS_activeSlideIndex],window.LS_activeSlideData.sublayers.length&&(window.LS_activeLayerIndexSet=[0]),lsEditor.preview.exit(),LayerSlider.rebuildSlides(),LS_DataSource.buildSlide(),LayerSlider.generatePreview(),LayerSlider.selectLayer(LS_activeLayerIndexSet,{forceSelect:!0}),LayerSlider.updatePreviewSelection(),LS_UndoManager.update()},buildSlide:function(){var e=jQuery("lse-slide-settings"),t=(LS_DataSource.getDefaultSlideData(),(t=e.find("input,textarea,select")).add(jQuery('input[name="slidedelay"]'))),a=jQuery("input,textarea,select",e).filter(".lse-restore-prop");LS_DataSource.setFormItemValues(t,LS_activeSlideData.properties),LS_GUI.updateImagePicker("background",LS_activeSlideData.properties.backgroundThumb),LS_GUI.updateImagePicker("thumbnail",LS_activeSlideData.properties.thumbnailThumb),LS_GUI.updateLinkPicker("layer_link"),a.trigger("input."+lsEditor.settings.nameSpace),jQuery("lse-slide-settings .lse-datepicker-input").each((function(){var e=jQuery(this),t=jQuery(this).data("datepickerKey");if(LS_preventDatePickerChange=!0,e.data("datepicker").clear(),t&&LS_activeSlideData.properties[t]){var a=LS_activeSlideData.properties[t]+""+LS_Utils.jsTimeZoneID();startDate=new Date(a),e.data("datepicker")&&(e.data("datepicker").selectDate(startDate),e.trigger("keyup"))}LS_preventDatePickerChange=!1})),LayerSlider.updateCustomSlideProperties(),this.buildLayersList()},buildLayersList:function(e){e=e||{updateLayer:!0};for(var t=jQuery("#lse-layers-list").empty(),a=LS_activeSlideData.sublayers?LS_activeSlideData.sublayers.length:0,i=jQuery(jQuery("#lse-layer-item-template").html()),r=0;r<a;r++){var s=LS_activeSlideData.sublayers[r],l=i.clone();l.find(".lse-layer-text input").val(s.subtitle),s.skip&&l.find(".lse-hide-layer").addClass("lse-hidden"),s.locked&&l.find(".lse-lock-layer").addClass("lse-locked"),l[s["hide_on_"+LS_activeScreenType]?"addClass":"removeClass"]("lse-dim"),LayerSlider.setLayerMedia(s.media,jQuery(".lse-layer-thumb",l),s),t.append(l)}jQuery(".lse-static-layers-head").hide(),jQuery("#lse-static-layers-list").empty(),LS_activeStaticLayersDataSet.length&&(jQuery(".lse-static-layers-head").show(),i=jQuery(jQuery("#lse-static-layer-item-template").html()),jQuery.each(LS_activeStaticLayersDataSet,(function(e,t){var a=t.layerData,r=i.clone();r.find(".lse-layer-title").text(a.subtitle),LayerSlider.setLayerMedia(a.media,jQuery(".lse-layer-thumb",r),a),r.appendTo("#lse-static-layers-list")}))),jQuery.each(LS_activeLayerIndexSet,(function(e,a){t.children().eq(a).addClass("lse-active")})),e.updateLayer&&this.buildLayer()},buildLayersListItem:function(e){if(!LS_activeLayerDataSet.length||!LS_activeSlideData.sublayers.length)return!1;e=e||LS_activeLayerIndexSet[0];var t=LS_activeSlideData.sublayers[e],a=jQuery(jQuery("#lse-layer-item-template").html()),i=jQuery("#lse-layers-list lse-li").eq(e);$layer=a.clone(),$layer.find(".lse-layer-title").val(t.subtitle),t.skip&&$layer.find(".lse-hide-layer").addClass("lse-hidden"),t.locked&&$layer.find(".lse-lock-layer").addClass("lse-locked"),$layer[t["hide_on_"+LS_activeScreenType]?"addClass":"removeClass"]("lse-dim"),LS_activeLayerIndexSet[0]===i.index()&&$layer.addClass("lse-active"),LayerSlider.setLayerMedia(t.media,jQuery(".lse-layer-thumb",$layer),t),i.replaceWith($layer)},buildLayer:function(){if(!LS_activeLayerDataSet.length||!LS_activeSlideData.sublayers.length)return!1;jQuery("#lse-layers-list lse-li.lse-active");var e=jQuery("lse-layer-settings lse-sidebar-body"),t=LS_activeLayerIndexSet[0],a=LS_activeLayerDataSet[0],i=jQuery("input,textarea,select",e).filter(":not(.lse-style-prop,.lse-transition-prop)"),r=jQuery("input,textarea,select",e).filter(".lse-style-prop"),s=jQuery("input,textarea,select",e).filter(".lse-transition-prop"),l=jQuery("input,textarea,select",e).filter(".lse-restore-prop");LS_DataSource.setFormItemValues(i,a),LS_DataSource.setFormItemValues(r,a.styles),a.transition&&!jQuery.isEmptyObject(a.transition)||this.restoreOldTransitionSettings(s),LS_DataSource.setFormItemValues(s,a.transition),LayerSlider.updateLayerInterfaceItems(t),l.trigger("input."+lsEditor.settings.nameSpace),LayerSlider.setupStaticLayersChooser(e.find('select[name="static"]')[0]),LS_activeLayerIndexSet.length>1&&LayerSlider.startMultipleSelection()},setFormItemValues:function(e,t){if(!e||!t||jQuery.isEmptyObject(t))return!1;for(let a=0;a<e.length;a++){let i,r=jQuery(e[a]),s=r.attr("data-prop"),l=r.attr("type"),n=r.data("default");if(s){if(i=t[s],"number"===l&&(i=parseFloat(t[s]),i=isNaN(i)?"":i),!i&&!1!==i&&0!==i){if(void 0===n)continue;i=n}r.is(":checkbox")?r.prop("checked",Boolean(i)).data("value",Boolean(i)):r.is("input,textarea")?(r.is('input[type="range"],input[type="hidden"]')||r.closest(".lse-color-input").length||(i=i==n?"":i),r.val(i).data("value",i)):r.is("select")&&(r.children().prop("selected",!1),r.children('[value="'+i+'"]').prop("selected",!0),r.data("value",i))}}},updateProperties:function(e,t,a,i,r){let s={},l={};jQuery.each(r,(function(e,t){s[e]=i[e],l[e]=t,i[e]=t})),LS_UndoManager.add(e,t,{itemIndex:a,undo:s,redo:l})},setLayerDataFromInputs:function(e){jQuery.each(LS_activeLayerDataSet,(function(t,a){e.each((function(){var e=jQuery(this),t=this.name,i=a,r=e.val();e.hasClass("lse-transition-prop")?i=i.transition:e.hasClass("lse-style-prop")&&(i=i.styles),t&&(i[t]=r)}))}))},setLayerUndoManagerFromInputs:function(e){let t=[],a="layer.general",i="LAYER_SETTINGS";jQuery.each(LS_activeLayerIndexSet,(function(r,s){let l=LS_activeLayerDataSet[r],n={},o={};e.each((function(){let e=jQuery(this),t=l,r=e.data("prevVal"),s=e.val(),d="";e.hasClass("lse-transition-prop")?(d="transition",t=t.transition,a="layer.transition",i="LAYER_SETTINGS"):e.hasClass("lse-style-prop")&&(d="styles",t=t.styles,a="layer.style",i="LAYER_STYLES"),r!=s&&(d?(n[d]||(n[d]={}),o[d]||(o[d]={}),n[d][this.name]=r,o[d][this.name]=s):(n[this.name]=r,o[this.name]=s))})),t.push({itemIndex:s,undo:n,redo:o})})),LS_UndoManager.add("layer.general",i,t)},readSliderSettings:function(){var e={};return jQuery(".lse-project-settings").find("input,textarea,select").each((function(){var t=jQuery(this),a=t.attr("name"),i=t.is(":checkbox")?t.prop("checked"):t.val();a&&!1!==i&&(e[a]=i)})),e},parseSliderSetting:function(){var e,t=window.lsSliderData.properties;for(e in t)switch(t[e]){case"on":case"true":t[e]=!0;break;case"off":case"false":t[e]=!1}},getDefaultSlideData:function(){return jQuery.isEmptyObject(LS_defaultSlideData)?(jQuery("lse-slide-settings").find("input, textarea, select").each((function(){var e=jQuery(this),t=e.attr("name"),a=e.data("default");t&&void 0!==a&&(LS_defaultSlideData[t]=a)})),LS_defaultSlideData):LS_defaultSlideData},getDefaultLayerData:function(){if(jQuery.isEmptyObject(LS_defaultLayerData)){let e=jQuery([]);LS_defaultLayerData.transition={},LS_defaultLayerData.styles={},jQuery("lse-layer-settings lse-sidebar-body").each((function(){let t=jQuery(this);t.hasClass("lse-layer-transition-panel")?jQuery('.lse-layer-transition-checkbox[data-default="true"]',t).each((function(){e=e.add(jQuery("input, textarea, select",jQuery(this).closest("lse-sidebar-section")))})):e=e.add(jQuery("input, textarea, select",t))})),e.each((function(){var e=jQuery(this),t=e.attr("name"),a=e.data("default");t&&void 0!==a&&(e.hasClass("lse-transition-prop")?LS_defaultLayerData.transition[t]=a:e.hasClass("lse-style-prop")?""!==a&&(LS_defaultLayerData.styles[t]=a):LS_defaultLayerData[t]=a)}))}return LS_defaultLayerData.autoSubtitle=!0,LS_defaultLayerData.subtitle="",LS_defaultLayerData},uuidForSlide:function(e){return e=e||LS_activeSlideIndex,this.uuidForObject(window.lsSliderData.layers[e].properties)},slideForUUID:function(e){var t;return jQuery.each(window.lsSliderData.layers,(function(a,i){if(i.properties.uuid&&i.properties.uuid==e)return t=a,!1})),t},uuidForLayer:function(e,t){void 0===e&&(e=LS_activeLayerIndexSet[0]),void 0===t&&(t=LS_activeSlideIndex);var a=window.lsSliderData.layers[t];return this.uuidForObject(a.sublayers[e])},layerForUUID:function(e){},uuidForObject:function(e){return e.uuid&&e.uuid.length||(e.uuid=this.generateUUID()),e.uuid},generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},restoreOldTransitionSettings:function(e){for(var t=[],a=0;void 0!==e[a];t.push(e[a++].getAttribute("name")));jQuery.each(window.lsSliderData.layers,(function(e,a){jQuery.each(a.sublayers,(function(e,a){for(var i=0;i<t.length;i++)a[t[i]]&&(a.transition[t[i]]=a[t[i]],delete a[t[i]])}))}))}},sliderBuilderIsReady=function(){sliderBuilderDidLoad()},sliderBuilderDidLoad=function(){if(lsEditor.loading.hide(),LayerSlider.showEditorWarnings(),history.replaceState){if(-1!=document.location.href.indexOf("&showsettings=1")){var e=document.location.href.replace("&showsettings=1","");history.replaceState(null,document.title,e),localStorage["lse-welcome-guide-completed"]&&setTimeout((function(){jQuery("#lse-show-project-settings").click()}),500)}if(-1!=document.location.href.indexOf("&showrevisions=1")){e=document.location.href.replace("&showrevisions=1","");history.replaceState(null,document.title,e),localStorage["lse-welcome-guide-completed"]&&setTimeout((function(){jQuery(".lse-toggle-revisions:first").click()}),500)}}localStorage["lse-welcome-guide-completed"]||setTimeout((function(){jQuery('lse-button[data-tour="interfaceWalkthrough"]').click()}),1e3)},initSliderBuilder=function(){LS_sliderID||(LS_sliderID=jQuery('#lse-editor-form input[name="slider_id"]').val()),LS_previewArea=jQuery("lse-preview-area"),LS_previewHolder=LS_previewArea.parent(),LS_previewWrapper=LS_previewHolder.parent(),jQuery.ui.selectable.prototype.options.distance=3,jQuery.ui.draggable.prototype.options.distance=3,jQuery.ui.sortable.prototype.options.distance=3,window.lsSliderData.properties.new?(window.lsSliderData.properties=LS_DataSource.readSliderSettings(),window.lsSliderData.properties.createdWith=jQuery('input[name="sliderVersion"]').val(),window.lsSliderData.googlefonts=[],window.lsSliderData.layers=[{properties:jQuery.extend(!0,{},LS_DataSource.getDefaultSlideData()),sublayers:[]}]):window.lsSliderData.properties=jQuery.extend({},LS_DataSource.readSliderSettings(),window.lsSliderData.properties),window.lsSliderData.googlefonts||(window.lsSliderData.googlefonts=[]),window.lsSliderData.colorData||(window.lsSliderData.colorData={}),LayerSlider.rebuildSlides(),lsEditor.project.setLayout(),jQuery(".lse-datepicker-input").each((function(){var e=jQuery(this),t=e.data();e.airDatepicker({inline:!!t.datepickerInline,classes:t.datepickerClasses||"lse-datepicker",language:"en",dateFormat:"yyyy-mm-dd",timeFormat:"hh:ii:00",todayButton:new Date,clearButton:!0,timepicker:!0,keyboardNav:!1,range:!1,onSelect:function(e,t,a){LS_preventDatePickerChange||(a.$el.trigger("input"),lsSetEditorDirtyState(!0))},onShow:function(e){var t=jQuery(e.el).closest(".lse-scrollbar"),a=t.scrollTop(),i=e.$datepicker.position().top;t.find("lse-sidebar-section-body").css({paddingBottom:e.$datepicker.outerHeight()+"px"}),jQuery(".lse-focused-col").closest(".lse-scrollbar").on("scroll.airDatepicker",(function(){let r=t.scrollTop();e.$datepicker.css({top:i-(r-a)+"px"})}))},onHide:function(e){jQuery(e.el).closest(".lse-scrollbar").off("scroll.airDatepicker").find("lse-sidebar-section-body").css({paddingBottom:0})}})})),LayerSlider.updateProjectInterfaceItems(),LayerSlider.selectSlide(LS_activeSlideIndex,{forceSelect:!0}),LS_activeLayerIndexSet.length&&jQuery("#lse-toolbar-sidebar-tabs lse-button:eq(1)").click(),jQuery(window).on("beforeunload",(function(e){if(LS_editorIsDirty){var t=LS_l10n.SBUnsavedChanges;return e.returnValue=t,t}})),jQuery("body").on("click","#lse-warning.lse-warning-old-browser lse-button",(function(){jQuery("#lse-warning.lse-warning-old-browser").removeClass("lse-visible lse-warning-old-browser")})),jQuery("#lse-show-project-settings").click((function(){LayerSlider.openSliderSettings()})),jQuery("#lse-ellipsis-menu").on("change",":checkbox",(function(){var e=jQuery(this),t=e.prop("checked"),a=e.attr("name");LS_editorSettings[a]=t,jQuery.post(ajaxurl,{action:"ls_save_editor_settings",nonce:LS_editorMeta.editorSettingsNonce,data:JSON.stringify(LS_editorSettings)})})).on("click","[data-tour]",(function(){var e=jQuery(this),t=e.closest("[data-tour-url]"),a=e.data("tour");LS_tourData?LS_tourData&&LS_tourData[a]&&(lsEditor.gui.close("ellipsis"),iGuider(LS_tourData[a])):import(t.attr("data-tour-url")).then((e=>{e&&e.LS_tourData&&(LS_tourData=e.LS_tourData),LS_tourData&&LS_tourData[a]&&(lsEditor.gui.close("ellipsis"),iGuider(LS_tourData[a]))}))})),jQuery("#lse-project-settings-sidebar kmw-menuitem").click((function(){LayerSlider.selectSettingsTab(this)})),document.location.hash&&LS_GUI.deeplinkSection(),jQuery(window).on("hashchange",(function(){LS_GUI.deeplinkSection()})),jQuery("#lse-save-button").on("click",(function(){LayerSlider.save()})),jQuery("#lse-publish-button").on("click",(function(){LayerSlider.publish()})),jQuery("#lse-project-settings-content .lse-datepicker-input").each((function(){var e=jQuery(this),t=e.data().datepickerKey;t&&window.lsSliderData.properties[t]&&(LS_preventDatePickerChange=!0,startDate=new Date(window.lsSliderData.properties[t]+""+LS_Utils.jsTimeZoneID()),e.data("datepicker").selectDate(startDate),e.trigger("keyup"),LS_preventDatePickerChange=!1)})),jQuery(".lse-popup-settings").on("click",".lse-popup-include-all-pages",(function(){var e=jQuery(this),t=jQuery(".lse-popup-include-pages lse-ib:not(:first-child), .lse-popup-include-custom-pages");e.prop("checked")?t.addClass("lse-dn"):t.removeClass("lse-dn")})).on("click",".lse-popup-preview-button",(function(e){e.preventDefault();let t=jQuery(this);if(t.hasClass("lse-inactive"))return!1;t.addClass("lse-disabled"),LayerSlider.startPopupPreview(),setTimeout((function(){t.removeClass("lse-disabled")}),2e3)})).on("keyup change",".lse-popup-triggers :input",(function(){setTimeout((function(){LayerSlider.updatePopupNotifications()}),100)})),jQuery(".lse-popup-include-all-pages").prop("checked")&&jQuery(".lse-popup-include-pages lse-ib:not(:first-child), .lse-popup-include-custom-pages").addClass("lse-dn"),LayerSlider.updatePopupPreview(),jQuery(document).on("click","#lse-popup-presets .lse-layout-illustration-grid",(function(){var e=jQuery(this),t=jQuery(".lse-popup-settings :input"),a=e.data("options");for(var i in"string"==typeof a&&(a=JSON.parse(a)),a){window.lsSliderData.properties[i]=a[i];var r=t.filter('[name="'+i+'"]');"boolean"==typeof a[i]?a[i]!=r.prop("checked")&&r.next().click():r.val(a[i])}LayerSlider.updatePopupPreview()})),LayerSlider.openMediaLibrary(),LS_SearchWindow.init(),jQuery("body").on("click",".lse-layer-open-font-library",(function(e){e.preventDefault(),lsEditor.smartHelp.close(),LS_fontLibrary.open((function(e){lsSliderData.googlefonts.push({param:e}),LayerSlider.loadGoogleFont(e),-1!==e.indexOf(" ")&&(e="'"+e+"'"),jQuery(".lse-layer-font-family").val(e).trigger("input").trigger("change"),LS_fontLibrary.close(),LayerSlider.reduceGoogleFontList(),LayerSlider.loadPreviewGoogleFonts()}))})),jQuery("body").on("click","#lse-add-layer-modal-window lse-b",(function(){kmw.modal.close(),LayerSlider.addFormattedLayer(this)})).on("click",".lse-context-add-layer lse-button",(function(){LayerSlider.addFormattedLayer(this,{styles:{top:LS_contextMenuTop/LS_previewZoom,left:LS_contextMenuLeft/LS_previewZoom}})})).on("click",".lse-context-overlapping-layers lse-button",(function(e){var t=jQuery(this).data("layerIndex");t&&LayerSlider.selectPreviewItem(t,e)})).on("click",".lse-context-menu-duplicate",(function(){LayerSlider.duplicateLayer()})).on("click",".lse-context-menu-remove",(function(){LayerSlider.removeLayer()})).on("click",".lse-context-menu-hide",(function(){LayerSlider.hideLayer()})).on("click",".lse-context-menu-lock",(function(){LayerSlider.lockLayer()})).on("click",".lse-context-menu-copy-styles",(function(){LayerSlider.copyLayerSettings(jQuery(".lse-layer-style-panel .lse-copy-layer-properties"))})).on("click",".lse-context-menu-paste-styles",(function(){LayerSlider.pasteLayerSettings(jQuery(".lse-layer-style-panel .lse-paste-layer-properties"))})).on("click",".lse-context-menu-copy-layer",(function(){LayerSlider.copyLayer()})).on("click",".lse-context-menu-paste-layer",(function(){LayerSlider.pasteLayer()})).on("click",".lse-context-menu-align lse-button",(function(e){for(var t,a,i,r,s,l,n=jQuery(".ui-selected-helper"),o=jQuery(this).data("move").split(" "),d=n.position().top,c=n.position().left,u=n.width(),p=n.height(),y=LS_previewArea.width()*LS_previewZoom,h=LS_previewArea.height()*LS_previewZoom,S=[],m=!1,L=!1,g=0;g<o.length;g++)switch(o[g]){case"left":i=0,r="0%",m=!0;break;case"center":i=y/2-u/2,r="50%",m=!0;break;case"right":i=y-u,r="100%",m=!0;break;case"top":s=0,l="0%",L=!0;break;case"middle":s=h/2-p/2,l="50%",L=!0;break;case"bottom":s=h-p,l="100%",L=!0}t=d-s,a=c-i,jQuery.each(LS_activeLayerIndexSet,(function(e,i){var s=LS_activeSlideData.sublayers[i],n={},o={};if(s.locked)return!1;var d=LS_previewItems[i].position(),c=Math.round((d.left-a)/LS_previewZoom).toString(),u=Math.round((d.top-t)/LS_previewZoom).toString();1===LS_activeLayerIndexSet.length&&(c=r,u=l),m&&(n.left=s.styles.left,o.left=c,s.styles.left=c,jQuery("lse-layer-settings input[name=left]").val(c)),L&&(n.top=s.styles.top,o.top=u,s.styles.top=u,jQuery("lse-layer-settings input[name=top]").val(u)),S.push({itemIndex:i,undo:n,redo:o}),LayerSlider.generatePreviewItem(i)})),LayerSlider.updatePreviewSelection(),LS_UndoManager.add("layer.style","LAYER_ALIGN",S)})).on("click",".lse-context-menu-align-in-selection lse-button",(function(e){var t,a,i=jQuery(".ui-selected-helper"),r=jQuery(this).data("move"),s=i.position().top/LS_previewZoom,l=i.position().left/LS_previewZoom,n=i.width()/LS_previewZoom,o=i.height()/LS_previewZoom,d=[],c=!1,u=!1;r&&(jQuery.each(LS_activeLayerIndexSet,(function(e,i){var p=LS_activeSlideData.sublayers[i],y={},h={};if(p.locked)return!1;var S=LS_previewItems[i],m=S.position(),L=(Math.round(m.left/LS_previewZoom),Math.round(m.top/LS_previewZoom),Math.round(S.outerWidth())),g=Math.round(S.outerHeight());switch(r){case"left":t=l,c=!0;break;case"center":t=l+n/2-L/2,c=!0;break;case"right":t=l+n-L,c=!0;break;case"top":a=s,u=!0;break;case"middle":a=s+o/2-g/2,u=!0;break;case"bottom":a=s+o-g,u=!0}c&&(y.left=p.styles.left,h.left=Math.round(t),p.styles.left=Math.round(t)),u&&(y.top=p.styles.top,h.top=Math.round(a),p.styles.top=Math.round(a)),d.push({itemIndex:i,undo:y,redo:h}),LayerSlider.generatePreviewItem(i)})),LayerSlider.updatePreviewSelection(),LS_UndoManager.add("layer.style","LAYER_ALIGN",d))})),jQuery(document).on({mouseenter:function(){LayerSlider.highlightPreviewItem(this)},mouseleave:function(){LS_previewArea.children().removeClass("lse-highlighted lse-lowlighted")}},".lse-context-overlapping-layers lse-button"),jQuery(document).on("input.lse-update-data change.lse-update-data",".lse-project-settings input, .lse-project-settings textarea, .lse-project-settings select",(function(e){var t=jQuery(this),a=t.attr("name"),i=t.is(":checkbox")?t.prop("checked"):t.val();a&&(-1!==["width","height","popupWidth","popupHeight"].indexOf(a)&&i&&!i.toString().match(/^\d+$/)&&(i=parseInt(i)||"",t.val(i)),window.lsSliderData.properties[a]=i,-1!==["width","height","popupWidth","popupHeight"].indexOf(a)&&lsEditor.workspace.setSize(),"gradient"===t.data("type")&&(window.lsSliderData.properties[a+"Data"]=t.data("color")),lsSetEditorDirtyState(!0),t.is("select, :checkbox")?LayerSlider.generatePreview():LayerSlider.willGeneratePreview())})),jQuery(document).on("updated.ls",".lse-callback-box textarea",(function(e,t){"object"!=typeof window.lsSliderData.callbacks&&(window.lsSliderData.callbacks={}),lsSetEditorDirtyState(!0);var a=jQuery(this).attr("name"),i=jQuery(this).val(),r=i.match(/\{([\s\S]*)\}/m)[1].replace(/(\r\n|\n|\r)/gm,""),s=jQuery("#lse-callback-events-sidebar").find("lse-li:contains('"+a+"')");if(s.removeClass("lse-warning lse-active"),jQuery.trim(r).length){window.lsSliderData.callbacks[a]=i,s.addClass("lse-active");var l=i.indexOf("{")+1,n=i.length-1;body=i.substring(l,n);try{new Function(body)}catch(e){s.addClass("lse-warning")}}else delete window.lsSliderData.callbacks[a]})).on("click","#lse-callback-events-sidebar lse-li:not(.lse-disabled)",(function(){var e=jQuery(this).text(),t=jQuery("#lse-callback-events").closest(".kmw-modal-inner"),a=t.find('textarea[name="'+e+'"]').closest(".lse-callback-box").position().top;t.animate({scrollTop:a},300)})),jQuery("#lse-add-slide").click((function(e){e.preventDefault(),LayerSlider.addSlide(!1,{showSlideOptions:!0,selectSlide:!0,focusInput:!0,closeSlidesPanel:!1})})),jQuery("#lse-slide-tabs").on("click",".lse-slide-preview",(function(){var e=jQuery(this).closest(".lse-slide-tab");e.hasClass("lse-active")||LayerSlider.selectSlide(e.index(),{forceSelect:!0})})).on("input",".lse-slide-name input",(function(){LayerSlider.renameSlide(this)})),jQuery("body").on("input",".lse-custom-slide-properties input",(function(e){LayerSlider.setCustomSlideProperties(e)})).on("click",".lse-custom-slide-properties .lse-form-rows-close",(function(e){LayerSlider.setCustomSlideProperties(e)})),jQuery("body").on("click",".lse-color-input .lse-remove",(function(){let e=jQuery(this).parent(),t=jQuery("input",e);e.removeClass("lse-has-color"),t.trigger("track.lse-undomanager").val("").data({color:"",prevColor:"",value:""}).css("background","transparent").trigger("change").trigger("input")})),jQuery("body").on("click","#lse-context-menu-image-input .lse-url-prompt",(function(e){e.preventDefault();var t=prompt(LS_l10n.SBEnterImageURL);if(!t)return!1;var a=jQuery("#lse-context-menu-image-input").data("contextMenuProperties");$opener=a.$opener,$target=$opener.find("lse-image-input"),$target.hasClass("lse-global-background")?(lsSliderData.properties.backgroundimage=t,lsSliderData.properties.backgroundimageId=""):$target.hasClass("lse-slider-preview")?(lsSliderData.meta.preview=t,lsSliderData.meta.previewId=""):$target.hasClass("lse-slide-image")?LS_DataSource.updateProperties("slide.general","SLIDE_IMAGE",LS_activeSlideIndex,LS_activeSlideData.properties,{background:t,backgroundId:"",backgroundThumb:t}):$target.hasClass("lse-slide-thumbnail")?LS_DataSource.updateProperties("slide.general","SLIDE_THUMBNAIL",LS_activeSlideIndex,LS_activeSlideData.properties,{thumbnail:t,thumbnailId:"",thumbnailThumb:t}):$target.hasClass("lse-layer-image")?(LS_DataSource.updateProperties("layer.general","LAYER_IMAGE",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],{image:t,imageId:"",imageThumb:t}),LS_DataSource.buildLayersListItem(LS_activeLayerIndexSet[0])):$target.hasClass("lse-media-image")?LS_DataSource.updateProperties("layer.general","VIDEO_POSTER",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],{poster:t,posterId:"",posterThumb:t}):$target.hasClass("lse-layer-background-image")&&LS_DataSource.updateProperties("layer.general","LAYER_BG",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],{layerBackground:t,layerBackgroundId:"",layerBackgroundThumb:t}),LS_GUI.updateImagePicker($target,t),LayerSlider.updateSlidePreviews(),LayerSlider.generatePreview(),lsSetEditorDirtyState(!0)})).on("click","#lse-context-menu-image-input .lse-post-image",(function(e){e.preventDefault();var t=jQuery("#lse-context-menu-image-input").data("contextMenuProperties");$opener=t.$opener,$target=$opener.find("lse-image-input"),$target.hasClass("lse-slide-image")?LS_DataSource.updateProperties("slide.general","SLIDE_IMAGE",LS_activeSlideIndex,LS_activeSlideData.properties,{background:"[image-url]",backgroundId:"",backgroundThumb:""}):$target.hasClass("lse-slide-thumbnail")?LS_DataSource.updateProperties("slide.general","SLIDE_THUMBNAIL",LS_activeSlideIndex,LS_activeSlideData.properties,{thumbnail:"[image-url]",thumbnailId:"",thumbnailThumb:""}):$target.hasClass("lse-layer-image")?(LS_DataSource.updateProperties("layer.general","LAYER_IMAGE",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],{image:"[image-url]",imageId:"",imageThumb:""}),LS_DataSource.buildLayersListItem(LS_activeLayerIndexSet[0])):$target.hasClass("lse-layer-background-image")&&LS_DataSource.updateProperties("layer.general","LAYER_BG",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],{layerBackground:"[image-url]",layerBackgroundId:"",layerBackgroundThumb:""}),LS_GUI.updateImagePicker($target,!1),LayerSlider.updateSlidePreviews(),LayerSlider.generatePreview(),lsSetEditorDirtyState(!0)})).on("click","#lse-context-menu-image-input .lse-pixie-editor",(function(e){e.preventDefault(),e.stopPropagation();var t,a=jQuery("#lse-context-menu-image-input").data("contextMenuProperties").$opener.find("lse-image-input");a.attr("id","pixie-current-image"),a.hasClass("lse-global-background")?t=lsSliderData.properties.backgroundimage:a.hasClass("lse-slider-preview")?t=lsSliderData.meta.preview:a.hasClass("lse-slide-image")?t=LS_activeSlideData.properties.background:a.hasClass("lse-slide-thumbnail")?t=LS_activeSlideData.properties.thumbnail:a.hasClass("lse-layer-image")?t=LS_activeLayerDataSet[0].image:a.hasClass("lse-media-image")?t=LS_activeLayerDataSet[0].poster:a.hasClass("lse-layer-background-image")&&(t=LS_activeLayerDataSet[0].layerBackground),LayerSlider.openImageEditor(LS_Utils.toAbsoluteURL(t))})).on("click","#lse-context-menu-image-input .lse-pick-image",(function(e){jQuery("#lse-context-menu-image-input").data("contextMenuProperties").$opener.find("lse-image-input").click()})).on("click","#lse-context-menu-image-input .lse-remove-image",(function(e){var t=jQuery("#lse-context-menu-image-input").data("contextMenuProperties");$opener=t.$opener,$target=$opener.find("lse-image-input"),$target.hasClass("lse-global-background")?(window.lsSliderData.properties.backgroundimage="",window.lsSliderData.properties.backgroundimageId="",window.lsSliderData.properties.backgroundimageThumb=""):$target.hasClass("lse-slider-preview")?(window.lsSliderData.meta.preview="",window.lsSliderData.meta.previewId=""):$target.hasClass("lse-slide-image")?LS_DataSource.updateProperties("slide.general","SLIDE_IMAGE",LS_activeSlideIndex,LS_activeSlideData.properties,{background:"",backgroundId:"",backgroundThumb:""}):$target.hasClass("lse-slide-thumbnail")?LS_DataSource.updateProperties("slide.general","SLIDE_THUMBNAIL",LS_activeSlideIndex,LS_activeSlideData.properties,{thumbnail:"",thumbnailId:"",thumbnailThumb:""}):$target.hasClass("lse-layer-image")?(LS_DataSource.updateProperties("layer.general","LAYER_IMAGE",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],{image:"",imageId:"",imageThumb:""}),LS_DataSource.buildLayersListItem(LS_activeLayerIndexSet[0])):$target.hasClass("lse-media-image")?LS_DataSource.updateProperties("layer.general","VIDEO_POSTER",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],{poster:"",posterId:"",posterThumb:""}):$target.hasClass("lse-layer-background-image")&&LS_DataSource.updateProperties("layer.general","LAYER_BG",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],{layerBackground:"",layerBackgroundId:"",layerBackgroundThumb:""}),LS_GUI.updateImagePicker($target,!1),LayerSlider.updateSlidePreviews(),LayerSlider.generatePreview(),lsSetEditorDirtyState(!0)})).on("click","lse-icon-picker",(function(){let e=this;LS_IconLibrary.open((function(t){LS_IconLibrary.insertPicker(e,t)}))})).on("click",".lse-icon-input .lse-remove",(function(){let e={};e[jQuery(this).closest(".lse-icon-input").find("lse-icon-picker").data("prop")]="",LS_DataSource.updateProperties("layer.general","LAYER_ICON",LS_activeLayerIndexSet[0],LS_activeLayerDataSet[0],e),LS_DataSource.buildLayer(),LayerSlider.generateSelectedPreviewItems()})),jQuery("lse-slide-settings").on("input.lse-update-data change.lse-update-data","input, textarea, select",(function(e){var t=jQuery(this),a=t.attr("name"),i=t.is(":checkbox")?t.prop("checked"):t.val();if(a){LS_activeSlideData.properties[a]=i,"gradient"===t.data("type")&&(LS_activeSlideData.properties[a+"Data"]=t.data("color"));-1!==["bgsize","bgposition","bgcolor"].indexOf(a)&&LayerSlider.generatePreview()}})).on("click",".lse-capture-slide",(function(e){e.preventDefault(),LayerSlider.captureSlide()})),jQuery("body").on("click",".lse-select-transitions",(function(e){e.preventDefault(),LayerSlider.openTransitionGallery()})),jQuery("body").on("click","#lse-transition-window .lse-select-special-transition",(function(e){var t,a=jQuery(this);a.hasClass("lse-selected")?(a.removeClass("lse-selected"),t=!1):(a.addClass("lse-selected"),t=!0),LS_activeSlideData.properties[a.data("name")]=t})).on("click","#lse-transitions-list .lse-transitions-section .lse-transition-item",(function(e){e.preventDefault(),LayerSlider.toggleTransition(this)})).on("click","#lse-transitions-modal-select-button",(function(e){var t=!!jQuery(this).hasClass("lse-off");jQuery("#lse-transitions-list .lse-transitions-section.kmw-active").each((function(){LayerSlider.selectAllTransition(jQuery(this).index(),t)}))})).on("click","#lse-transitions-modal-apply-button",(function(e){if(!confirm(LS_l10n.SBTransitionApplyOthers))return!1;var t=jQuery(this);t.css("opacity",".5"),setTimeout((function(){t.css("opacity","1")}),2e3),jQuery.each(window.lsSliderData.layers,(function(e,t){t.properties["3d_transitions"]=LS_activeSlideData.properties["3d_transitions"],t.properties["2d_transitions"]=LS_activeSlideData.properties["2d_transitions"],t.properties.custom_3d_transitions=LS_activeSlideData.properties.custom_3d_transitions,t.properties.custom_2d_transitions=LS_activeSlideData.properties.custom_2d_transitions,t.properties.transitionorigami=LS_activeSlideData.properties.transitionorigami}))})).on("mouseenter","#lse-transitions-list .lse-transitions-section .lse-transition-item",(function(){LayerSlider.startTransitionPreview(this)})).on("mouseleave","#lse-transitions-list .lse-transitions-section .lse-transition-item",(function(){LayerSlider.stopTransitionPreview(this)})),jQuery("body").on("click","#lse-add-layer-button",(function(e){
e.preventDefault(),kmw.modal.open({content:"#lse-add-layer-template",maxWidth:910})})).on("click","#lse-layers-list lse-li",(function(e){if(e.shiftKey&&1===LS_activeLayerDataSet.length){for(var t=LS_lastSelectedLayerIndex||LS_activeLayerIndexSet[0],a=jQuery(this).index(),i=Math.min(t,a),r=Math.max(t,a),s=[],l=i;l<=r;l++)s.push(l);LayerSlider.selectLayer(s)}else if(e.metaKey||e.ctrlKey){let e=jQuery(this),t=jQuery("#lse-layers-list lse-li.lse-active").add(this),a=[];e.hasClass("lse-active")&&(t=t.not(this)),t.each((function(){a.push(jQuery(this).index())})),a&&LayerSlider.selectLayer(a)}else LayerSlider.selectLayer([jQuery(this).index()])})).on("keyup",'input[name="subtitle"]',(function(){var e=jQuery(this).closest("lse-li").index();delete LS_activeSlideData.sublayers[e].autoSubtitle,LS_activeSlideData.sublayers[e].subtitle=jQuery(this).val()})).on("click","#lse-layers-list .lse-remove-layer",(function(e){e.preventDefault(),e.stopPropagation(),LayerSlider.removeLayer(jQuery(this).closest("lse-li").index())})).on("click","#lse-layers-list .lse-duplicate-layer",(function(e){e.preventDefault(),e.stopPropagation();let t=jQuery(this).closest("lse-li").index(),a=[t],i=[];i.push(LS_activeSlideData.sublayers[t]),LayerSlider.duplicateLayer(i,a)})).on("click","#lse-layer-device-types lse-button",(function(){LayerSlider.changeLayerScreenType(jQuery(this),!0)})).on("click",".lse-layer-element-type lse-button",(function(e){e.preventDefault();var t=jQuery(this);LS_UndoManager.add("layer.general","LAYER_TYPE",{itemIndex:LS_activeLayerIndexSet[0],undo:{type:LS_activeLayerDataSet[0].type},redo:{type:t.data("element")}}),LayerSlider.selectElementType(this),LayerSlider.generatePreviewItem(LS_activeLayerIndexSet[0])})).on("input.lse-update-data change.lse-update-data","lse-layer-settings input, lse-layer-settings textarea, lse-layer-settings select",(function(e,t){if(t=t||{},!e.undoManagerAction&&!t.undoManagerAction&&("change"!==e.type||jQuery(this).is("select"))){var a=jQuery(this),i=a.attr("data-default"),r=a.attr("name"),s=a.is(":checkbox")?a.prop("checked"):a.val(),l="top"===r||"left"===r;if(!a.data("lse-update-data-exclude")&&!a.closest(".lse-undomanager-exclude").length&&r){"true"===s&&(s=!0),"false"===s&&(s=!1),jQuery.each(LS_activeLayerDataSet,(function(e,t){var n=LS_activeLayerIndexSet[e],o=t;a.hasClass("lse-transition-prop")?o=o.transition:a.hasClass("lse-style-prop")&&(o=o.styles),l||null!==s&&"null"!==s&&""!==s?!l&&a.hasClass("lse-style-prop")&&void 0!==i&&i.toString()===s.toString()?delete o[r]:(o[r]=s,"gradient"===a.data("type")&&(o[r+"Data"]=a.data("color"))):delete o[r],"html"===r&&LayerSlider.autoRenameLayer(n),LayerSlider.generatePreviewItem(n)})),1===LS_activeLayerDataSet.length&&("html"===r&&(LayerSlider.setActiveLayerMedia(),"media"===LS_activeLayerDataSet[0].media&&LayerSlider.checkMediaAutoPlay(a,r,s)),"layer"===lsEditor.preview.state&&(lsEditor.preview.exit("layer"),lsEditor.preview.enter("layer")));var n=a.closest(".lse-start-at-wrapper"),o=n.parent();if(n.length&&!a.is(".lse-start-at-calc")){var d=jQuery(".lse-start-at-timing",o).val(),c=jQuery(".lse-start-at-operator",o).val(),u=jQuery(".lse-start-at-value",o).val(),p=jQuery(".lse-start-at-calc",o);p.data("prevVal",p.val()),setTimeout((function(){p.val(d+" "+c+" "+u).trigger("input"),LS_UndoManager.trackInputs(null,p)}),100)}}}})).on("change","lse-layer-settings input.lse-bgvideo",(function(e){LayerSlider.changeVideoType(e)})).on("change","#lse-transition-tabs .lse-layer-transition-checkbox",(function(e){LayerSlider.enableTransitionPage(this)})).on("click","lse-layer-settings .lse-copy-layer-properties",(function(e){e.preventDefault(),e.stopPropagation(),LayerSlider.copyLayerSettings(this)})).on("click","lse-layer-settings .lse-paste-layer-properties",(function(e){e.preventDefault(),e.stopPropagation(),LayerSlider.pasteLayerSettings(this)})).on("mouseenter",'lse-layer-settings select[name="static"]',(function(){LayerSlider.setupStaticLayersChooser(this)})).on("input change",".lse-layer-custom-attributes :input",(function(e){LayerSlider.setLayerAttributes(e)})).on("click",".lse-layer-custom-attributes .lse-form-rows-close",(function(e){LayerSlider.setLayerAttributes(e)})).on("input change","#lse-layer-actions-list :input",(function(e){LayerSlider.setLayerActions(e)})).on("click","#lse-layer-actions-list .lse-form-rows-close",(function(e){LayerSlider.setLayerActions(e)})).on("change",'lse-layer-settings select[name="static"]',(function(){var e,t=jQuery(this).val(),a=parseInt(jQuery(this).val());if("null"===t||null===t||0===a)return delete LS_activeLayerDataSet[0].transition.static,void delete LS_activeLayerDataSet[0].transition.staticUUID;a&&a>0&&(e=LS_DataSource.uuidForSlide(a-1),LS_activeLayerDataSet[0].transition.staticUUID=e)})),LayerSlider.addSlideSortables(),LayerSlider.addLayerSortables(),LayerSlider.addDraggable(),LS_previewArea.on("dragstart",".lse-disabled",(function(e){e.preventDefault()})).on("dblclick","> *:not(.lse-disabled)",(function(){LayerSlider.editLayerStart(jQuery(this))})).on("keydown",".lse-editing",(function(e){LayerSlider.editLayer(e)})).on("keyup",".lse-editing",(function(){LayerSlider.editLayerUpdate(this)})).on("paste",".lse-editing",(function(e){LayerSlider.editLayerPaste(e)})),jQuery("lse-live-preview-area").on("click",'a[href="#"]',(function(e){e.preventDefault()}));var e=null,t={},a={};jQuery(document).on("keydown",(function(i){if(LS_editorSettings.useKeyboardShortcuts&&!LS_Revisions.opened){if((i.metaKey||i.ctrlKey)&&83==i.which&&!i.altKey)return i.preventDefault(),void LayerSlider[i.shiftKey?"publish":"save"]({usedShortcut:!0});if((i.metaKey||i.ctrlKey)&&0==i.key&&(i.preventDefault(),jQuery(".lse-zoom-1").click()),(i.metaKey||i.ctrlKey)&&9==i.key&&(i.preventDefault(),jQuery(".lse-zoom-fit").click()),(i.metaKey||i.ctrlKey)&&69==i.which&&(i.stopPropagation(),LS_SearchWindow.open()),(i.metaKey||i.ctrlKey)&&70==i.which&&jQuery("#lse-toggle-fullscreen").click(),LS_sliderSettingsOpened||LS_searchOpened)return!0;if(jQuery("#pixie-current-image").length)return!0;var r=jQuery(i.target);if(13==i.which){if(r.is(":input:not(textarea)"))return i.preventDefault(),void i.target.blur();if(!(r.is(":input")||i.shiftKey||i.metaKey||i.ctrlKey||i.altKey))return i.preventDefault(),void LayerSlider.editLayerToggle()}if(27===i.which){var s=jQuery(".lse-editing");s.length&&LayerSlider.editLayerEnd(s)}if(!jQuery(".lse-editing").length){if((i.shiftKey||i.altKey||i.ctrlKey)&&32==i.which&&!jQuery(i.target).is(":input:not(button)"))return i.preventDefault(),lsEditor.preview.toggle("layer");if((i.metaKey||i.ctrlKey)&&65==i.which&&(r.is(":input:not(button)")||(i.preventDefault(),jQuery("#lse-add-layer-button").click())),32==i.which&&!r.is(":input"))return i.preventDefault(),lsEditor.preview.toggle("slide");if(!LayerSlider.isSlidePreviewActive&&!LayerSlider.isLayerPreviewActive){if(((i.metaKey||i.ctrlKey)&&i.shiftKey&&90==i.which||(i.metaKey||i.ctrlKey)&&89==i.which)&&!jQuery(i.target).is(":input"))return i.preventDefault(),LS_UndoManager.redo();if((i.metaKey||i.ctrlKey)&&90==i.which&&!jQuery(i.target).is(":input"))return i.preventDefault(),LS_UndoManager.undo();if((8==i.which||46==i.which)&&!jQuery(i.target).is(":input"))return i.preventDefault(),void LayerSlider.removeLayer();if((i.metaKey||i.ctrlKey)&&68==i.which)return i.preventDefault(),void LayerSlider.duplicateLayer();if((i.metaKey||i.ctrlKey)&&88==i.which&&!jQuery(i.target).is(":input"))return i.preventDefault(),LayerSlider.copyLayer(!0,LS_activeLayerDataSet,LS_activeLayerIndexSet,{shiftLayers:!1}),void LayerSlider.removeLayer(null,{requireConfirmation:!1});if((i.metaKey||i.ctrlKey)&&67==i.which)if(document.getSelection().toString())setTimeout((function(){LS_Utils.removeTextSelection()}),300);else if(!jQuery(i.target).is(":input"))return i.preventDefault(),void LayerSlider.copyLayer(!0);if((i.metaKey||i.ctrlKey)&&86==i.which&&!jQuery(i.target).is(":input"))return i.preventDefault(),void LayerSlider.pasteLayer();if(-1!==[37,38,39,40].indexOf(i.which)&&!jQuery(i.target).is(":input")){i.preventDefault();var l=[];jQuery.each(LS_activeLayerIndexSet,(function(e,r){var s=LS_activeSlideData.sublayers[r],n=LS_previewItems[r];if(!s)return!0;if(s.locked)return!0;var o=Math.round(parseFloat(s.styles.left)),d=Math.round(parseFloat(s.styles.top));if(-1!==s.styles.left.indexOf("%")||-1!==s.styles.top.indexOf("%")){var c=LayerSlider.setPositions(n,s.styles.top,s.styles.left,!0);o=c.left,d=c.top}t[r]||(t[r]=o),a[r]||(a[r]=d);var u=0,p=0;switch(i.which){case 37:u--;break;case 38:p--;break;case 39:u++;break;case 40:p++}u&&(i.preventDefault(),o+=i.shiftKey||i.altKey?10*u:u,s.styles.left=o+"px",n.css("left",o+"px"),jQuery("lse-layer-settings input[name=left]").val(o+"px")),p&&(i.preventDefault(),d+=i.shiftKey||i.altKey?10*p:p,s.styles.top=d+"px",n.css("top",d+"px"),jQuery("lse-layer-settings input[name=top]").val(d+"px")),l.push({itemIndex:r,undo:{left:t[r]+"px",top:a[r]+"px"},redo:{left:o+"px",top:d+"px"}});let y=lsEditor.layers.transformOrigin.getPropertiesInPixels(s.transition.transformoriginin||"50% 50% 0",o||0,d||0);n[0].style.transformOrigin=y[0]+" "+y[1]})),clearTimeout(e),e=setTimeout((function(){LS_UndoManager.add("layer.style","LAYER_POSITION",l.reverse()),t={},a={}}),1e3),LayerSlider.updatePreviewSelection()}}}}})),jQuery("#lse-editor-form").submit((function(e){e.preventDefault()})),jQuery("#lse-static-layers-list").on("click",".lse-jump-to-layer",(function(e){e.preventDefault(),e.stopPropagation(),LayerSlider.revealStaticLayer(this)})),jQuery("#lse-layers-list").on("click",".lse-hide-layer",(function(e){e.stopPropagation(),LayerSlider.hideLayer(this,{mirrorSettings:!0})})).on("click",".lse-lock-layer",(function(e){e.stopPropagation(),LayerSlider.lockLayer(this,{mirrorSettings:!0})})),LS_PostOptions.init(),LS_PostChooser.init(),LS_IconLibrary.init(),LS_InsertMedia.init(),LS_ButtonLibrary.init(),LS_ImportSlide.init(),LS_ImportLayer.init(),jQuery("body").on("click","#transition-modal-siderbar kmw-menuitem",(function(){jQuery("#lse-transitions-modal-select-button").show(),jQuery(this).hasClass("lse-transitions-special-effects")&&jQuery("#lse-transitions-modal-select-button").hide(),setTimeout((()=>{var e=jQuery("#lse-transitions-list > .lse-transitions-section.kmw-active").find(".lse-transition-item");e.filter(".lse-selected").length===e.length?jQuery("#lse-transitions-modal-select-button").attr("class","lse-on").text(LS_l10n.deselectAll):jQuery("#lse-transitions-modal-select-button").attr("class","lse-off").text(LS_l10n.selectAll)}),30)})),jQuery("body").on("click",".lse-link-fields .lse-link-dyn",(function(e){e.preventDefault();var t=jQuery(this).closest(".lse-link-fields"),a=jQuery(".lse-link-url-input",t),i=t.closest("lse-slide-settings").length,r=i?LS_activeSlideData.properties:LS_activeLayerDataSet[0],s=i?"SLIDE_SETTINGS":"LAYER_SETTINGS",l=i?"slide.general":"layer.general",n=i?LS_activeSlideIndex:LS_activeLayerIndexSet[0],o=i?"layer_link":"url";LS_UndoManager.add(l,s,{itemIndex:n,undo:{[o]:r[o]||"",linkId:r.linkId||"",linkName:r.linkName||"",linkType:r.linkType||""},redo:{[o]:"[post-url]",linkId:"",linkName:"",linkType:""}}),a.val("[post-url]"),t.find("input").trigger("input"),LS_GUI.updateLinkPicker(a)})).on("click",".lse-link-fields .lse-remove",(function(e){e.preventDefault();var t=jQuery(this).closest(".lse-link-fields"),a=t.closest("lse-slide-settings").length,i=a?LS_activeSlideData.properties:LS_activeLayerDataSet[0],r=a?"SLIDE_SETTINGS":"LAYER_SETTINGS",s=a?"slide.general":"layer.general",l=a?LS_activeSlideIndex:LS_activeLayerIndexSet[0],n=a?"layer_link":"url";LS_UndoManager.add(s,r,{itemIndex:l,undo:{[n]:i[n]||"",linkId:i.linkId||"",linkName:i.linkName||"",linkType:i.linkType||""},redo:{[n]:"",linkId:"",linkName:"",linkType:""}}),t.removeClass("lse-has-link").find("input").val("").prop("disabled",!1).trigger("input"),LS_GUI.updateLinkPicker("url")})),jQuery("body").on("click",".lse-modify-shape",(function(e){e.preventDefault(),LS_ShapeChooser.open(LS_activeLayerDataSet[0].shapeData,LS_activeLayerIndexSet[0])})).on("click",".lse-modify-object",(function(e){e.preventDefault(),LS_SVGChooser.open(LS_activeLayerDataSet[0].html)})),LS_DataSource.buildSlide(),LayerSlider.generatePreview();LS_previewWrapper.lsRuler();jQuery("body").on("click","#lse-history-list lse-button",(function(){jQuery(this).addClass("lse-selected").siblings().removeClass("lse-selected"),LS_UndoManager.jumpTo(jQuery(this).index())})).on("click","#lse-history-undo:not(.lse-disabled)",(function(e){LS_UndoManager.undo()})).on("click","#lse-history-redo:not(.lse-disabled)",(function(){LS_UndoManager.redo()})).on("focus.lse-undomanager change.lse-undomanager track.lse-undomanager","select, input, textarea",(function(e){LS_UndoManager.trackInputs(e,this)})),$lasso=jQuery("<div>").append(jQuery("lse-rotate-selected")).append(jQuery("<lse-forbid-autoselect></lse-forbid-autoselect>")).resizable({handles:"all"}).on("resize",(function(e){e.stopPropagation()})).on("mousedown.ls",".ui-resizable-handle",(function(e){1==e.which&&($lasso.data("ui-resizable")._aspectRatio=!!this.className.match(/-se|-sw|-ne|-nw/))})).on("resizestart.ls",(function(e,t){lsEditor.layers.highlight.disable();var a=t.helper.position();t.originalPosition.top=a.top,t.originalPosition.left=a.left,jQuery("#lse-workspace .ui-selected:not(.lse-disabled)").each((function(){var e=jQuery(this),t={left:parseFloat(e[0].style.left),top:parseFloat(e[0].style.top)};e.data("originalPosition",{top:t.top,left:t.left}).data("originalSize",{width:e.outerWidth(),height:e.outerHeight(),fontSize:parseInt(e.css("fontSize")),lineHeight:-1!==e.css("lineHeight").indexOf("px")&&parseInt(e.css("lineHeight"))})}))})).on("resize.ls",(function(e,t){LayerSlider.resizing(e,t)})).on("resizestop.ls",(function(e,t){var a=[];LayerSlider.resizing(e,t),$lasso.removeData("dragDirection"),jQuery("#lse-workspace .ui-selected:not(.lse-disabled)").each((function(){var e=jQuery(this),t=e.index(),i=LS_activeSlideData.sublayers[t],r=e.position(),s={width:e.width(),height:e.height()},l=parseInt(e.css("font-size")),n=parseInt(e.css("line-height")),o=e.data("originalPosition"),d=e.data("originalSize"),c={itemIndex:t,undo:{top:o.top+"px",left:o.left+"px",width:d.width+"px",height:d.height+"px","font-size":d.fontSize+"px","line-height":d.lineHeight+"px"},redo:{top:Math.round(r.top/LS_previewZoom)+"px",left:Math.round(r.left/LS_previewZoom)+"px",width:Math.round(s.width)+"px",height:Math.round(s.height)+"px","font-size":Math.round(l)+"px","line-height":Math.round(n)+"px"}};i.styles.width||e.is("img,div")||(e.width("auto"),delete c.undo.width,delete c.redo.width),i.styles.height||e.is("img,div")||(e.height("auto"),delete c.undo.height,delete c.redo.height),a.push(c)})),LS_UndoManager.add("layer.style","LAYER_RESIZE",a),LayerSlider.updatePreviewSelection(),lsEditor.layers.highlight.enable()})).addClass("ui-selected-helper").appendTo(LS_previewWrapper),$lsEwf.on("mouseup.ls",(function(e){var t=jQuery(".ui-selectable-helper");if(t.length){var a=t.position(),i=a.top,r=a.left,s=t.outerWidth(),l=t.outerHeight(),n=[];LS_previewArea.children(".ls-l").each((function(e){var t=jQuery(this),a=LS_activeSlideData.sublayers[e],o=LS_previewArea.offset().top+t.position().top,d=LS_previewArea.offset().left+t.position().left,c=t.outerWidth()*LS_previewZoom,u=t.outerHeight()*LS_previewZoom;if(a.locked||a.skip||t.hasClass("lse-disabled"))return!0;o>i&&o+u<i+l&&d>r&&d+c<r+s&&n.push(e)})),LayerSlider.selectLayer(n.length?n:LS_activeLayerIndexSet)}})).selectable({appendTo:$lsEwf,tolerance:"fit",filter:".ui-draggable:not(.lse-disabled)",cancel:".lse-disabled",distance:3}),$lsEpw.on("click.ls",".ui-draggable",(function(e){if(3!==e.which&&!LS_layerWasDragged&&!e.ctrlKey&&!e.metaKey){var t=jQuery(this).index(),a=LS_activeSlideData.sublayers[t];return!(!a||a.locked)&&void LayerSlider.selectLayer([jQuery(this).index()])}})).on("mousedown.ls",".ui-draggable",(function(e,t){if(LS_layerWasDragged=!1,1==e.which){var a=jQuery(this),i=a.index(),r=LS_activeSlideData.sublayers[i];if(!r||r.locked)return!1;a.hasClass("ui-selected")?(e.ctrlKey||e.metaKey)&&a.removeClass("ui-selected").trigger("selectablestop.ls"):(e.ctrlKey||e.metaKey||a.siblings(".ui-selected").removeClass("ui-selected"),a.addClass("ui-selected").trigger("selectablestop.ls"))}})).on("selectablestop.ls",(function(e,t){let a=[];$lsEpw.find(".ui-selected:not(.lse-disabled)").each((function(){a.push(jQuery(this).index())})),a.length||(a=LS_activeLayerIndexSet),LayerSlider.selectLayer(a)})).on("dragstart.ls",(function(e,t){if(!t)return!1;jQuery(".lse-center-line").addClass("lse-visible"),LS_layerWasDragged=!0,t.originalPosition.left=parseFloat(t.helper[0].style.left)*LS_previewZoom,t.originalPosition.top=parseFloat(t.helper[0].style.top)*LS_previewZoom;let a,i=t.helper.data("ui-draggable").snapElements,r=i.length;for(var s=0;s<r;s++)a=jQuery(i[s].item),a.is("lse-ruler-wrapper")||(i[s].width=a.outerWidth()*LS_previewZoom,i[s].height=a.outerHeight()*LS_previewZoom);t.helper.data({originalWidth:parseFloat(t.helper[0].style.width),originalHeight:parseFloat(t.helper[0].style.height)})})).on("dragstop.ls",(function(e,t){t.helper[0].style.width=t.helper.data("originalWidth")||"auto",t.helper[0].style.height=t.helper.data("originalHeight")||"auto",jQuery(".lse-center-line").removeClass("lse-visible")})).on("drag.ls",(function(e,t){jQuery.data(t.helper[0],"ui-draggable").helperProportions={width:t.helper.outerWidth()*LS_previewZoom,height:t.helper.outerHeight()*LS_previewZoom};let a=(t.position.top-t.originalPosition.top)/LS_previewZoom,i=(t.position.left-t.originalPosition.left)/LS_previewZoom;if(t.position.left=t.position.left/LS_previewZoom,t.position.top=t.position.top/LS_previewZoom,e.shiftKey&&(Math.abs(i)>=Math.abs(a)?(a=0,t.position.top=t.originalPosition.top/LS_previewZoom):(i=0,t.position.left=t.originalPosition.left/LS_previewZoom),t.helper.css(t.position)),t.helper.draggable("option","snap")){let a=t.helper.data("ui-draggable"),i=lsEditor.localStorage.data?.action?.layerSnapping;i=void 0===i||"true"===i,a.snapElements.length&&(!i||e.ctrlKey||e.metaKey)&&(a._snapElements=a.snapElements,a.snapElements=[]),a.snapElements.length||!i||e.ctrlKey||e.metaKey||(a.snapElements=a._snapElements)}$lsEpw.find(".ui-selected:not(.lse-disabled)").each((function(e,r){let s,l,n=jQuery(r),o=LS_activeSlideData.sublayers[n.index()];if(n.is(t.helper))s=parseFloat(r.style.left),l=parseFloat(r.style.top);else{let e=n.data("originalPosition");r.style.left=s=Math.round(e.left+i)+"px",r.style.top=l=Math.round(e.top+a)+"px"}let d=lsEditor.layers.transformOrigin.getPropertiesInPixels(o.transition.transformoriginin||"50% 50% 0",parseFloat(s)||0,parseFloat(l)||0);r.style.transformOrigin=d[0]+" "+d[1]}));var r=$lasso.data("originalPosition");$lasso.css({left:r.left+i*LS_previewZoom+"px",top:r.top+a*LS_previewZoom+"px"}).attr({"data-info-0":"x: "+Math.round(parseFloat($lasso.css("left"))/LS_previewZoom)+"px","data-info-1":"y: "+Math.round(parseFloat($lasso.css("top"))/LS_previewZoom)+"px"}),lsEditor.layers.transformHelper.update()})),setTimeout((function(){LayerSlider.updatePreviewSelection()}),200),document.fonts&&document.fonts.ready&&window.Promise&&document.fonts.ready.then((function(){jQuery.each(LS_previewItems,(function(e,t){var a=LS_activeSlideData.sublayers[e],i=a.styles.top,r=a.styles.left;LayerSlider.setPositions(t,i,r)})),LayerSlider.updatePreviewSelection()})),jQuery("body").on("click",".lse-premium-lock",(function(e){e.preventDefault(),lsDisplayActivationWindow()})).on("click",".lse-premium-menu-button",(function(e){e.preventDefault(),lsDisplayActivationWindow({title:LS_l10n.activationGeneral})})).on("click",".lse-open-embed-modal",(function(e){e.preventDefault(),lsEditor.gui.close("ellipsis"),LS_editorUI.openEmbedModal()})).on("click",".lse-open-keyboard-shortcuts",(function(){lsEditor.gui.close("ellipsis"),LS_editorUI.openKeyboardShortcuts()})),sliderBuilderIsReady()};jQuery(document).ready((function(){let e;window.lsSliderData?e=setInterval((function(){window.lsEditor&&(clearInterval(e),initSliderBuilder())}),50):sliderBuilderIsReady()}));var LS_SearchWindow={$window:jQuery("#lse-search-window"),$input:jQuery("#lse-search-window input"),init:function(){this.$window.prependTo("body"),this.$input.on("input",this.search),this.$window.on("click",".lse-search-match",(function(){LS_SearchWindow.performAction(this)})),this.$window.on("click",".lse-search-highlight",(function(){LS_SearchWindow.performHighlight(this)})),jQuery(document).on("keydown",this.navigation),jQuery(".lse-open-search-window").click(this.open),this.buildIndex()},open:()=>{LS_searchOpened?LS_SearchWindow.close():(LS_searchOpened=!0,jQuery("body").addClass("lse-show-search-window"),setTimeout((function(){LS_SearchWindow.$input.focus().select()}),100),setTimeout((function(){jQuery(document).off("click.lse-search-window").on("click.lse-search-window",(function(e){var t=jQuery(e.target);t.is("#lse-search-window")||t.closest("#lse-search-window").length||LS_SearchWindow.close()})),jQuery(document).keydown((function(e){27===e.which&&LS_SearchWindow.close()}))}),200))},close:()=>{LS_searchOpened=!1,jQuery(document).off("click.lse-search-window"),jQuery("body").removeClass("lse-show-search-window")},search:()=>{let e=LS_SearchWindow.$window,t=LS_SearchWindow.$input.val(),a=t.split(" "),i=a.shift().toLowerCase();if(LS_searchMatches=[],t.length<1)return jQuery(".lse-search-highlights-wrapper").show(),e.find(".lse-search-results-inner").html(""),void e.removeClass("lse-no-results lse-has-results");jQuery(".lse-search-highlights-wrapper").hide(),e.find(".lse-search-results").scrollTop(0),LS_SearchActions.forEach((function(e,t){e.actions.forEach((function(e,a){(-1!==e.name.toLowerCase().indexOf(i)||e.keywords&&-1!==e.keywords.toLowerCase().indexOf(i))&&(LS_searchMatches[t]||(LS_searchMatches[t]=[]),LS_searchMatches[t].push(e))}))})),a.forEach((function(e){(e=e.toLowerCase())&&LS_searchMatches.forEach((function(t,a){LS_searchMatches[a]=[],t.forEach((function(t,i){(-1!==t.name.toLowerCase().indexOf(e)||t.keywords&&-1!==t.keywords.toLowerCase().indexOf(e))&&LS_searchMatches[a].push(t)}))}))})),LS_searchMatches.length?e.removeClass("lse-no-results").addClass("lse-has-results"):e.addClass("lse-no-results").removeClass("lse-has-results");var r="";LS_searchMatches.forEach((function(e,t){if(e.length){var a=LS_SearchActions[t].name;r+='<div class="lse-search-heading">'+a+"</div>",r+='<div class="lse-search-matches">',e.forEach((function(e,a){var i=e.icon;0!==i.indexOf("<ls-icon")&&(i=LS_InterfaceIcons.search[e.icon]||LS_InterfaceIcons.layerTypes[e.icon]||LS_InterfaceIcons.search.circle),r+='<div class="lse-search-match" data-category="'+t+'" data-match="'+a+'"><div class="lse-search-match-inner">'+i+"<div>"+e.name+"</div></div></div>"})),r+="</div>"}})),e.find(".lse-search-results-inner").html(r),e.find(".lse-search-match").eq(0).addClass("lse-selected")},performHighlight:e=>{switch(jQuery(e).data("searchAction")){case"interfaceSettings":LS_SearchWindow.close(),setTimeout((function(){lsEditor.slideMenu.slideTo("ellipsisMenu","interfaceSettings")}),100);break;case"interactiveGuides":LS_SearchWindow.close(),setTimeout((function(){lsEditor.slideMenu.slideTo("ellipsisMenu","interactiveGuides")}),100);break;case"howToEmbed":LS_SearchWindow.close(),setTimeout((function(){LS_editorUI.openEmbedModal()}),100);break;case"getHelp":window.open("https://layerslider.com/help/");break;case"moreMenu":LS_SearchWindow.close(),setTimeout((function(){lsEditor.gui.open("ellipsis")}),100)}},performAction:e=>{var t=jQuery(e),a=LS_searchMatches[t.data("category")][t.data("match")];a&&a.action&&(a.action(),LS_SearchWindow.close())},navigation:()=>{if(LS_searchOpened){var e,t=jQuery(".lse-search-match"),a=jQuery(".lse-search-match").filter(".lse-selected"),i=a.length?a.index(".lse-search-match"):-1;if(40===event.which)event.preventDefault(),e=t[i+1]||a.length-1,(e=jQuery(e)).length&&(jQuery(".lse-search-match").removeClass("lse-selected"),e.addClass("lse-selected"));else if(38===event.which)event.preventDefault(),e=t[i-1]||t[0],(e=jQuery(e)).length&&(jQuery(".lse-search-match").removeClass("lse-selected"),e.addClass("lse-selected"));else if(13===event.which){if(event.preventDefault(),!a.length)return;var r=LS_searchMatches[a.data("category")][a.data("match")];r&&r.action&&(r.action(),LS_SearchWindow.close())}if(e&&e.length){var s=jQuery("#lse-search-window .lse-search-results"),l=s.height(),n=s.scrollTop(),o=e.position().top,d=e.height();o<n?0===e.index(".lse-search-match")&&n>0?s.scrollTop(0):s.scrollTop(o+15):o+d>l+n&&s.scrollTop(o+d-l+20)}}},buildIndex:()=>{var e={name:LS_l10n.SBSearchNavigation,actions:[]};jQuery("#lse-project-settings-sidebar kmw-menuitem").each((function(t){var a="<ls-icon>"+jQuery(this).find("kmw-icon").html()+"</ls-icon>",i=jQuery(this).find("kmw-menutext").text();e.actions.push({name:LS_l10n.SBProjectSettings+" &nbsp; &rarr; &nbsp; "+i,icon:a,keywords:"",action:function(){LayerSlider.openSliderSettings(),LayerSlider.switchSliderSettingsTab(t)}})})),jQuery("lse-slide-settings lse-sidebar-subnav lse-subnav-item").each((function(t){var a="<ls-icon>"+jQuery(this).find("ls-icon").html()+"</ls-icon>",i=jQuery(this),r=i.find("lse-text").text();e.actions.push({name:LS_l10n.SBSlideOptions+" &nbsp; &rarr; &nbsp; "+r,icon:a,keywords:"",action:function(){jQuery("#lse-show-slide-settings").click(),i.click(),lsEditor.form.highlightItem(i)}})})),jQuery("lse-layer-settings lse-sidebar-subnav lse-subnav-item").each((function(t){var a="<ls-icon>"+jQuery(this).find("ls-icon").html()+"</ls-icon>",i=jQuery(this),r=i.find("lse-text").text();e.actions.push({name:LS_l10n.SBLayerOptions+" &nbsp; &rarr; &nbsp; "+r,icon:a,keywords:"",action:function(){jQuery("#lse-show-layer-settings").click(),i.click(),lsEditor.form.highlightItem(i)}})})),LS_SearchActions.push(e);e={name:LS_l10n.SBProjectSettings,actions:[]};jQuery("#lse-project-settings-tabs").children().each((function(t){var a=jQuery(this),i=a.data("category"),r=a.find("[data-search-name]");(r=r.not('[type="range"]')).each((function(){let a=jQuery(this).closest("tr");e.actions.push({name:LS_l10n.SBProjectSettings+" &nbsp; &rarr; &nbsp; "+i+" &nbsp; &rarr; &nbsp; "+jQuery(this).data("search-name"),icon:"",action:function(){if(LayerSlider.openSliderSettings(),LayerSlider.switchSliderSettingsTab(t),a.hasClass("lse-advanced")){let e=jQuery("#lse-show-advanced-settings").find(":checkbox");e.prop("checked")||e.click()}setTimeout((function(){LayerSlider.highlightOptionRow(a)}),500)}})}))})),LS_SearchActions.push(e);e={name:LS_l10n.SBSlideOptions,actions:[]};jQuery("lse-slide-settings lse-sidebar-body").each((function(t){var a=jQuery(this),i=a.data("section-name"),r=a.find("[data-search-name]");(r=r.not('[type="range"]')).each((function(){let t=jQuery(this),r="";t.is("select")&&t.find("option").each((function(){r+=" "+jQuery(this).text()})),e.actions.push({name:LS_l10n.SBSearchSlide+" &nbsp; &rarr; &nbsp; "+i+" &nbsp; &rarr; &nbsp; "+t.data("search-name"),icon:"",keywords:r,action:function(){t.is("lse-button")?t.click():(jQuery("#lse-show-slide-settings").click(),lsEditor.form.selectCategory(a,t),lsEditor.form.highlightItem(t))}})}))})),LS_SearchActions.push(e);e={name:LS_l10n.SBLayerOptions,actions:[]};jQuery("lse-layer-settings lse-sidebar-body").each((function(t){var a=jQuery(this),i=a.data("section-name"),r=a.find("[data-search-name]");(r=r.not('[type="range"]')).each((function(){let t=jQuery(this),r=t.closest("[data-section-name]"),s="",l="";if(t.is("select")&&t.find("option").each((function(){s+=" "+jQuery(this).text()})),r.length&&(l=r.data("section-name")),t.closest(".lse-placeholder").length)return!0;e.actions.push({name:LS_l10n.SBSearchLayers+" &nbsp; &rarr; &nbsp; "+(l||i)+" &nbsp; &rarr; &nbsp; "+t.data("search-name"),icon:"",keywords:s,action:function(){t.is("lse-button")?t.click():(jQuery("#lse-show-layer-settings").click(),lsEditor.form.selectCategory(a,t,r),lsEditor.form.highlightItem(t))}})}))})),LS_SearchActions.push(e)}};LS_Revisions={initialized:!1,opened:!1,revisions:[],value:1,max:1,selectedRevision:{},originalSliderData:{},$slider:jQuery("#lse-revisions-slider"),init:function(){let e;LS_Revisions.$slider.on("input",(function(){LS_Revisions.slideEvent(jQuery(this).val())})),jQuery("#lse-revisions-apply-button").click((function(){LS_Revisions.apply()})),jQuery("#lse-revisions-back-button").click((function(){var e=LS_Revisions.value-1||1;LS_Revisions.$slider.val(e),LS_Revisions.slideEvent(e)})),jQuery("#lse-revisions-forward-button").click((function(){var e=LS_Revisions.value+1||1;LS_Revisions.$slider.val(e),LS_Revisions.slideEvent(e)})),jQuery("#lse-revisions-settings input").on("input",(function(t){t.preventDefault(),clearTimeout(e),e=setTimeout((function(){let e=jQuery("#lse-revisions-settings :input").serialize();jQuery.post(ajaxurl,e,(function(){lsEditor.notify.show({icon:"save",text:LS_l10n.notifySettingsSaved,timeout:2e3})}))}),500)}))},slideEvent:function(e){lsEditor.preview.exit(),e=parseInt(e);var t=LS_Revisions.revisions[e-1]||{};LS_Revisions.value=e,LS_Revisions.updateUI(e),LS_Revisions.selectedRevision=t,window.lsSliderData=t.data,LS_activeSlideIndex+1>window.lsSliderData.layers.length&&(LS_activeSlideIndex=window.lsSliderData.layers.length-1),window.LS_activeSlideData=window.lsSliderData.layers[LS_activeSlideIndex],window.LS_activeLayerIndexSet=[0],LS_Revisions.updateRevisionDetails(),LayerSlider.rebuildSlides(),LayerSlider.generatePreview()},open:function(){if(LS_Revisions.initialized||(LS_Revisions.init(),LS_Revisions.initialized=!0),!LS_editorMeta.isActivatedSite)return lsEditor.revisions.exit(),void LS_Revisions.showWelcomeScreen();lsEditor.loading.show("modal"," "),LS_Revisions.originalSliderData=jQuery.extend(!0,{},window.lsSliderData),jQuery.getJSON(ajaxurl,{action:"ls_get_revisions",sliderID:LS_sliderID},(function(e){lsEditor.loading.hide(),$lsE.addClass("lse-show-revisions"),lsEditor.workspace.update("resizeWorkspace"),lsEditor.workspace.zoom.checkFit(),!e||e.length<2?(jQuery("lse-revisions-frame").addClass("lse-revisions-is-empty"),LS_Revisions.showWelcomeScreen()):jQuery("lse-revisions-frame").removeClass("lse-revisions-is-empty"),LS_Revisions.revisions=e,LS_Revisions.value=e.length,LS_Revisions.max=e.length,LS_Revisions.openUI()})).fail((function(){lsEditor.revisions.exit()}))},openUI:function(){LS_Revisions.opened=!0,LS_Revisions.$slider.attr("max",LS_Revisions.revisions.length),LS_Revisions.$slider.val(LS_Revisions.revisions.length),LS_Revisions.updateUI(),LayerSlider.hidePreviewSelection(),LayerSlider.disableSlideSortables()},updateUI:function(e){var t=LS_Revisions.value,a=LS_Revisions.max,i=jQuery("#lse-revisions-back-button"),r=jQuery("#lse-revisions-forward-button");i[1===t?"addClass":"removeClass"]("lse-disabled"),r[t===a?"addClass":"removeClass"]("lse-disabled"),LS_Revisions.selectedRevision=LS_Revisions.revisions[t-1]||{},LS_Revisions.updateRevisionDetails()},close:function(){LS_Revisions.opened=!1,jQuery.isEmptyObject(LS_Revisions.originalSliderData)||(window.lsSliderData=jQuery.extend(!0,{},LS_Revisions.originalSliderData),LS_DataSource.reloadEditorData()),LayerSlider.showPreviewSelection(),LayerSlider.enableSlideSortables()},apply:function(){jQuery("#lse-revisions-apply-button").text(LS_l10n.SBRevisionsLoading).addClass("lse-disabled"),jQuery.post(ajaxurl,jQuery("lse-revisions-frame :input").serialize(),(function(){window.location.reload(!0)}))},updateRevisionDetails:function(){var e=LS_Revisions.selectedRevision||{};jQuery("#lse-revision-author").text(e.nickname),jQuery("#lse-revisions-time-diff").text(e.time_diff),jQuery("#lse-revisions-date").text(e.created),jQuery("#lse-revisions-oldest").text(LS_Revisions.revisions[0]?LS_Revisions.revisions[0].created:""),jQuery("#lse-revision-id").val(e.id)},showWelcomeScreen:function(e){e=e||{},e=jQuery.extend(!0,e,{content:"#lse-revisions-welcome-template",maxWidth:960,modalClasses:"lse-revisions-modal-window"}),
kmw.modal.open(e)}},function($){$.fn.lsRuler=function(e){e=e||50;$("#lse-ruler-wrapper-h").draggable({axis:"y",noRecoup:!0,distance:0,cursorAt:{top:0},helper:function(){return $('<div class="lse-ruler-line lse-ruler-line-x">').appendTo($lsEwc)},stop:function(e,t){let a=$("#lse-ruler-wrapper-h"),i=a.offset().top,r=a.height();if(!(0>=t.offset.top-(i+r))){var s=t.helper.clone();s.removeClass("ui-draggable-dragging"),s.draggable({axis:"y",noRecoup:!0,distance:0,drag:function(e,t){t.position.top+=e.pageY-t.offset.top},stop:function(e,t){0>=t.offset.top-(i+r)?t.helper.remove():t.helper.data({originalTop:t.position.top/LS_previewZoom,originalLeft:t.position.left/LS_previewZoom})}}).data({originalTop:t.position.top/LS_previewZoom,originalLeft:t.position.left/LS_previewZoom}).appendTo($lsEwc)}}}),$("#lse-ruler-wrapper-v").draggable({axis:"x",noRecoup:!0,distance:0,cursorAt:{left:0},helper:function(){return $('<div class="lse-ruler-line lse-ruler-line-y">').appendTo($lsEwc)},stop:function(e,t){let a=$("#lse-ruler-wrapper-v"),i=a.offset().left,r=a.width();if(!(0>=t.offset.left-(i+r))){var s=t.helper.clone();s.removeClass("ui-draggable-dragging"),s.draggable({axis:"x",noRecoup:!0,distance:0,drag:function(e,t){t.position.left+=e.pageX-t.offset.left},stop:function(e,t){0>=t.offset.left-(i+r)?t.helper.remove():t.helper.data({originalTop:t.position.top/LS_previewZoom,originalLeft:t.position.left/LS_previewZoom})}}).data({originalTop:t.position.top/LS_previewZoom,originalLeft:t.position.left/LS_previewZoom}).appendTo($lsEwc)}}});return this},jQuery(document).on("click","#lse-object-modal-window lse-button",(function(e){e.preventDefault();var t=jQuery("#lse-object-modal-window"),a=jQuery("textarea",t).val(),i=LS_Utils.normalizeSVG(a);if(layerData={},!i)return!1;layerData.styles={width:i.width,height:i.height},layerData.html=i.html,kmw.modal.close(),setTimeout((function(){t.data("replace")&&LS_activeLayerDataSet[0]?(LS_UndoManager.add("layer.general","LAYER_SETTINGS",{itemIndex:LS_activeLayerIndexSet[0],undo:{html:LS_activeLayerDataSet[0].html},redo:{html:layerData.html}}),LS_activeLayerDataSet[0].html=layerData.html,LayerSlider.generatePreviewItem(LS_activeLayerIndexSet[0]),LS_DataSource.buildLayer()):LayerSlider.addFormattedLayer("svg",layerData)}),500)}))}(jQuery);var LS_ShapeChooser={$modal:null,data:{},svg:null,layerIndex:null,type:"polygon",open:function(e,t){if(this.$modal=kmw.modal.open({content:"#tmpl-shape-modal",maxWidth:960,maxHeight:"100%",modalClasses:"lse-edit-shape-modal",contentClasses:"lse-scrollbar lse-scrollbar-dark",sidebar:{right:{title:t?LS_l10n.SBModifyShapeTitle:LS_l10n.SBInsertShapeTitle,customHeaderHeight:!0,width:300,content:jQuery("#tmpl-shape-modal-sidebar")}}}),e&&(this.type=e.type),this.layerIndex=null,this.data={},this.$modal.find("#lse-shape-modal-type").val(this.type),jQuery(`.lse-shape-modal-${this.type}`).addClass("lse-visible"),e)for(var a in e)jQuery('input[name="'+a+'"]',this.$modal).val(e[a]).prev("input").val(e[a]);void 0!==t?(this.layerIndex=t,jQuery("lse-button lse-text",this.$modal).text(LS_l10n.SBModifyShapeTitle)):jQuery("lse-button lse-text",this.$modal).text(LS_l10n.SBInsertShapeTitle),jQuery("#tmpl-shape-modal-sidebar .lse-color-input input").each((function(){LS_GUI.updateColorPicker(jQuery(this))})),LS_ShapeChooser.updatePreview(),this.$modal.on("input","input[name]",(function(){LS_ShapeChooser.updatePreview()})),this.$modal.on("click","lse-button:not(.lse-premium-lock)",(function(){LS_ShapeChooser.insert()})),this.$modal.on("change","#lse-shape-modal-type",(function(){this.data={};var e=jQuery(this).find("option:selected").val();jQuery(".lse-shape-modal-oval, .lse-shape-modal-rectangle, .lse-shape-modal-polygon, .lse-shape-modal-line").removeClass("lse-visible"),jQuery(".lse-shape-modal-"+e).addClass("lse-visible"),LS_ShapeChooser.resetValues(e),LS_ShapeChooser.updatePreview()}))},resetValues:function(e){var t=LS_SVGUtils.origSettings[e],a=Object.values(t);this.$modal.find("input[name]:visible").each((function(e){jQuery(this).val(a[e]),jQuery(this).prev().val(jQuery(this).val()).trigger("input")})),this.$modal.find('input[name="roundedEndings"]:visible').prop("checked",!0),this.$modal.find(".minicolors-swatch-color:visible").eq(0).css({backgroundColor:t.strokeColor}),this.$modal.find(".minicolors-swatch-color:visible").eq(1).css({backgroundColor:t.fillColor})},updatePreview:function(){var e=this.data;$preview=jQuery(".lse-shape-modal-content",this.$modal),this.$modal.find("lse-row.lse-visible input[name]:not(:checkbox)").each((function(){var t=jQuery(this),a=t.attr("name"),i=t.val();e[a]=i})),e.type=this.$modal.find("#lse-shape-modal-type option:selected").val(),this.type=e.type,e.roundedEndings=this.$modal.find("lse-row.lse-visible :checkbox").prop("checked"),this.data=e=LS_SVGUtils.calculateShapeData(e),this.svg=LS_SVGUtils.createShapeSVG(e),$preview.css("color",e.fillColor||"initial").html(this.svg)},insert:function(){var e={html:this.svg,shapeData:this.data};if(this.data.fillColor&&(e.styles={color:this.data.fillColor}),kmw.modal.close(),null===this.layerIndex)setTimeout((function(){LayerSlider.addFormattedLayer("shape",e)}),400);else{e=LS_activeLayerDataSet[0];var t={itemIndex:this.layerIndex,undo:{html:e.html,shapeData:e.shapeData},redo:{html:this.svg,shapeData:this.data}};this.data.fillColor&&(t.undo.styles={color:e.styles.color},t.redo.styles={color:this.data.fillColor}),LS_UndoManager.add("layer.general","LAYER_SETTINGS",t),e.html=this.svg,e.shapeData=this.data,this.data.fillColor&&(e.styles.color=this.data.fillColor),LS_DataSource.buildLayersListItem(),LS_DataSource.buildLayer(),LayerSlider.generatePreviewItem(this.layerIndex),LayerSlider.autoRenameLayer(LS_activeLayerIndexSet[0])}}},LS_SVGChooser={open:function(e){e=e||"",kmw.modal.open({content:jQuery("#lse-object-modal-window"),maxWidth:1024,maxHeight:780,sidebar:{left:{width:300,customHeaderHeight:!0,content:jQuery("#lse-object-modal-sidebar")}},onBeforeOpen:function(){jQuery("#lse-object-modal-window").attr("data-replace",!!e),jQuery("#lse-object-insert-button").html(e?LS_l10n.SBModifyObjectTitle:LS_l10n.SBInsertObjectTitle),jQuery("#lse-object-insert-textarea").val(e||"").focus(),e?(jQuery("#lse-object-insert-textarea").focus(),jQuery("#lse-object-modal-sidebar .lse-insert-svg-menu-item").click()):jQuery("#lse-object-modal-sidebar .lse-welcome-svg-menu-item").click()}})}},LS_editorUI={openKeyboardShortcuts:function(){kmw.modal.open({content:"#tmpl-keyboard-shortcuts",minWidth:400,maxWidth:1280})},openEmbedModal:function(){kmw.modal.open({content:jQuery("#tmpl-embed-project"),minWidth:400,maxWidth:980,sidebar:{left:{width:300,content:jQuery("#tmpl-embed-project-sidebar")}}}).find("input.lse-shortcode").val('[layerslider id="'+(lsSliderData.properties.slug||LS_sliderID)+'"]')}},prepTemplateForRelease=function(){var e=window.lsSliderData,t=e.properties;t.backgroundimage&&(t.backgroundimage=LS_Utils.parse_url(t.backgroundimage,"PHP_URL_PATH")),t.preview&&(t.preview=LS_Utils.parse_url(t.preview,"PHP_URL_PATH")),e.meta&&e.meta.preview&&(e.meta.preview=LS_Utils.parse_url(e.meta.preview,"PHP_URL_PATH")),jQuery.each(window.lsSliderData.layers,(function(e,t){var a=t.properties;t.history=[],t.meta&&t.meta.undoStackIndex&&(t.meta.undoStackIndex=-1),a.background&&(a.background=LS_Utils.parse_url(a.background,"PHP_URL_PATH")),a.backgroundThumb&&(a.backgroundThumb=LS_Utils.parse_url(a.backgroundThumb,"PHP_URL_PATH")),a.thumbnail&&(a.thumbnail=LS_Utils.parse_url(a.thumbnail,"PHP_URL_PATH")),a.thumbnailThumb&&(a.thumbnailThumb=LS_Utils.parse_url(a.thumbnailThumb,"PHP_URL_PATH")),jQuery.each(t.sublayers,(function(e,t){t.image&&(t.image=LS_Utils.parse_url(t.image,"PHP_URL_PATH")),t.imageThumb&&(t.imageThumb=LS_Utils.parse_url(t.imageThumb,"PHP_URL_PATH")),t.poster&&(t.poster=LS_Utils.parse_url(t.poster,"PHP_URL_PATH")),t.posterThumb&&(t.posterThumb=LS_Utils.parse_url(t.posterThumb,"PHP_URL_PATH")),t.layerBackground&&(t.layerBackground=LS_Utils.parse_url(t.layerBackground,"PHP_URL_PATH")),t.layerBackgroundThumb&&(t.layerBackgroundThumb=LS_Utils.parse_url(t.layerBackgroundThumb,"PHP_URL_PATH"))}))})),LS_UndoManager.update(),lsSetEditorDirtyState(!0),alert("All Done. Performed tasks:\r\n\r\n– Converted URLs to relative format\r\n– Emptied slides history\r\n\r\nManual save required.")};class LS_IconLoader{constructor(e){this.iconsCollection=e.icons,this.type=e.type,this.iconsKeys,this.iconsSourceArr,this.ICON_SIZE=70,this.MULTIPLIER=2,this.LOADING_AMOUNT=50,this.TIMEOUT_MS=300,this.$iconsDisplay=jQuery("#lse-icons-panel-display"),this.$searchDisplay=jQuery("#lse-icons-panel-search-display"),this.$iconsContainer=jQuery("#lse-icons-panel-ctr"),this.$searchContainer=jQuery("#lse-icons-panel-search-ctr"),this.$searchInput=jQuery("#lse-icons-search-input"),this.idx=0,this.iconsArrs=[this.iconsCollection,this.foundIcons],this.iconNames=[this.iconsCollection,[]],this.$displays=[this.$iconsDisplay,this.$searchDisplay],this.$containers=[this.$iconsContainer,this.$searchContainer],this.prevScrolledIcons=[0,0],this.loadedIcons=[0,0],this.scrolledIcons=[0,0],this.minLoadIdx=[0,0],this.maxLoadIdx=[0,0],this.foundIcons=[],this.attachEvents(),this.calcValues(),this.loadIcons(),this.resizeTimeout,this.searchTimeout}attachEvents(){this.$iconsContainer.on("scroll.icons",(()=>{this.scrollEvent()})),this.$searchContainer.on("scroll.search",(()=>{this.scrollEvent()})),this.$searchInput.on("input.typein",(()=>{clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((()=>{let e=this.$searchInput.val();this.searchIcons(e)}),this.TIMEOUT_MS)})),jQuery(window).on("resize.iconspanel",(()=>{clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((()=>{let e=this.maxLoadIdx[this.idx];this.calcValues(),this.loadIcons(),this.loadMoreAfterEvent(e)}),this.TIMEOUT_MS)}))}calcValues(){let e=this.idx,t=this.iconsArrs[e].length,a=this.$displays[e],i=this.getTotalHeight(t);a.height(i),this.minLoadIdx[e]=this.getMinLoadIdx(),this.maxLoadIdx[e]=this.minLoadIdx[e]*this.MULTIPLIER}loadIcons(){let e=this.idx,t=this.iconsArrs[e];if(!(this.loadedIcons[e]>=t.length))for(;this.maxLoadIdx[e]>this.loadedIcons[e];){let a=this.iconsByCollection(t,this.loadedIcons[e]);this.$displays[e].append(a),this.loadedIcons[e]+=this.LOADING_AMOUNT}}searchIcons(e){if(!e||1===e.length)return void this.browseMode();this.searchMode(),this.resetSearch();let t=e.toLowerCase();this.foundIcons=this.searchByStr(t),this.iconsArrs[1]=this.foundIcons,this.calcValues(),this.loadIcons()}scrollEvent(){let e=this.idx;this.scrolledIcons[e]=this.getScrolledIcons(this.$containers[e]),this.scrolledIcons[e]<this.minLoadIdx[e]||(this.minLoadIdx[e]+=this.LOADING_AMOUNT,this.maxLoadIdx[e]+=this.scrolledIcons[e]-this.prevScrolledIcons[e],this.loadIcons(),this.prevScrolledIcons[e]=this.scrolledIcons[e])}changeIconSet(e){this.$searchInput.val(""),this.browseMode(),e.icons!==this.iconsCollection&&(this.iconsCollection=e.icons,this.type=e.type,this.idx=0,this.foundIcons=[],this.$iconsDisplay.html(""),this.$searchDisplay.html(""),this.$iconsContainer.scrollTop(0),this.$searchContainer.scrollTop(0),this.iconsArrs=[this.iconsCollection,this.foundIcons],this.iconNames=[this.iconsCollection,[]],this.initializeSVGs(),this.prevScrolledIcons=[0,0],this.loadedIcons=[0,0],this.scrolledIcons=[0,0],this.minLoadIdx=[0,0],this.maxLoadIdx=[0,0],this.calcValues(),this.loadIcons())}initializeSVGs(){"font"!==this.type&&(this.iconsSourceArr=Object.values(this.iconsCollection),this.iconsKeys=Object.keys(this.iconsCollection),this.iconsArrs=[this.iconsSourceArr,this.foundIcons],this.iconNames=[this.iconsKeys,[]])}getDisplayWidth(){return this.$displays[this.idx].width()}getRowSize(){return Math.floor(this.getDisplayWidth()/this.ICON_SIZE)}getTotalHeight(e){return this.ICON_SIZE*Math.ceil(e/this.getRowSize())}getContainerHeight(){return this.$containers[this.idx].height()}getContainerRows(){return Math.ceil(this.getContainerHeight()/this.ICON_SIZE)}getMinLoadIdx(){return this.getContainerRows()*Math.floor(this.getRowSize())}getScrolledIcons(e){let t=jQuery(e).scrollTop();return Math.ceil(t/this.ICON_SIZE)*this.getRowSize()}browseMode(){this.$iconsContainer.removeClass("lse-icons-hide"),this.$searchContainer.addClass("lse-icons-hide"),this.idx=0}searchMode(){this.$iconsContainer.addClass("lse-icons-hide"),this.$searchContainer.removeClass("lse-icons-hide"),this.idx=1}createFontIcon(e){return'<lse-b class="fa fa-'+e+'" data-help="'+e+'" data-tt></lse-b><lse-tt>'+e+"</lse-tt>"}iconsByCollection(e=this.iconsCollection,t=0){let a,i,r="";for(let s=t;s<t+this.LOADING_AMOUNT;s++)e[s]&&("font"===this.type?a=this.createFontIcon(e[s]):(i=this.normalizeIconName(this.getIconNames()[s]),a=`<lse-b data-tt><svg data-name="${i}" viewBox="0 0 ${e[s].width} ${e[s].height}">${e[s].data}</svg></lse-b><lse-tt>${i}</lse-tt>`),r+=a);return r}resetSearch(){this.$searchDisplay.html(""),this.$searchContainer.scrollTop(0),this.prevScrolledIcons[1]=0,this.loadedIcons[1]=0,this.scrolledIcons[1]=0,this.minLoadIdx[1]=0,this.maxLoadIdx[1]=0,this.iconNames[1]=[]}searchByStr(e){if("font"===this.type){let t=this.iconsCollection.filter((t=>t.includes(e)));return this.iconNames[1]=t,t}let t=this.iconsKeys.filter((t=>t.includes(e)));this.iconNames[1]=t;let a=[];return t.forEach((e=>{a.push(this.iconsCollection[e])})),a}loadMoreAfterEvent(e){let t=this.idx;this.maxLoadIdx[t]=this.maxLoadIdx[t]>=e?this.maxLoadIdx[t]:e,this.maxLoadIdx[t]+=this.getMinLoadIdx()*this.MULTIPLIER,this.loadIcons()}getIconNames(){let e=this.idx;return this.iconNames[e]}normalizeIconName(e){return e.replace(/(-solid|-brands|-regular|-light|-duotone)/gi,"")}}